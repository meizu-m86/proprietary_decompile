/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2015 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

// int __fastcall _cxa_finalize(_DWORD); weak
// int __fastcall property_get(_DWORD, _DWORD, _DWORD); weak
// int atoi(const char *nptr);
// int access(const char *name, int type);
// int mkdir(const char *path, __mode_t mode);
// FILE *fopen(const char *filename, const char *modes);
// int __fastcall _fwrite_chk(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int fclose(FILE *stream);
// int __fastcall _errno(_DWORD); weak
// char *strerror(int errnum);
// int _android_log_print(_DWORD, _DWORD, const char *, ...); weak
// int __fastcall _stack_chk_fail(_DWORD); weak
// int __fastcall mixer_open(_DWORD); weak
// int __fastcall mixer_get_ctl_by_name(_DWORD); weak
// int __fastcall mixer_close(_DWORD); weak
// int usleep(__useconds_t useconds);
// int pthread_mutex_lock(pthread_mutex_t *mutex);
void __fastcall j_audio_route_free(int a1);
_DWORD *__fastcall j_audio_route_init(int a1, const char *a2);
// int pthread_mutex_unlock(pthread_mutex_t *mutex);
// int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int pcm_is_ready(void); weak
// int __fastcall pcm_prepare(_DWORD); weak
unsigned int __fastcall j_audio_route_reset(int a1);
signed int __fastcall j_audio_route_apply_path(int a1, const char *a2);
int __fastcall j_audio_route_update_mixer(int a1);
// int __fastcall NxpTfa98xx_StartUp(_DWORD); weak
// int __fastcall pcm_get_error(_DWORD); weak
// int __fastcall pcm_close(_DWORD); weak
// int __fastcall property_set(_DWORD, _DWORD); weak
// int __fastcall _fread_chk(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int fseek(FILE *stream, __int32 off, int whence);
// int __fastcall pcm_params_get(_DWORD, _DWORD, _DWORD); weak
// int __fastcall pcm_params_free(_DWORD); weak
// int __fastcall pcm_get_buffer_size(_DWORD); weak
// int __fastcall pcm_frames_to_bytes(_DWORD, _DWORD); weak
// void *malloc(size_t size);
// __sighandler_t signal(int sig, __sighandler_t handler);
// void free(void *ptr);
// int __fastcall pcm_write(_DWORD, _DWORD); weak
// int __fastcall NxpTfa98xx_ReCalibrate(_DWORD); weak
signed int __fastcall j_wav_player_start(const char *a1, int a2, int a3);
// int __fastcall _snprintf_chk(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int strncmp(const char *s1, const char *s2, size_t n);
// int __fastcall mixer_ctl_get_num_values(_DWORD); weak
// int __fastcall mixer_ctl_set_value(_DWORD, _DWORD, _DWORD); weak
// int pcm_params_get_min(void); weak
// int __fastcall pcm_params_get_max(_DWORD, _DWORD); weak
// int strcmp(const char *s1, const char *s2);
// void *calloc(size_t nmemb, size_t size);
// int Open(void); weak
int __fastcall j_thread_refresh_audio_route(int a1);
// int NxpTfa98xx_Stop(void); weak
// int __fastcall pcm_stop(_DWORD); weak
// int __fastcall SetAudioClock(_DWORD); weak
// int __fastcall str_parms_create_str(_DWORD); weak
// int __fastcall str_parms_get_str(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __fastcall str_parms_destroy(_DWORD); weak
// int __fastcall str_parms_to_str(_DWORD); weak
// char *strdup(const char *s);
// int NxpTfa98xx_GetSpeakerImpedance(void); weak
// int _sprintf_chk(_DWORD, _DWORD, _DWORD, const char *, ...); weak
int __fastcall j_cvq_init(int a1);
// int __fastcall SetAudioVolume(_DWORD); weak
signed int __fastcall j_get_output_device_id(int a1, unsigned int a2);
signed int __fastcall j_get_input_source_id(int a1, int a2);
// int __fastcall _aeabi_memclr8(_DWORD, _DWORD); weak
// int __fastcall NxpTfa98xx_SetMute(_DWORD); weak
// int __fastcall NxpTfa98xx_PowerOn(_DWORD, _DWORD, _DWORD); weak
// int pthread_join(pthread_t th, void **thread_return);
// int release_resampler(void); weak
// int __fastcall NxpTfa98xx_PowerOff(_DWORD); weak
// int open(const char *file, int oflag, ...);
// int _read_chk(void); weak
// int close(int fd);
// double log10(double x);
int j_is_headphone_on();
// int pthread_create(pthread_t *newthread, const pthread_attr_t *attr, void *(*start_routine)(void *), void *arg);
int __fastcall j_amplifier_calibrate(int a1);
// int __fastcall SetAudioLoopback(_DWORD, _DWORD); weak
// int __fastcall mixer_ctl_set_enum_by_string(_DWORD, _DWORD); weak
// int str_parms_create(void); weak
// size_t strlen(const char *s);
// int __fastcall _strcat_chk(_DWORD, _DWORD, _DWORD); weak
// int __fastcall str_parms_add_str(_DWORD, _DWORD, _DWORD); weak
// int __fastcall _aeabi_memclr(_DWORD, _DWORD); weak
// int __fastcall create_resampler(_DWORD, _DWORD, _DWORD, _DWORD); weak
int __fastcall j_pcm_data_dump(const char *a1, int a2, int a3, int a4);
// int pcm_get_htimestamp(void); weak
// int __fastcall pcm_read(_DWORD, _DWORD, _DWORD); weak
// int __fastcall _aeabi_memcpy(_DWORD, _DWORD); weak
// int __fastcall mixer_ctl_set_array(_DWORD); weak
// int __fastcall _aeabi_memcpy4(_DWORD, _DWORD, _DWORD); weak
// int mixer_get_num_ctls(void); weak
// int __fastcall mixer_get_ctl(_DWORD, _DWORD); weak
// int __fastcall mixer_ctl_get_type(_DWORD); weak
// int __fastcall mixer_ctl_get_value(_DWORD, _DWORD); weak
// int __fastcall mixer_ctl_get_array(_DWORD, _DWORD, _DWORD); weak
// XML_Parser XML_ParserCreate(const XML_Char *encoding);
// void XML_SetUserData(XML_Parser parser, void *userData);
// void XML_SetElementHandler(XML_Parser parser, XML_StartElementHandler start, XML_EndElementHandler end);
// void *XML_GetBuffer(XML_Parser parser, int len);
// enum XML_Status XML_ParseBuffer(XML_Parser parser, int len, int isFinal);
// void XML_ParserFree(XML_Parser parser);
// int __fastcall mixer_ctl_get_num_enums(_DWORD); weak
// int __fastcall mixer_ctl_get_enum_string(_DWORD, _DWORD); weak
// void *realloc(void *ptr, size_t size);
// int __fastcall mixer_ctl_get_name(_DWORD); weak
// int printf(const char *format, ...);
// int puts(const char *s);
// int __fastcall _aeabi_memcpy8(_DWORD, _DWORD, _DWORD); weak
signed int __fastcall j_set_value(int a1, const char *a2);
int __fastcall j_uart_dev_read_wrapper(int a1, int a2, int a3, int a4, int a5);
int __fastcall j_cvq_start_decode(int a1);
signed int __fastcall j_uart_read_wrapper(int a1, int a2, int a3);
// void abort(void);
// int fprintf(FILE *stream, const char *format, ...);
// int dladdr(void); weak
// int __fastcall _gnu_Unwind_Find_exidx(_DWORD, _DWORD); weak
int sub_3500();
int (*__fastcall sub_3520(int (*result)(void)))(void);
int __fastcall pcm_data_dump(const char *a1, int a2, int a3, int a4);
signed int __fastcall get_output_device_id(int a1, unsigned int a2);
signed int __fastcall get_input_source_id(int a1, int a2);
int __fastcall thread_refresh_audio_route(int a1);
int __fastcall test_set_hifi_gain(int result);
int __fastcall wav_player_stop(int result);
signed int __fastcall wav_player_start(const char *a1, int a2, int a3);
int is_headphone_on();
int __fastcall amplifier_calibrate(int a1);
int thread_test_hifi();
signed int __fastcall adev_set_headset_volume(int a1, int _R1);
unsigned int __fastcall sub_427C(int a1);
unsigned int __fastcall sub_42F0(int a1);
unsigned int __fastcall sub_4364(int a1, int a2, int a3);
int *__fastcall sub_4394(int a1);
signed int __fastcall sub_43AC(int a1, int a2, unsigned int a3, int a4, int a5);
signed int __fastcall sub_4424(int a1, const char *a2, _DWORD *a3);
int __fastcall sub_46E0(int a1);
int sub_470A();
int __fastcall sub_4710(int a1, int a2);
int sub_4824(); // weak
int __fastcall sub_482C(int a1, int a2);
int sub_4B34(); // weak
int sub_4B3C(); // weak
int __fastcall sub_4B48(int a1, int a2);
char *__fastcall sub_4E6C(int a1, int a2);
int __fastcall sub_4FD0(int a1, int a2);
signed int __fastcall sub_5068(int a1, int a2, int a3, int a4, int a5, char **a6);
void __fastcall sub_52B8(int a1, int a2);
signed int __fastcall sub_52F4(int a1, int a2, int a3, int a4, _DWORD *a5);
void __fastcall sub_5520(int a1, int a2);
int sub_55A0(); // weak
int __fastcall sub_55A4(int a1, int a2, int a3);
int __fastcall sub_55E8(int a1);
int __fastcall sub_569C(int a1);
int __fastcall sub_5730(int a1);
void __fastcall sub_605C(int a1);
int __fastcall sub_6164(int a1);
void __fastcall sub_61B8(int a1);
int __fastcall sub_629C(int a1);
int __fastcall sub_62E0(int a1);
int __fastcall sub_6644(int a1);
int __fastcall sub_6676(int a1);
int __fastcall sub_66B0(int a1, int a2);
int __fastcall sub_6CBC(int a1);
int __fastcall sub_6D54(int result, _DWORD *a2, int a3);
int sub_6E08(); // weak
int sub_6E0E(); // weak
int sub_6E16(); // weak
int sub_6E22(); // weak
int sub_6E28(); // weak
int sub_6E2E(); // weak
int sub_6E34(); // weak
int __fastcall sub_6E38(int a1, int a2);
char *__fastcall sub_723C(int a1, const char *a2);
int sub_7320(); // weak
int sub_7324(); // weak
int sub_7328(); // weak
int sub_733E(); // weak
unsigned int __fastcall sub_7344(int a1, int a2, unsigned int a3);
int sub_7C90(); // weak
int sub_7C96(); // weak
signed int __fastcall sub_7C9C(int a1, _QWORD *a2);
unsigned int __fastcall sub_7D2C(int a1);
int sub_7DAC(); // weak
int sub_7DB2(); // weak
int sub_7DB8(); // weak
int sub_7DE0(); // weak
int sub_7DE4(); // weak
int sub_7DE8(); // weak
int sub_7DEE(); // weak
int __fastcall sub_7DF4(int a1, int a2);
int sub_7F78(); // weak
int sub_7F84(); // weak
int sub_7F88(); // weak
int sub_7F8C(); // weak
int __fastcall sub_7F90(int a1, int a2, int a3);
int sub_8A54(); // weak
int __fastcall sub_8A58(int a1);
signed int __fastcall sub_8BD4(int a1, int a2);
int sub_8C90(); // weak
int __fastcall audio_route_update_mixer(int a1);
unsigned int __fastcall audio_route_reset(int a1);
signed int __fastcall audio_route_apply_path(int a1, const char *a2);
const char **__fastcall sub_8DE4(int a1, const char *a2);
signed int __fastcall audio_route_reset_path(int a1, const char *a2);
_DWORD *__fastcall audio_route_init(int a1, const char *a2);
int __fastcall sub_9130(__int64 a1, const char **a2);
int sub_9568(); // weak
void __fastcall sub_9570(int a1);
void __fastcall audio_route_free(int a1);
unsigned int __fastcall sub_95D4(int a1);
signed int __fastcall get_value(int a1, int a2);
signed int __fastcall set_value(int a1, const char *a2);
signed int __fastcall cvq_open(int a1);
int __fastcall cvq_close(int a1);
int __fastcall readdirect(int a1);
int __fastcall cvq_read(int a1, int a2, int a3);
int __fastcall read_on_thread(int a1);
int __fastcall read_on_raw_data_thread(int a1);
int __fastcall uart_dev_read_wrapper(int a1, int a2, int a3, int a4, int a5);
int __fastcall cvq_start_decode(int a1);
int __fastcall cvq_start(int a1);
signed int __fastcall uart_read_wrapper(int a1, int a2, int a3);
signed int __fastcall pcm_read_uart_char_dev(int a1, char *a2, signed int a3);
int __fastcall cvq_init(int a1);
int __fastcall sub_9FE0(int result, signed int *a2, int *a3);
signed int __fastcall sub_A034(int a1, int a2, unsigned int a3, unsigned int a4);
signed int __fastcall sub_A378(int a1, int a2, unsigned int a3, int a4, int *a5);
signed int __fastcall sub_A414(int a1, int a2, unsigned int a3, int a4);
signed int __fastcall sub_A550(int a1, int a2, int a3);
signed int __fastcall sub_A558(int a1, int a2);
signed int __fastcall sub_A5B4(int a1, int a2, int a3);
signed int __fastcall sub_A5BC(int a1, int a2, int a3);
int __fastcall sub_A670(int a1, int a2, char a3);
void __fastcall sub_A794(int a1, int a2, int a3);
int __fastcall sub_A85C(int a1, int a2, int a3, int a4, int a5);
int __fastcall sub_A874(int _R0);
int __fastcall sub_A87C(int _R0);
int __fastcall sub_A884(int _R0);
void sub_A88C();
void sub_A8D0();
int __fastcall sub_A8E4(int a1, int a2);
signed int __fastcall sub_A928(int a1, int a2, _DWORD *a3);
signed int __fastcall sub_A956(int a1, int a2, int a3);
signed int __fastcall sub_A99A(int a1, int a2, _QWORD *a3);
signed int __fastcall sub_A9CA(int a1, int a2, int a3, int a4);
int __fastcall sub_AA02(int a1);
signed int __fastcall sub_AA08(int a1, int a2);
signed int __fastcall sub_AA26(int a1);
int __fastcall sub_AA38(int a1);
int __fastcall sub_AA3E(int a1, int a2);
int __fastcall sub_AA60(int a1, signed int a2);
int __fastcall sub_AAEC(int result, signed int a2, int a3);
int __fastcall sub_AB78(int a1, int a2);
__int64 __fastcall sub_AB9C(int a1, int a2);
int __fastcall sub_AC40(int a1, int a2, int a3, int a4);
signed int __fastcall sub_AD0C(int a1);
int __fastcall sub_AD5C(int a1, int a2);
void __fastcall sub_AD74(int a1);
int __fastcall sub_AD8A(int a1);
signed int __fastcall sub_AD90(int a1, int a2, int a3, _DWORD *a4);
int __fastcall sub_AE00(int a1, int a2);
const char *__fastcall sub_AE70(int a1, int a2);
int __fastcall sub_AE76(int result);
void __fastcall sub_AE80(int a1, int a2, int a3, int a4);
signed int __fastcall sub_AEAC(int a1);
int __fastcall sub_AF00(int a1);
int sub_AF58(); // weak
int __fastcall sub_B0FC(int a1, int a2, int a3, _DWORD *a4, int a5, int a6, int a7, _DWORD *a8);
int sub_B58C(); // weak
int __fastcall sub_B5A0(int _R0);
int __fastcall sub_B5A8(int _R0);
int __fastcall sub_B5B0(int _R0);
int __fastcall sub_B5B8(_DWORD *a1);
int __fastcall sub_B5FC(_DWORD *a1);
void j_j_free(void *ptr);
void j_free(void *ptr);
int j_j_pthread_mutex_unlock(pthread_mutex_t *mutex);
int j_pthread_mutex_unlock(pthread_mutex_t *mutex);
char *j_j_strdup(const char *s);
char *j_strdup(const char *s);
void sub_B640();
void sub_B644();
int __fastcall sub_B650(_DWORD *a1);
int __fastcall sub_B654(_DWORD *a1);

//-------------------------------------------------------------------------
// Data declarations

int dword_6BC0[4] = { 2, 48000, 2048, 2 }; // weak
_UNKNOWN unk_D192; // weak
_UNKNOWN unk_E9B0; // weak
_UNKNOWN unk_EC90; // weak
_DWORD dword_ED40[32] =
{
  8000,
  16,
  11025,
  16,
  12000,
  16,
  16000,
  8,
  22050,
  8,
  24000,
  8,
  32000,
  4,
  44100,
  4,
  48000,
  4,
  64000,
  2,
  88200,
  2,
  96000,
  2,
  128000,
  1,
  176400,
  1,
  192000,
  1,
  0,
  0
}; // idb
_WORD word_EE88[256] =
{
  33412,
  34436,
  35460,
  36484,
  37508,
  38532,
  39556,
  40580,
  41604,
  42628,
  43652,
  44676,
  45700,
  46724,
  47748,
  48772,
  49540,
  50052,
  50564,
  51076,
  51588,
  52100,
  52612,
  53124,
  53636,
  54148,
  54660,
  55172,
  55684,
  56196,
  56708,
  57220,
  57604,
  57860,
  58116,
  58372,
  58628,
  58884,
  59140,
  59396,
  59652,
  59908,
  60164,
  60420,
  60676,
  60932,
  61188,
  61444,
  61636,
  61764,
  61892,
  62020,
  62148,
  62276,
  62404,
  62532,
  62660,
  62788,
  62916,
  63044,
  63172,
  63300,
  63428,
  63556,
  63652,
  63716,
  63780,
  63844,
  63908,
  63972,
  64036,
  64100,
  64164,
  64228,
  64292,
  64356,
  64420,
  64484,
  64548,
  64612,
  64660,
  64692,
  64724,
  64756,
  64788,
  64820,
  64852,
  64884,
  64916,
  64948,
  64980,
  65012,
  65044,
  65076,
  65108,
  65140,
  65164,
  65180,
  65196,
  65212,
  65228,
  65244,
  65260,
  65276,
  65292,
  65308,
  65324,
  65340,
  65356,
  65372,
  65388,
  65404,
  65416,
  65424,
  65432,
  65440,
  65448,
  65456,
  65464,
  65472,
  65480,
  65488,
  65496,
  65504,
  65512,
  65520,
  65528,
  65535,
  32124,
  31100,
  30076,
  29052,
  28028,
  27004,
  25980,
  24956,
  23932,
  22908,
  21884,
  20860,
  19836,
  18812,
  17788,
  16764,
  15996,
  15484,
  14972,
  14460,
  13948,
  13436,
  12924,
  12412,
  11900,
  11388,
  10876,
  10364,
  9852,
  9340,
  8828,
  8316,
  7932,
  7676,
  7420,
  7164,
  6908,
  6652,
  6396,
  6140,
  5884,
  5628,
  5372,
  5116,
  4860,
  4604,
  4348,
  4092,
  3900,
  3772,
  3644,
  3516,
  3388,
  3260,
  3132,
  3004,
  2876,
  2748,
  2620,
  2492,
  2364,
  2236,
  2108,
  1980,
  1884,
  1820,
  1756,
  1692,
  1628,
  1564,
  1500,
  1436,
  1372,
  1308,
  1244,
  1180,
  1116,
  1052,
  988,
  924,
  876,
  844,
  812,
  780,
  748,
  716,
  684,
  652,
  620,
  588,
  556,
  524,
  492,
  460,
  428,
  396,
  372,
  356,
  340,
  324,
  308,
  292,
  276,
  260,
  244,
  228,
  212,
  196,
  180,
  164,
  148,
  132,
  120,
  112,
  104,
  96,
  88,
  80,
  72,
  64,
  56,
  48,
  40,
  32,
  24,
  16,
  8,
  0
}; // idb
_DWORD out_channels_name_to_enum_table[2] = { 47696, 3 }; // idb
char *(*off_10AC4)[80] = &media_speaker; // weak
char *off_10BDC[10] =
{
  "EQ1 B1 Volume",
  "EQ1 B2 Volume",
  "EQ1 B3 Volume",
  "EQ1 B4 Volume",
  "EQ1 B5 Volume",
  "EQ2 B1 Volume",
  "EQ2 B2 Volume",
  "EQ2 B3 Volume",
  "EQ2 B4 Volume",
  "EQ2 B5 Volume"
}; // weak
char *off_10BF0[5] =
{
  "EQ2 B1 Volume",
  "EQ2 B2 Volume",
  "EQ2 B3 Volume",
  "EQ2 B4 Volume",
  "EQ2 B5 Volume"
}; // weak
void *off_10C0C = (void *)0xA75D; // weak
char **test_earphones_ptr[9] =
{
  &test_earphones,
  &test_headphone,
  &test_speaker,
  &test_pri_mic,
  &test_sec_mic,
  &test_ter_mic,
  &default_settings,
  &test_modem_loopback_earphone,
  &test_modem_loopback_headphone
}; // weak
char **test_headphone_ptr[8] =
{
  &test_headphone,
  &test_speaker,
  &test_pri_mic,
  &test_sec_mic,
  &test_ter_mic,
  &default_settings,
  &test_modem_loopback_earphone,
  &test_modem_loopback_headphone
}; // weak
char **test_pri_mic_ptr[6] =
{
  &test_pri_mic,
  &test_sec_mic,
  &test_ter_mic,
  &default_settings,
  &test_modem_loopback_earphone,
  &test_modem_loopback_headphone
}; // weak
char **test_sec_mic_ptr[5] =
{
  &test_sec_mic,
  &test_ter_mic,
  &default_settings,
  &test_modem_loopback_earphone,
  &test_modem_loopback_headphone
}; // weak
char **test_ter_mic_ptr[4] =
{
  &test_ter_mic,
  &default_settings,
  &test_modem_loopback_earphone,
  &test_modem_loopback_headphone
}; // weak
char **test_modem_loopback_earphone_ptr[2] = { &test_modem_loopback_earphone, &test_modem_loopback_headphone }; // weak
char **test_modem_loopback_headphone_ptr = &test_modem_loopback_headphone; // weak
void *off_11000 = &off_11000; // weak
_UNKNOWN pcm_config; // weak
_UNKNOWN unk_1100C; // weak
int dword_11010 = 4096; // weak
_UNKNOWN unk_11014; // weak
_UNKNOWN unk_11018; // weak
_UNKNOWN unk_1101C; // weak
_UNKNOWN unk_11020; // weak
_UNKNOWN unk_11024; // weak
_UNKNOWN unk_11028; // weak
_UNKNOWN unk_1102C; // weak
_UNKNOWN pcm_config_in; // weak
int dword_11034 = 48000; // weak
_UNKNOWN unk_11038; // weak
_UNKNOWN unk_11040; // weak
_UNKNOWN pcm_config_voice_call; // weak
_UNKNOWN unk_1105C; // weak
_UNKNOWN pcm_config_backend; // weak
_UNKNOWN unk_11084; // weak
_UNKNOWN unk_11088; // weak
_UNKNOWN unk_1108C; // weak
_UNKNOWN unk_11090; // weak
_UNKNOWN unk_11094; // weak
_UNKNOWN unk_11098; // weak
_UNKNOWN unk_1109C; // weak
_UNKNOWN unk_110A0; // weak
_UNKNOWN unk_110A4; // weak
_UNKNOWN pcm_config_sco; // weak
_UNKNOWN pcm_config_amplifier; // weak
_UNKNOWN unk_110D4; // weak
_UNKNOWN unk_110D8; // weak
_UNKNOWN unk_110DC; // weak
_UNKNOWN unk_110E0; // weak
_UNKNOWN unk_110E4; // weak
_UNKNOWN unk_110E8; // weak
_UNKNOWN unk_110EC; // weak
_UNKNOWN unk_110F0; // weak
_UNKNOWN unk_110F4; // weak
char *default_settings = "ES705 RX1 Enable"; // weak
char *test_speaker = "IN2MUX Input"; // weak
int dword_116C8; // weak
int dword_116CC; // weak
int dword_116D0; // weak
char byte_116D4; // weak
int dword_116D8; // weak
int dword_116DC; // weak
_UNKNOWN unk_116E0; // weak
// extern _UNKNOWN _stack_chk_guard; weak
// extern struct _IO_FILE *stderr;


//----- (0000302C) --------------------------------------------------------
void __fastcall j_audio_route_free(int a1)
{
  audio_route_free(a1);
}

//----- (00003038) --------------------------------------------------------
_DWORD *__fastcall j_audio_route_init(int a1, const char *a2)
{
  return audio_route_init(a1, a2);
}

//----- (00003074) --------------------------------------------------------
unsigned int __fastcall j_audio_route_reset(int a1)
{
  return audio_route_reset(a1);
}

//----- (00003080) --------------------------------------------------------
signed int __fastcall j_audio_route_apply_path(int a1, const char *a2)
{
  return audio_route_apply_path(a1, a2);
}

//----- (0000308C) --------------------------------------------------------
int __fastcall j_audio_route_update_mixer(int a1)
{
  return audio_route_update_mixer(a1);
}

//----- (0000314C) --------------------------------------------------------
signed int __fastcall j_wav_player_start(const char *a1, int a2, int a3)
{
  return wav_player_start(a1, a2, a3);
}

//----- (000031C4) --------------------------------------------------------
int __fastcall j_thread_refresh_audio_route(int a1)
{
  return thread_refresh_audio_route(a1);
}

//----- (00003248) --------------------------------------------------------
int __fastcall j_cvq_init(int a1)
{
  return cvq_init(a1);
}

//----- (00003260) --------------------------------------------------------
signed int __fastcall j_get_output_device_id(int a1, unsigned int a2)
{
  return get_output_device_id(a1, a2);
}

//----- (0000326C) --------------------------------------------------------
signed int __fastcall j_get_input_source_id(int a1, int a2)
{
  return get_input_source_id(a1, a2);
}

//----- (000032F0) --------------------------------------------------------
int j_is_headphone_on()
{
  return is_headphone_on();
}

//----- (00003308) --------------------------------------------------------
int __fastcall j_amplifier_calibrate(int a1)
{
  return amplifier_calibrate(a1);
}

//----- (00003374) --------------------------------------------------------
int __fastcall j_pcm_data_dump(const char *a1, int a2, int a3, int a4)
{
  return pcm_data_dump(a1, a2, a3, a4);
}

//----- (00003494) --------------------------------------------------------
signed int __fastcall j_set_value(int a1, const char *a2)
{
  return set_value(a1, a2);
}

//----- (000034A0) --------------------------------------------------------
int __fastcall j_uart_dev_read_wrapper(int a1, int a2, int a3, int a4, int a5)
{
  return uart_dev_read_wrapper(a1, a2, a3, a4, a5);
}

//----- (000034AC) --------------------------------------------------------
int __fastcall j_cvq_start_decode(int a1)
{
  return cvq_start_decode(a1);
}

//----- (000034B8) --------------------------------------------------------
signed int __fastcall j_uart_read_wrapper(int a1, int a2, int a3)
{
  return uart_read_wrapper(a1, a2, a3);
}

//----- (00003500) --------------------------------------------------------
int sub_3500()
{
  return _cxa_finalize(&off_11000);
}
// 2F48: using guessed type int __fastcall _cxa_finalize(_DWORD);
// 11000: using guessed type void *off_11000;

//----- (00003520) --------------------------------------------------------
int (*__fastcall sub_3520(int (*result)(void)))(void)
{
  if ( result )
    result = (int (*)(void))result();
  return result;
}

//----- (000035E0) --------------------------------------------------------
int __fastcall pcm_data_dump(const char *a1, int a2, int a3, int a4)
{
  const char *v4; // r6@1
  int v5; // r9@1
  int v6; // r10@1
  int v7; // r0@2
  int v8; // r4@3
  int v9; // r0@9
  FILE *v10; // r6@10
  const char *v11; // r1@12
  const char *v12; // r2@12
  int *v13; // r0@13
  char *v14; // r0@13
  int result; // r0@15
  int v16; // [sp+8h] [bp-4h]@1
  int v17; // [sp+Ch] [bp+0h]@1
  int v18; // [sp+68h] [bp+5Ch]@4

  v4 = a1;
  v5 = a3;
  v6 = a2;
  v16 = _stack_chk_guard;
  property_get(a4, &v17, "0");
  if ( !atoi((const char *)&v17) )
    goto LABEL_15;
  LOBYTE(v7) = *v4;
  if ( *v4 )
  {
    v8 = 0;
    do
    {
      *((_BYTE *)&v18 + v8) = v7;
      if ( v8 && v4[v8] == 47 )
      {
        *((_BYTE *)&v18 + v8) = 0;
        if ( access((const char *)&v18, 0) && mkdir((const char *)&v18, 0x1F8u) == -1 )
        {
          v13 = (int *)_errno(-1);
          v14 = strerror(*v13);
          _android_log_print(6, "audio_hw_primary", "Failed to create directory: %s", v14);
          v11 = "audio_hw_primary";
          v12 = "The file path isn't valid";
LABEL_14:
          _android_log_print(6, v11, v12);
          goto LABEL_15;
        }
        *((_BYTE *)&v18 + v8) = 47;
      }
      v9 = (int)&v4[v8++];
      v7 = *(_BYTE *)(v9 + 1);
    }
    while ( v7 );
  }
  v10 = fopen(v4, "ab+");
  if ( !v10 )
  {
    v11 = "audio_hw_primary";
    v12 = "Failed to open the file";
    goto LABEL_14;
  }
  _fwrite_chk(v6, 1, v5, v10);
  fclose(v10);
LABEL_15:
  result = _stack_chk_guard - v16;
  if ( _stack_chk_guard != v16 )
    _stack_chk_fail(result);
  return result;
}
// 2F6C: using guessed type int __fastcall property_get(_DWORD, _DWORD, _DWORD);
// 2FA8: using guessed type int __fastcall _fwrite_chk(_DWORD, _DWORD, _DWORD, _DWORD);
// 2FC0: using guessed type int __fastcall _errno(_DWORD);
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);

//----- (000036FC) --------------------------------------------------------
signed int __fastcall get_output_device_id(int a1, unsigned int a2)
{
  unsigned int v2; // r4@1
  int v3; // r5@1
  unsigned int v4; // r0@2
  signed int result; // r0@3
  bool v6; // zf@3
  bool v7; // zf@8
  unsigned int v8; // r0@12
  bool v9; // zf@16

  v2 = a2;
  v3 = a1;
  if ( !a2 )
    return 8;
  v4 = ((a2 - ((a2 >> 1) & 0x55555555)) & 0x33333333) + (((a2 - ((a2 >> 1) & 0x55555555)) >> 2) & 0x33333333);
  if ( 2 != 16843009 * ((v4 + (v4 >> 4)) & 0xF0F0F0F) >> 24 )
  {
LABEL_12:
    v8 = ((v2 - ((v2 >> 1) & 0x55555555)) & 0x33333333) + (((v2 - ((v2 >> 1) & 0x55555555)) >> 2) & 0x33333333);
    if ( 1 == 16843009 * ((v8 + (v8 >> 4)) & 0xF0F0F0F) >> 24 )
    {
      if ( (signed int)v2 <= 15 )
      {
        result = 0;
        switch ( v2 )
        {
          case 1u:
            result = 5;
            break;
          default:
            return 8;
          case 2u:
            return result;
          case 4u:
            result = 1;
            break;
          case 8u:
            result = 2;
            break;
        }
        return result;
      }
      v9 = v2 == 16;
      if ( v2 != 16 )
        v9 = v2 == 32;
      if ( v9 || v2 == 64 )
        return 3;
    }
    return 8;
  }
  result = 4;
  v6 = a2 == 6;
  if ( a2 != 6 )
    v6 = a2 == 10;
  if ( !v6 )
  {
    if ( *(_DWORD *)(v3 + 168) != 1 )
      goto LABEL_27;
    result = 6;
    if ( a2 != 18 )
    {
      v7 = a2 == 34;
      if ( a2 != 34 )
        v7 = a2 == 66;
      if ( !v7 )
      {
LABEL_27:
        v2 = a2 & 0xFFFFFFFD;
        _android_log_print(
          2,
          "audio_hw_primary",
          "%s(): change two output devices to one: %x",
          "get_output_device_id",
          a2 & 0xFFFFFFFD);
        *(_DWORD *)(v3 + 172) = v2;
        _android_log_print(3, "audio_hw_primary", "%s(): adev->out_device=%x", "get_output_device_id", v2);
        goto LABEL_12;
      }
    }
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00003800) --------------------------------------------------------
signed int __fastcall get_input_source_id(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r5@1
  signed int result; // r0@3

  v2 = a1;
  v3 = *(_DWORD *)(a1 + 252);
  if ( (*(_DWORD *)(a1 + 168) & 0xFFFFFFFE) == 2 )
    *(_BYTE *)(a1 + 313) = 0;
  result = 11;
  switch ( a2 )
  {
    case 1:
      _android_log_print(2, "audio_hw_primary", "%s(): mic_nr_off=%d", "get_input_source_id", *(_BYTE *)(v2 + 184));
      result = *(_BYTE *)(v2 + 184);
      break;
    case 4:
      _android_log_print(
        2,
        "audio_hw_primary",
        "%s(): voice_call_wb=%d, bluetooth_nrec=%d",
        "get_input_source_id",
        *(_BYTE *)(v2 + 183),
        *(_BYTE *)(v2 + 182));
      if ( *(_BYTE *)(v2 + 183) )
      {
        result = 6;
        if ( *(_BYTE *)(v2 + 182) )
          result = 5;
      }
      else
      {
        result = 4;
        if ( *(_BYTE *)(v2 + 182) )
          result = 3;
      }
      break;
    case 5:
      result = 7;
      break;
    case 6:
      _android_log_print(
        2,
        "audio_hw_primary",
        "%s(): voice recognition: rate=%d, asr_ready=%d",
        "get_input_source_id",
        unk_11034,
        *(_BYTE *)(v2 + 313));
      if ( v3 && *(_DWORD *)(v3 + 72) && unk_11034 == 16000 )
      {
        result = 8;
      }
      else
      {
        result = *(_BYTE *)(v2 + 313);
        if ( *(_BYTE *)(v2 + 313) )
          result = 2;
      }
      break;
    case 7:
      result = 9;
      break;
    default:
      return result;
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00003908) --------------------------------------------------------
int __fastcall thread_refresh_audio_route(int a1)
{
  int v1; // r8@1
  int v2; // r5@1
  int v3; // r0@2
  int v4; // r6@2
  int v5; // r7@3
  const char *v6; // r1@5
  const char *v7; // r2@5
  const char *v8; // r3@5
  signed int v9; // r0@7
  _DWORD *v10; // r0@8
  int v11; // r6@10
  int v12; // r7@12
  int v13; // r5@14
  int v14; // r0@17
  int v15; // r0@18

  v1 = a1;
  _android_log_print(3, "audio_hw_primary", "%s(): enter", "thread_refresh_audio_route");
  v2 = 0;
  while ( 1 )
  {
    v3 = mixer_open(0);
    v4 = v3;
    if ( !v3 )
    {
      v6 = "audio_hw_primary";
      v7 = "%s(): Unable to open mixer";
      v8 = "thread_refresh_audio_route";
      goto LABEL_7;
    }
    v5 = mixer_get_ctl_by_name(v3);
    mixer_close(v4);
    if ( v5 )
      break;
    usleep(0xC350u);
    if ( ++v2 >= 500 )
    {
      v6 = "audio_hw_primary";
      v7 = "%s(): Waiting for escore being ready timeout";
      v8 = "thread_refresh_audio_route";
LABEL_7:
      v9 = 6;
      goto LABEL_24;
    }
  }
  pthread_mutex_lock((pthread_mutex_t *)(v1 + 164));
  j_audio_route_free(*(_DWORD *)(v1 + 188));
  v10 = j_audio_route_init(0, "/system/etc/mixer_paths.xml");
  *(_DWORD *)(v1 + 188) = v10;
  if ( !v10 )
    _android_log_print(6, "audio_hw_primary", "%s(): failed to open audio route", "thread_refresh_audio_route");
  pthread_mutex_unlock((pthread_mutex_t *)(v1 + 164));
  pthread_mutex_lock((pthread_mutex_t *)(v1 + 164));
  v11 = pcm_open(0, 2, 0, &pcm_config_amplifier);
  if ( v11 && !pcm_is_ready() )
  {
    v14 = pcm_get_error(v11);
    _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(BACKEND) failed: %s", "amplifier_initialize", v14);
    v13 = 0;
  }
  else
  {
    pcm_prepare(v11);
    v12 = pcm_open(0, 6, 0x10000000, &pcm_config_amplifier);
    if ( v12 && !pcm_is_ready() )
    {
      v15 = pcm_get_error(v12);
      _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(AMPLIFIER) failed: %s", "amplifier_initialize", v15);
      v13 = 0;
    }
    else
    {
      pcm_prepare(v12);
      j_audio_route_reset(*(_DWORD *)(v1 + 188));
      j_audio_route_apply_path(*(_DWORD *)(v1 + 188), "speaker");
      j_audio_route_update_mixer(*(_DWORD *)(v1 + 188));
      pthread_mutex_unlock((pthread_mutex_t *)(v1 + 164));
      usleep(0x3E8u);
      v13 = NxpTfa98xx_StartUp(unk_110D4);
      if ( v13 )
        _android_log_print(6, "audio_hw_primary", "%s(): failed to bring up tfa98xx", "amplifier_initialize");
      usleep(0x3E8u);
    }
    pcm_close(v12);
  }
  pcm_close(v11);
  pthread_mutex_unlock((pthread_mutex_t *)(v1 + 164));
  if ( v13 )
    _android_log_print(
      6,
      "audio_hw_primary",
      "%s(): failed to bring up amplifier, speaker will be silent",
      "thread_refresh_audio_route");
  else
    property_set("primary.pa.ready", "1");
  v9 = 3;
  v6 = "audio_hw_primary";
  v7 = "%s(): leave";
  v8 = "thread_refresh_audio_route";
LABEL_24:
  _android_log_print(v9, v6, v7, v8);
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FF0: using guessed type int __fastcall mixer_open(_DWORD);
// 2FFC: using guessed type int __fastcall mixer_get_ctl_by_name(_DWORD);
// 3008: using guessed type int __fastcall mixer_close(_DWORD);
// 3050: using guessed type int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD);
// 305C: using guessed type int pcm_is_ready(void);
// 3068: using guessed type int __fastcall pcm_prepare(_DWORD);
// 3098: using guessed type int __fastcall NxpTfa98xx_StartUp(_DWORD);
// 30A4: using guessed type int __fastcall pcm_get_error(_DWORD);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 30BC: using guessed type int __fastcall property_set(_DWORD, _DWORD);

//----- (00003B64) --------------------------------------------------------
int __fastcall test_set_hifi_gain(int result)
{
  dword_116C8 = result;
  return result;
}
// 116C8: using guessed type int dword_116C8;

//----- (00003B70) --------------------------------------------------------
int __fastcall wav_player_stop(int result)
{
  dword_116CC = result;
  return result;
}
// 116CC: using guessed type int dword_116CC;

//----- (00003B7C) --------------------------------------------------------
signed int __fastcall wav_player_start(const char *a1, int a2, int a3)
{
  const char *v3; // r5@1
  int v4; // r9@1
  int v5; // r6@1
  FILE *v6; // r4@1
  __int32 v7; // r1@8
  signed int result; // r0@11
  int *v9; // r0@12
  char *v10; // r0@12
  unsigned int v11; // r10@13
  unsigned int v12; // r7@13
  int v13; // r8@14
  signed int v14; // r0@16
  int v15; // r0@20
  int v16; // r5@20
  signed int v17; // ST18_4@21
  signed int v18; // r6@21
  signed int v19; // r7@21
  signed int v20; // r10@21
  signed int v21; // r11@21
  int v22; // r5@22
  int v23; // r6@24
  int v24; // r5@26
  int v25; // r0@26
  signed int v26; // r9@26
  void *v27; // r11@26
  int v28; // r7@27
  int *v29; // r5@27
  int *v30; // r6@27
  signed int v31; // r11@29
  void *v32; // r9@29
  int v34; // r3@30
  _BYTE *v35; // r1@30
  int v36; // r2@30
  int v37; // r6@31
  unsigned int v38; // r6@31
  int v45; // r2@32
  const char *v46; // r1@38
  const char *v47; // r2@38
  int *v48; // r5@42
  int v49; // [sp+0h] [bp-90h]@6
  unsigned int v50; // [sp+Ch] [bp-84h]@21
  int v51; // [sp+Ch] [bp-84h]@27
  unsigned int v52; // [sp+10h] [bp-80h]@21
  unsigned int size; // [sp+14h] [bp-7Ch]@13
  int sizea; // [sp+14h] [bp-7Ch]@27
  void *ptr; // [sp+18h] [bp-78h]@26
  char v56; // [sp+1Ch] [bp-74h]@9
  unsigned __int16 v57; // [sp+1Eh] [bp-72h]@13
  unsigned int v58; // [sp+20h] [bp-70h]@13
  unsigned __int16 v59; // [sp+2Ah] [bp-66h]@13
  int v60; // [sp+2Ch] [bp-64h]@6
  __int32 off; // [sp+30h] [bp-60h]@8
  int v62; // [sp+34h] [bp-5Ch]@2
  int v63; // [sp+3Ch] [bp-54h]@3
  int v64; // [sp+40h] [bp-50h]@13
  int v65; // [sp+44h] [bp-4Ch]@13
  int v66; // [sp+48h] [bp-48h]@13
  int v67; // [sp+4Ch] [bp-44h]@13
  int v68; // [sp+50h] [bp-40h]@17
  int v69; // [sp+54h] [bp-3Ch]@20
  int v70; // [sp+58h] [bp-38h]@20
  int v71; // [sp+5Ch] [bp-34h]@20
  int v72; // [sp+68h] [bp-28h]@1

  v3 = a1;
  v4 = a2;
  v5 = a3;
  v72 = _stack_chk_guard;
  dword_116CC = 0;
  _android_log_print(3, "audio_hw_primary", "%s(): ...", "wav_player_start");
  v6 = fopen(v3, "rb");
  if ( !v6 )
  {
    v9 = (int *)_errno(0);
    v10 = strerror(*v9);
    _android_log_print(6, "audio_hw_primary", "Unable to open file '%s' [%s]", v3, v10);
    result = 1;
    goto LABEL_47;
  }
  _fread_chk(&v62, 12, 1, v6);
  if ( v62 != 1179011410 || v63 != 1163280727 )
  {
    _android_log_print(6, "audio_hw_primary", "Error: '%s' is not a riff/wave file", v3, 12);
    fclose(v6);
    result = 1;
    goto LABEL_47;
  }
  while ( 1 )
  {
    v49 = 8;
    _fread_chk(&v60, 8, 1, v6);
    if ( v60 != 544501094 )
      break;
    _fread_chk(&v56, 16, 1, v6);
    if ( (unsigned int)off >= 0x11 )
    {
      v7 = off - 16;
LABEL_5:
      fseek(v6, v7, 1);
    }
  }
  if ( v60 != 1635017060 )
  {
    v7 = off;
    goto LABEL_5;
  }
  v11 = v57;
  v12 = v59;
  size = v58;
  v64 = v57;
  v65 = v58;
  v66 = 1024;
  v67 = 4;
  if ( v59 == 16 )
  {
    v13 = v5;
    v68 = 0;
  }
  else
  {
    v13 = v5;
    if ( v59 == 24 )
    {
      v14 = 3;
LABEL_19:
      v68 = v14;
    }
    else if ( v59 == 32 )
    {
      v14 = 1;
      goto LABEL_19;
    }
  }
  v69 = 0;
  v70 = 0;
  v71 = 0;
  v15 = pcm_params_get(v4, v13, 0);
  v16 = v15;
  if ( !v15 )
  {
    v46 = "audio_hw_primary";
    v47 = "Unable to open PCM device %u.";
LABEL_41:
    _android_log_print(6, v46, v47, v13, v49);
    goto LABEL_46;
  }
  v17 = sub_43AC(v15, 6, size, (int)"Sample rate", (int)"Hz");
  v50 = v11;
  v18 = sub_43AC(v16, 5, v11, (int)"Sample", (int)" channels");
  v52 = v12;
  v19 = sub_43AC(v16, 3, v12, (int)"Bitrate", (int)" bits");
  v20 = sub_43AC(v16, 8, 0x400u, (int)"Period size", (int)"Hz");
  v21 = sub_43AC(v16, 10, 4u, (int)"Period count", (int)"Hz");
  pcm_params_free(v16);
  if ( !(v17 & v18 & v19 & v20 & v21) )
    goto LABEL_46;
  v22 = 0;
  dword_116D0 = pcm_open(v4, v13, 0, &v64);
  if ( !dword_116D0 )
  {
LABEL_40:
    v49 = pcm_get_error(v22);
    v46 = "audio_hw_primary";
    v47 = "Unable to open PCM device %u (%s)";
    goto LABEL_41;
  }
  if ( !pcm_is_ready() )
  {
    v22 = dword_116D0;
    goto LABEL_40;
  }
  v23 = mixer_open(1);
  if ( v23 )
  {
    _android_log_print(3, "audio_hw_primary", "%s(): set hifi gain: %d, %d", "play_sample", dword_116C8, 12);
    sub_4364(v23, (int)"Gain selection", dword_116C8);
    sub_4364(v23, (int)"Master Playback Volume", 12);
    sub_4364(v23, (int)"Filter Shape", 1);
    sub_4364(v23, (int)"bypass IIR", 1);
    sub_4364(v23, (int)"THD Compensation", 1);
    sub_4364(v23, (int)"2nd Harmonic Compensation", 0);
    sub_4364(v23, (int)"3nd Harmonic Compensation", 254);
    mixer_close(v23);
  }
  v24 = dword_116D0;
  v25 = pcm_get_buffer_size(dword_116D0);
  v26 = pcm_frames_to_bytes(v24, v25);
  v27 = malloc(v26);
  ptr = v27;
  if ( v27 )
  {
    _android_log_print(3, "audio_hw_primary", "Playing sample: %u ch, %u hz, %u bit\n", v50, size, v52);
    signal(2, (__sighandler_t)sub_4394);
    v28 = v26 / 4;
    v29 = &dword_116D0;
    v30 = &dword_116CC;
    sizea = 3 * (v26 / 4);
    v51 = (int)v27 + 1;
    do
    {
      if ( v52 == 24 )
      {
        v31 = v26;
        v32 = malloc(sizea);
        _R10 = _fread_chk(v32, 1, sizea, v6);
        if ( v31 >= 4 )
        {
          v34 = v51;
          v35 = (char *)v32 + 2;
          v36 = 0;
          do
          {
            *(_BYTE *)(v34 - 1) = *(v35 - 2);
            v37 = 3 * v36++;
            *(_BYTE *)v34 = *((_BYTE *)v32 + v37 + 1);
            v38 = *v35;
            v35 += 3;
            *(_BYTE *)(v34 + 1) = v38;
            *(_BYTE *)(v34 + 2) = v38 >> 7;
            v34 += 4;
          }
          while ( v36 < v28 );
        }
        free(v32);
        _R0 = 1431655766;
        __asm { SMMUL.W         R0, R10, R0 }
        v26 = v31;
        v27 = ptr;
        v29 = &dword_116D0;
        v30 = &dword_116CC;
        v45 = 4 * (_R0 + (_R0 >> 31));
      }
      else
      {
        v45 = _fread_chk(v27, 1, v26, v6);
      }
      if ( v45 < 1 )
        break;
      if ( pcm_write(*v29, v27) )
      {
        _android_log_print(6, "audio_hw_primary", "Error playing sample");
        break;
      }
    }
    while ( !*v30 );
    free(v27);
    v48 = &dword_116D0;
  }
  else
  {
    _android_log_print(6, "audio_hw_primary", "Unable to allocate %d bytes", v26);
    v48 = &dword_116D0;
  }
  pcm_close(*v48);
  *v48 = 0;
LABEL_46:
  fclose(v6);
  result = 0;
LABEL_47:
  if ( _stack_chk_guard != v72 )
    _stack_chk_fail(result);
  return result;
}
// 2FC0: using guessed type int __fastcall _errno(_DWORD);
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 2FF0: using guessed type int __fastcall mixer_open(_DWORD);
// 3008: using guessed type int __fastcall mixer_close(_DWORD);
// 3050: using guessed type int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD);
// 305C: using guessed type int pcm_is_ready(void);
// 30A4: using guessed type int __fastcall pcm_get_error(_DWORD);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 30C8: using guessed type int __fastcall _fread_chk(_DWORD, _DWORD, _DWORD, _DWORD);
// 30E0: using guessed type int __fastcall pcm_params_get(_DWORD, _DWORD, _DWORD);
// 30EC: using guessed type int __fastcall pcm_params_free(_DWORD);
// 30F8: using guessed type int __fastcall pcm_get_buffer_size(_DWORD);
// 3104: using guessed type int __fastcall pcm_frames_to_bytes(_DWORD, _DWORD);
// 3134: using guessed type int __fastcall pcm_write(_DWORD, _DWORD);
// 116C8: using guessed type int dword_116C8;
// 116CC: using guessed type int dword_116CC;
// 116D0: using guessed type int dword_116D0;

//----- (00004088) --------------------------------------------------------
int is_headphone_on()
{
  FILE *v0; // r4@1
  int result; // r0@3
  char nptr; // [sp+Bh] [bp-Dh]@1
  int v3; // [sp+Ch] [bp-Ch]@1

  v3 = _stack_chk_guard;
  v0 = fopen("/sys/class/switch/h2w/state", "r");
  nptr = 0;
  if ( v0 )
  {
    _fread_chk(&nptr, 1, 1, v0);
    fclose(v0);
  }
  result = atoi(&nptr) != 0;
  if ( _stack_chk_guard != v3 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 30C8: using guessed type int __fastcall _fread_chk(_DWORD, _DWORD, _DWORD, _DWORD);

//----- (000040F8) --------------------------------------------------------
int __fastcall amplifier_calibrate(int a1)
{
  int v1; // r4@1
  int v2; // r0@3
  int v3; // r5@3

  v1 = a1;
  if ( *(_DWORD *)(a1 + 228) && *(_DWORD *)(a1 + 244) )
  {
    j_audio_route_reset(*(_DWORD *)(a1 + 188));
    j_audio_route_apply_path(*(_DWORD *)(v1 + 188), "speaker");
    j_audio_route_update_mixer(*(_DWORD *)(v1 + 188));
    v2 = usleep(0x2710u);
    v3 = NxpTfa98xx_ReCalibrate(v2);
    if ( v3 )
      _android_log_print(6, "audio_hw_primary", "failed to calibrate tfa98xx: %d", v3);
    usleep(0x2710u);
    j_audio_route_reset(*(_DWORD *)(v1 + 188));
    j_audio_route_apply_path(*(_DWORD *)(v1 + 188), "dummy");
    j_audio_route_update_mixer(*(_DWORD *)(v1 + 188));
  }
  else
  {
    _android_log_print(6, "audio_hw_primary", "not open pcm devices yet");
    v3 = -22;
  }
  return v3;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 3140: using guessed type int __fastcall NxpTfa98xx_ReCalibrate(_DWORD);

//----- (00004198) --------------------------------------------------------
int thread_test_hifi()
{
  j_wav_player_start("/data/data/factory_test.wav", 1, 0);
  return 0;
}

//----- (000041B0) --------------------------------------------------------
signed int __fastcall adev_set_headset_volume(int a1, int _R1)
{
  int v2; // r8@1
  signed int result; // r0@1
  int v4; // r2@1
  signed int v9; // r4@4
  char v11; // [sp+16h] [bp-32h]@5
  char v12; // [sp+1Fh] [bp-29h]@4
  int v13; // [sp+28h] [bp-20h]@1

  v2 = a1;
  v13 = _stack_chk_guard;
  result = -22;
  v4 = *(_DWORD *)(v2 + 168);
  _ZF = v4 == 2;
  if ( v4 != 2 )
    _ZF = (*(_DWORD *)(v2 + 172) & 0xC) == 0;
  if ( !_ZF )
  {
    __asm
    {
      VMOV            S0, R1
      VCVT.F64.F32    D16, S0
    }
    v9 = 0;
    __asm { VSTR            D16, [SP,#0x48+var_40] }
    _snprintf_chk(&v12, 9, 0, 9);
    _R7 = &unk_E9B0;
    while ( 1 )
    {
      __asm
      {
        VLDR            S0, [R7]
        VCVT.F64.F32    D16, S0
        VSTR            D16, [SP,#0x48+var_40]
      }
      _snprintf_chk(&v11, 9, 0, 9);
      if ( !strncmp(&v12, &v11, 9u) )
        break;
      ++v9;
      _R7 = (char *)_R7 + 12;
      if ( v9 >= 61 )
        goto LABEL_11;
    }
    *(_DWORD *)(v2 + 272) = v9;
    if ( *(_BYTE *)(v2 + 289) )
      sub_427C(v2);
    else
      sub_42F0(v2);
LABEL_11:
    result = 0;
  }
  if ( _stack_chk_guard != v13 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3158: using guessed type int __fastcall _snprintf_chk(_DWORD, _DWORD, _DWORD, _DWORD);

//----- (0000427C) --------------------------------------------------------
unsigned int __fastcall sub_427C(int a1)
{
  int v1; // r4@1
  int v2; // r5@2
  int v3; // r0@3

  v1 = a1;
  if ( *(_DWORD *)(a1 + 292) == 3 )
  {
    v2 = 0;
  }
  else
  {
    v3 = *(_DWORD *)(a1 + 272);
    if ( v3 == 60 )
    {
      v2 = 255;
    }
    else
    {
      v2 = *(_DWORD *)(v1 + 300) + 2 * v3;
      if ( *(_BYTE *)(v1 + 290) )
      {
        if ( v2 < 24 )
          v2 -= v2 / 2;
        else
          v2 -= 12;
      }
    }
  }
  _android_log_print(2, "audio_hw_primary", "%s(): volume=%d", "set_hifi_volume", v2);
  return sub_4364(*(_DWORD *)(v1 + 196), (int)"Master Playback Volume", v2);
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (000042F0) --------------------------------------------------------
unsigned int __fastcall sub_42F0(int a1)
{
  int v1; // r4@1
  unsigned int result; // r0@1
  int v3; // r0@2
  int v4; // r5@2
  bool v5; // zf@2

  v1 = a1;
  result = *(_BYTE *)(a1 + 172);
  if ( result & 0xC )
  {
    v3 = *(_DWORD *)(v1 + 168);
    v4 = 128;
    v5 = v3 == 1;
    if ( v3 != 1 )
      v5 = v3 == 3;
    if ( !v5 )
    {
      if ( v3 == 2 )
        v4 = 128 - 4 * *(_DWORD *)(v1 + 276);
      else
        v4 = 128 - 2 * *(_DWORD *)(v1 + 272);
    }
    _android_log_print(2, "audio_hw_primary", "%s(): headphone volume=%d", "set_headphone_volume", v4);
    result = sub_4364(*(_DWORD *)(v1 + 192), (int)"HPOUT Digital Volume", v4);
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00004364) --------------------------------------------------------
unsigned int __fastcall sub_4364(int a1, int a2, int a3)
{
  int v3; // r4@1
  unsigned int result; // r0@1
  unsigned int v5; // r5@1
  unsigned int v6; // r6@3

  v3 = a3;
  result = mixer_get_ctl_by_name(a1);
  v5 = result;
  if ( result )
  {
    result = mixer_ctl_get_num_values(result);
    if ( result )
    {
      v6 = 0;
      do
      {
        mixer_ctl_set_value(v5, v6++, v3);
        result = mixer_ctl_get_num_values(v5);
      }
      while ( v6 < result );
    }
  }
  return result;
}
// 2FFC: using guessed type int __fastcall mixer_get_ctl_by_name(_DWORD);
// 3170: using guessed type int __fastcall mixer_ctl_get_num_values(_DWORD);
// 317C: using guessed type int __fastcall mixer_ctl_set_value(_DWORD, _DWORD, _DWORD);

//----- (00004394) --------------------------------------------------------
int *__fastcall sub_4394(int a1)
{
  int *result; // r0@1

  signal(a1, (__sighandler_t)1);
  result = &dword_116CC;
  dword_116CC = 1;
  return result;
}
// 116CC: using guessed type int dword_116CC;

//----- (000043AC) --------------------------------------------------------
signed int __fastcall sub_43AC(int a1, int a2, unsigned int a3, int a4, int a5)
{
  int v5; // r8@1
  unsigned int v6; // r5@1
  int v7; // r6@1
  int v8; // r7@1
  unsigned int v9; // r0@1
  signed int v10; // r4@2
  unsigned int v11; // r0@4

  v5 = a4;
  v6 = a3;
  v7 = a2;
  v8 = a1;
  v9 = pcm_params_get_min();
  if ( v9 <= v6 )
  {
    v10 = 1;
  }
  else
  {
    _android_log_print(6, "audio_hw_primary", "%s is %u%s, device only supports >= %u%s", v5, v6, a5, v9, a5);
    v10 = 0;
  }
  v11 = pcm_params_get_max(v8, v7);
  if ( v11 < v6 )
  {
    _android_log_print(6, "audio_hw_primary", "%s is %u%s, device only supports <= %u%s", v5, v6, a5, v11, a5);
    v10 = 0;
  }
  return v10;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 3188: using guessed type int pcm_params_get_min(void);
// 3194: using guessed type int __fastcall pcm_params_get_max(_DWORD, _DWORD);

//----- (00004424) --------------------------------------------------------
signed int __fastcall sub_4424(int a1, const char *a2, _DWORD *a3)
{
  int v3; // r6@1
  _DWORD *v4; // r5@1
  signed int result; // r0@2
  void *v6; // r4@3
  _DWORD *v7; // r0@4
  int v8; // r0@5
  int v9; // r0@6
  int v10; // r0@9
  char s1; // [sp+8h] [bp-118h]@7
  char v12; // [sp+88h] [bp-98h]@7
  int v13; // [sp+108h] [bp-18h]@1

  v3 = a1;
  v4 = a3;
  v13 = _stack_chk_guard;
  if ( strcmp(a2, "audio_hw_if") )
  {
    result = -22;
    goto LABEL_17;
  }
  v6 = calloc(1u, 0x140u);
  if ( !v6 )
    goto LABEL_16;
  *(_DWORD *)v6 = 1213678676;
  *((_DWORD *)v6 + 1) = 512;
  *((_DWORD *)v6 + 2) = v3;
  *((_DWORD *)v6 + 15) = sub_46E0;
  *((_DWORD *)v6 + 17) = sub_470A;
  *((_DWORD *)v6 + 18) = sub_4710;
  *((_DWORD *)v6 + 19) = sub_4824;
  *((_DWORD *)v6 + 21) = sub_482C;
  *((_DWORD *)v6 + 22) = sub_4B34;
  *((_DWORD *)v6 + 23) = sub_4B3C;
  *((_DWORD *)v6 + 27) = sub_4B48;
  *((_DWORD *)v6 + 28) = sub_4E6C;
  *((_DWORD *)v6 + 29) = sub_4FD0;
  *((_DWORD *)v6 + 30) = sub_5068;
  *((_DWORD *)v6 + 31) = sub_52B8;
  *((_DWORD *)v6 + 32) = sub_52F4;
  *((_DWORD *)v6 + 33) = sub_5520;
  *((_DWORD *)v6 + 34) = sub_55A0;
  *((_DWORD *)v6 + 26) = adev_set_headset_volume;
  *((_DWORD *)v6 + 24) = sub_55A4;
  v7 = j_audio_route_init(0, "/system/etc/mixer_paths.xml");
  *((_DWORD *)v6 + 47) = v7;
  if ( !v7 )
  {
    _android_log_print(6, "audio_hw_primary", "%s(): failed to open audio route, abort...", "adev_open");
LABEL_15:
    free(v6);
LABEL_16:
    result = -12;
    goto LABEL_17;
  }
  v8 = mixer_open(0);
  *((_DWORD *)v6 + 48) = v8;
  if ( !v8 )
  {
    _android_log_print(6, "audio_hw_primary", "%s(): failed to open mixer, abort...", "adev_open");
LABEL_14:
    j_audio_route_free(*((_DWORD *)v6 + 47));
    goto LABEL_15;
  }
  v9 = mixer_open(1);
  *((_DWORD *)v6 + 49) = v9;
  if ( !v9 )
  {
    _android_log_print(6, "audio_hw_primary", "%s(): failed to open HiFi mixer, abort...", "adev_open");
    mixer_close(*((_DWORD *)v6 + 48));
    goto LABEL_14;
  }
  *((_DWORD *)v6 + 50) = 0;
  *((_DWORD *)v6 + 42) = 0;
  *((_DWORD *)v6 + 52) = 0;
  *((_DWORD *)v6 + 53) = 0;
  *((_BYTE *)v6 + 260) = 0;
  *((_BYTE *)v6 + 268) = 0;
  *((_DWORD *)v6 + 66) = 48000;
  *((_DWORD *)v6 + 63) = 0;
  *((_BYTE *)v6 + 288) = 0;
  *((_BYTE *)v6 + 290) = 0;
  *((_BYTE *)v6 + 269) = 0;
  *(_QWORD *)((char *)v6 + 292) = -4294967296LL;
  *((_DWORD *)v6 + 68) = 28;
  *((_DWORD *)v6 + 69) = 56;
  *((_DWORD *)v6 + 70) = 7;
  *((_DWORD *)v6 + 71) = 7;
  *v4 = v6;
  Open();
  j_thread_refresh_audio_route((int)v6);
  property_get("ro.product.locale.region", &v12, "0");
  property_get("ro.product.locale.language", &s1, "0");
  _android_log_print(3, "audio_hw_primary", "%s:region=%s,language=%s", "adev_open", &v12, &s1);
  v10 = strcmp(&v12, "CN") || strcmp(&s1, "zh");
  *((_BYTE *)v6 + 304) = v10;
  _android_log_print(3, "audio_hw_primary", "%s:is_oversea=%d", "adev_open", v10);
  result = 0;
LABEL_17:
  if ( _stack_chk_guard != v13 )
    _stack_chk_fail(result);
  return result;
}
// 2F6C: using guessed type int __fastcall property_get(_DWORD, _DWORD, _DWORD);
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 2FF0: using guessed type int __fastcall mixer_open(_DWORD);
// 3008: using guessed type int __fastcall mixer_close(_DWORD);
// 31B8: using guessed type int Open(void);
// 4824: using guessed type int sub_4824();
// 4B34: using guessed type int sub_4B34();
// 4B3C: using guessed type int sub_4B3C();
// 55A0: using guessed type int sub_55A0();

//----- (000046E0) --------------------------------------------------------
int __fastcall sub_46E0(int a1)
{
  int v1; // r4@1

  v1 = a1;
  NxpTfa98xx_Stop();
  mixer_close(*(_DWORD *)(v1 + 196));
  mixer_close(*(_DWORD *)(v1 + 192));
  j_audio_route_free(*(_DWORD *)(v1 + 188));
  free((void *)v1);
  return 0;
}
// 3008: using guessed type int __fastcall mixer_close(_DWORD);
// 31D0: using guessed type int NxpTfa98xx_Stop(void);

//----- (0000470A) --------------------------------------------------------
int sub_470A()
{
  return 0;
}

//----- (00004710) --------------------------------------------------------
int __fastcall sub_4710(int a1, int a2)
{
  int v2; // r4@1
  int v8; // r8@1
  pthread_mutex_t *mutex; // [sp+10h] [bp-40h]@1
  char v12; // [sp+16h] [bp-3Ah]@2
  char v13; // [sp+1Fh] [bp-31h]@1
  int v14; // [sp+28h] [bp-28h]@1

  v2 = a1;
  _R5 = a2;
  v14 = _stack_chk_guard;
  mutex = (pthread_mutex_t *)(a1 + 164);
  pthread_mutex_lock((pthread_mutex_t *)(a1 + 164));
  __asm
  {
    VMOV            S0, R5
    VCVT.F64.F32    D16, S0
  }
  v8 = 0;
  __asm { VSTR            D16, [SP,#0x50+var_48] }
  _snprintf_chk(&v13, 9, 0, 9);
  _R9 = &unk_EC90;
  do
  {
    __asm
    {
      VLDR            S0, [R9,#-4]
      VCVT.F64.F32    D16, S0
      VSTR            D16, [SP,#0x50+var_48]
    }
    _snprintf_chk(&v12, 9, 0, 9);
    if ( !strncmp(&v13, &v12, 9u) )
    {
      _android_log_print(3, "audio_hw_primary", "%s(): voice volume = %s", "adev_set_voice_volume", &v13);
      if ( *(_BYTE *)(v2 + 172) & 0xC )
      {
        *(_DWORD *)(v2 + 276) = v8;
      }
      else
      {
        __asm
        {
          VLDR            S0, [R9]
          VCVTR.S32.F32   S0, S0
          VSTR            S0, [R4,#0x11C]
          VLDR            S0, [R9,#4]
          VCVTR.S32.F32   S0, S0
          VSTR            S0, [R4,#0x118]
        }
      }
    }
    ++v8;
    _R9 = (char *)_R9 + 12;
  }
  while ( v8 != 15 );
  if ( *(_DWORD *)(v2 + 168) == 2 )
    sub_55E8(v2);
  pthread_mutex_unlock(mutex);
  if ( _stack_chk_guard != v14 )
    _stack_chk_fail(_stack_chk_guard - v14);
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3158: using guessed type int __fastcall _snprintf_chk(_DWORD, _DWORD, _DWORD, _DWORD);

//----- (0000482C) --------------------------------------------------------
int __fastcall sub_482C(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r6@1
  int v4; // r0@2
  int v5; // r0@4
  int v6; // r0@7
  int v7; // r0@9
  int v8; // r0@12
  int v9; // r0@16
  int v10; // r6@18
  int v11; // r0@18
  int v12; // r0@19
  int v13; // r6@22
  int v14; // r0@22
  int v15; // r0@23
  int v16; // r0@25
  int v17; // r0@26
  int v18; // r0@29
  int v19; // r0@31

  v2 = a1;
  v3 = a2;
  _android_log_print(3, "audio_hw_primary", "%s(): mode change: (%d >> %d)", "adev_set_mode", *(_DWORD *)(a1 + 168), a2);
  pthread_mutex_lock((pthread_mutex_t *)(v2 + 164));
  if ( *(_DWORD *)(v2 + 168) == v3 )
    goto LABEL_37;
  *(_DWORD *)(v2 + 168) = v3;
  v4 = *(_DWORD *)(v2 + 208);
  if ( v3 != 2 )
  {
    if ( v4 )
    {
      _android_log_print(3, "audio_hw_primary", "Leaving IN_CALL state");
      *(_DWORD *)(v2 + 208) = 0;
      *(_DWORD *)(v2 + 200) = 0;
      _android_log_print(3, "audio_hw_primary", "%s():...", "end_call");
      v6 = *(_DWORD *)(v2 + 220);
      if ( v6 )
      {
        pcm_stop(v6);
        pcm_close(*(_DWORD *)(v2 + 220));
        *(_DWORD *)(v2 + 220) = 0;
      }
      v7 = *(_DWORD *)(v2 + 224);
      if ( v7 )
      {
        pcm_stop(v7);
        pcm_close(*(_DWORD *)(v2 + 224));
        *(_DWORD *)(v2 + 224) = 0;
      }
      if ( SetAudioClock(0) )
      {
        Open();
        v8 = SetAudioClock(0);
        _android_log_print(
          3,
          "audio_hw_primary",
          "%s(): failed to disable cp i2s clock, retry again, ret=%d",
          "end_call",
          v8);
      }
      *(_BYTE *)(v2 + 183) = 0;
      sub_569C(v2);
    }
    goto LABEL_29;
  }
  if ( !v4 )
  {
    _android_log_print(3, "audio_hw_primary", "Entering IN_CALL state");
    sub_569C(v2);
    v5 = *(_DWORD *)(v2 + 172);
    if ( v5 == 2 )
      *(_QWORD *)(v2 + 172) = -9223372019674906623LL;
    else
      *(_DWORD *)(v2 + 172) = v5 & 0xFFFFFFFD;
    *(_DWORD *)(v2 + 200) = 4;
    _android_log_print(3, "audio_hw_primary", "%s():...", "start_call");
    if ( SetAudioClock(1) )
    {
      Open();
      v9 = SetAudioClock(1);
      _android_log_print(
        3,
        "audio_hw_primary",
        "%s(): failed to enable cp i2s clock, retry again, ret=%d",
        "start_call",
        v9);
    }
    usleep(0x1388u);
    if ( !*(_DWORD *)(v2 + 220) )
    {
      v10 = 0;
      v11 = pcm_open(0, 3, 0, &pcm_config_voice_call);
      *(_DWORD *)(v2 + 220) = v11;
      if ( v11 )
      {
        v12 = pcm_is_ready();
        v10 = *(_DWORD *)(v2 + 220);
        if ( !v12 )
        {
          v16 = pcm_get_error(*(_DWORD *)(v2 + 220));
          _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(VOICE_OUT) failed: %s", "start_call", v16);
          goto LABEL_27;
        }
      }
      pcm_prepare(v10);
    }
    if ( *(_DWORD *)(v2 + 224) )
    {
LABEL_28:
      sub_5730(v2);
      *(_DWORD *)(v2 + 208) = 1;
      goto LABEL_29;
    }
    v13 = 0;
    v14 = pcm_open(0, 3, 0x10000000, &pcm_config_voice_call);
    *(_DWORD *)(v2 + 224) = v14;
    if ( !v14 || (v15 = pcm_is_ready(), v13 = *(_DWORD *)(v2 + 224), v15) )
    {
      pcm_prepare(v13);
      goto LABEL_28;
    }
    v17 = pcm_get_error(*(_DWORD *)(v2 + 224));
    _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(VOICE_IN) failed: %s", "start_call", v17);
    pcm_close(*(_DWORD *)(v2 + 224));
    *(_DWORD *)(v2 + 224) = 0;
LABEL_27:
    pcm_close(*(_DWORD *)(v2 + 220));
    *(_DWORD *)(v2 + 220) = 0;
    goto LABEL_28;
  }
LABEL_29:
  v18 = *(_DWORD *)(v2 + 212);
  if ( *(_DWORD *)(v2 + 168) == 3 )
  {
    if ( !v18 )
    {
      _android_log_print(3, "audio_hw_primary", "Entering IN_COMMUNICATION state");
      sub_569C(v2);
      v19 = *(_DWORD *)(v2 + 172);
      if ( v19 == 2 )
        *(_QWORD *)(v2 + 172) = -9223372019674906623LL;
      else
        *(_DWORD *)(v2 + 172) = v19 & 0xFFFFFFFD;
      *(_DWORD *)(v2 + 200) = 7;
      sub_5730(v2);
      *(_DWORD *)(v2 + 212) = 1;
    }
  }
  else if ( v18 )
  {
    _android_log_print(3, "audio_hw_primary", "Leaving IN_COMMUNICATION state");
    *(_DWORD *)(v2 + 212) = 0;
    *(_DWORD *)(v2 + 200) = 0;
    sub_569C(v2);
  }
LABEL_37:
  pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 3050: using guessed type int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD);
// 305C: using guessed type int pcm_is_ready(void);
// 3068: using guessed type int __fastcall pcm_prepare(_DWORD);
// 30A4: using guessed type int __fastcall pcm_get_error(_DWORD);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 31B8: using guessed type int Open(void);
// 31DC: using guessed type int __fastcall pcm_stop(_DWORD);
// 31E8: using guessed type int __fastcall SetAudioClock(_DWORD);

//----- (00004B48) --------------------------------------------------------
int __fastcall sub_4B48(int a1, int a2)
{
  int v2; // r5@1
  int v3; // r8@1
  int v4; // r4@1
  int v5; // r6@6
  signed int v6; // r6@11
  __int64 v7; // kr00_8@16
  int v8; // r7@17
  bool v9; // zf@18
  int v10; // r7@28
  int v11; // r5@30
  int v12; // r0@36
  char v13; // r1@36
  char s1; // [sp+8h] [bp-40h]@1
  int v16; // [sp+28h] [bp-20h]@1

  v2 = a1;
  v3 = a2;
  v16 = _stack_chk_guard;
  v4 = str_parms_create_str(a2);
  _android_log_print(3, "audio_hw_primary", "%s(): kvpairs = %s", "adev_set_parameters", v3);
  if ( str_parms_get_str(v4, "bt_headset_nrec", &s1, 32) >= 0 )
    *(_BYTE *)(v2 + 182) = strcmp(&s1, "on") == 0;
  if ( str_parms_get_str(v4, "screen_state", &s1, 32) >= 0 )
    *(_BYTE *)(v2 + 181) = strcmp(&s1, "on") != 0;
  if ( str_parms_get_str(v4, "hifi_gain", &s1, 32) >= 0 )
  {
    v5 = atoi(&s1);
    if ( *(_DWORD *)(v2 + 292) != v5 )
    {
      _android_log_print(
        3,
        "audio_hw_primary",
        "%s(): hifi_gain change: (%d >> %d)",
        "adev_set_parameters",
        *(_DWORD *)(v2 + 292),
        v5);
      *(_DWORD *)(v2 + 292) = v5;
      if ( *(_BYTE *)(v2 + 289) )
      {
        sub_62E0(v2);
        sub_427C(v2);
      }
    }
  }
  if ( str_parms_get_str(v4, "dirac", &s1, 32) >= 0 )
  {
    v6 = !strcmp("close", &s1) ? 0 : strcmp("disable", &s1) != 0;
    if ( *(_BYTE *)(v2 + 290) != v6 )
    {
      _android_log_print(
        3,
        "audio_hw_primary",
        "%s(): dirac state (%d >> %d)",
        "adev_set_parameters",
        *(_BYTE *)(v2 + 290),
        v6);
      *(_BYTE *)(v2 + 290) = v6;
      if ( v6 )
        sub_427C(v2);
    }
  }
  v7 = *(_QWORD *)(v2 + 252);
  if ( str_parms_get_str(v4, "assistant_ready", &s1, 32) >= 0 )
  {
    v8 = atoi(&s1);
    if ( *(_BYTE *)(v2 + 313) != v8 )
    {
      _android_log_print(
        3,
        "audio_hw_primary",
        "%s(): xunfei assistant asr_ready change: (%d >> %d)",
        "adev_set_parameters",
        *(_BYTE *)(v2 + 313),
        v8);
      v9 = v8 == 0;
      if ( v8 )
        LOBYTE(v8) = 1;
      *(_BYTE *)(v2 + 313) = v8;
      if ( v9 && *(_DWORD *)(v2 + 168) != 2 )
      {
        if ( HIDWORD(v7) )
          sub_6644(SHIDWORD(v7));
        if ( (_DWORD)v7 )
        {
          sub_6676(v7);
        }
        else if ( !HIDWORD(v7) )
        {
          pthread_mutex_lock((pthread_mutex_t *)(v2 + 164));
          v10 = *(_DWORD *)(v2 + 172);
          *(_DWORD *)(v2 + 172) = 0;
          sub_5730(v2);
          *(_DWORD *)(v2 + 172) = v10;
          pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
        }
      }
    }
  }
  if ( str_parms_get_str(v4, "factory_test", &s1, 32) < 0 )
  {
    if ( *(_DWORD *)(v2 + 168) == 2 && str_parms_get_str(v4, "routing", &s1, 32) >= 0 && atoi(&s1) == 1 )
    {
      pthread_mutex_lock((pthread_mutex_t *)(v2 + 164));
      sub_5730(v2);
      pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
    }
    if ( str_parms_get_str(v4, "voice_call_wb", &s1, 32) >= 0 )
    {
      usleep(0x7530u);
      v12 = strcmp(&s1, "on");
      v13 = 0;
      if ( !v12 )
        v13 = 1;
      *(_BYTE *)(v2 + 183) = v13;
      if ( *(_DWORD *)(v2 + 168) == 2 )
      {
        pthread_mutex_lock((pthread_mutex_t *)(v2 + 164));
        sub_5730(v2);
        pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
      }
    }
    if ( str_parms_get_str(v4, "mic_nr_off", &s1, 32) >= 0 )
      *(_BYTE *)(v2 + 184) = strcmp(&s1, "on") == 0;
    str_parms_destroy(v4);
    v11 = 0;
  }
  else
  {
    v11 = sub_66B0(v2, v3);
    str_parms_destroy(v4);
  }
  if ( _stack_chk_guard != v16 )
    _stack_chk_fail(_stack_chk_guard - v16);
  return v11;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 31F4: using guessed type int __fastcall str_parms_create_str(_DWORD);
// 3200: using guessed type int __fastcall str_parms_get_str(_DWORD, _DWORD, _DWORD, _DWORD);
// 320C: using guessed type int __fastcall str_parms_destroy(_DWORD);

//----- (00004E6C) --------------------------------------------------------
char *__fastcall sub_4E6C(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r6@1
  int v4; // r5@1
  int v5; // r4@2
  char *v6; // r5@2
  int v7; // r6@3
  const char *v8; // r0@5
  int v15; // r6@11
  char s1; // [sp+8h] [bp-38h]@1
  int v18; // [sp+2Ch] [bp-14h]@1

  v2 = a1;
  v3 = a2;
  v18 = _stack_chk_guard;
  v4 = str_parms_create_str(a2);
  _android_log_print(3, "audio_hw_primary", "%s(): kvpairs = %s", "adev_get_parameters", v3);
  if ( str_parms_get_str(v4, "ec_supported", &s1, 32) < 0 )
  {
    v7 = str_parms_get_str(v4, "factory_test", &s1, 32);
    str_parms_destroy(v4);
    if ( v7 < 0 )
    {
      v8 = (const char *)&unk_D192;
    }
    else
    {
      if ( !strcmp(&s1, "pa_calibration") )
      {
        if ( sub_66B0(v2, (int)"factory_test=pa_calibration") )
        {
          __asm { VMOV.I32        D16, #0 }
        }
        else
        {
          _R0 = NxpTfa98xx_GetSpeakerImpedance();
          __asm
          {
            VMOV            S0, R0
            VCVT.F64.F32    D16, S0
          }
        }
        __asm { VMOV.I32        Q9, #0 }
        _R0 = &s1;
        __asm
        {
          VST1.64         {D18-D19}, [R0]!
          VST1.64         {D18-D19}, [R0]
          VSTR            D16, [SP,#0x40+var_40]
        }
        _sprintf_chk(&s1, 0, 32, "speaker_impedance=%f");
        v15 = str_parms_create_str(&s1);
        v6 = (char *)str_parms_to_str(v15);
        str_parms_destroy(v15);
        sub_66B0(v2, (int)"factory_test=off");
        _android_log_print(3, "audio_hw_primary", "%s(): %s", "adev_get_parameters", v6);
        goto LABEL_12;
      }
      v8 = (const char *)&unk_D192;
    }
    v6 = strdup(v8);
  }
  else
  {
    str_parms_destroy(v4);
    v5 = str_parms_create_str("ec_supported=yes");
    v6 = (char *)str_parms_to_str(v5);
    str_parms_destroy(v5);
  }
LABEL_12:
  if ( _stack_chk_guard != v18 )
    _stack_chk_fail(_stack_chk_guard - v18);
  return v6;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 31F4: using guessed type int __fastcall str_parms_create_str(_DWORD);
// 3200: using guessed type int __fastcall str_parms_get_str(_DWORD, _DWORD, _DWORD, _DWORD);
// 320C: using guessed type int __fastcall str_parms_destroy(_DWORD);
// 3218: using guessed type int __fastcall str_parms_to_str(_DWORD);
// 3230: using guessed type int NxpTfa98xx_GetSpeakerImpedance(void);
// 323C: using guessed type int _sprintf_chk(_DWORD, _DWORD, _DWORD, const char *, ...);

//----- (00004FD0) --------------------------------------------------------
int __fastcall sub_4FD0(int a1, int a2)
{
  int v2; // r0@1
  int v3; // r12@1
  unsigned int v4; // r1@1
  unsigned int v5; // r0@1
  signed int v6; // r1@3

  v2 = *(_DWORD *)a2;
  v3 = *(_DWORD *)(a2 + 8);
  v4 = *(_DWORD *)(a2 + 4) - ((*(_DWORD *)(a2 + 4) >> 1) & 0x55555555);
  v5 = (16843009
      * (((v4 & 0x33333333) + ((v4 >> 2) & 0x33333333) + (((v4 & 0x33333333) + ((v4 >> 2) & 0x33333333)) >> 4)) & 0xF0F0F0F) >> 24)
     * ((unk_11038 * v2 / (unsigned int)dword_11034 + 15) & 0xFFFFFFF0);
  if ( (unsigned int)(v3 - 1) <= 5 )
  {
    switch ( v3 )
    {
      case 0:
        goto LABEL_5;
      case 1:
        v6 = 1;
        return v5 * v6;
      case 2:
      case 3:
      case 4:
        v6 = 4;
        return v5 * v6;
      case 5:
        v6 = 3;
        return v5 * v6;
      default:
        break;
    }
  }
  if ( v3 == 218103808 )
LABEL_5:
    v6 = 2;
  else
    v6 = 0;
  return v5 * v6;
}
// 11034: using guessed type int dword_11034;

//----- (00005068) --------------------------------------------------------
signed int __fastcall sub_5068(int a1, int a2, int a3, int a4, int a5, char **a6)
{
  int v6; // r11@1
  signed int result; // r0@2
  unsigned int v8; // r10@3
  char *v9; // r0@3
  char *v10; // r4@3
  int v11; // r1@4
  int v12; // r3@4
  int v13; // r5@4
  int v14; // r6@4
  int v15; // r7@4
  int v16; // r1@4
  int v17; // r3@4
  int v18; // r5@4
  int v19; // r6@4
  int v20; // r7@4
  unsigned int v21; // r0@4
  unsigned int v22; // r6@4
  int v23; // r0@4
  bool v24; // zf@4
  signed int v25; // r7@9
  unsigned int v26; // r0@16
  unsigned int v27; // r0@18
  unsigned int v28; // r0@20
  unsigned int v29; // r0@20

  v6 = a1;
  if ( *(_BYTE *)(a1 + 269) )
  {
    _android_log_print(
      6,
      "audio_hw_primary",
      "%s(): output stream has been opened, abort...",
      "adev_open_output_stream");
    *a6 = 0;
    return -22;
  }
  v8 = 1;
  v9 = (char *)calloc(1u, 0xD8u);
  v10 = v9;
  if ( !v9 )
    return -12;
  v11 = (int)(v9 + 116);
  *((_DWORD *)v9 + 42) = 3;
  *((_DWORD *)v9 + 43) = 3;
  v12 = unk_1100C;
  v13 = dword_11010;
  v14 = unk_11014;
  v15 = unk_11018;
  *(_DWORD *)v11 = pcm_config;
  *(_DWORD *)(v11 + 4) = v12;
  *(_DWORD *)(v11 + 8) = v13;
  *(_DWORD *)(v11 + 12) = v14;
  *(_DWORD *)(v11 + 16) = v15;
  v16 = (int)(v9 + 136);
  v17 = unk_11020;
  v18 = unk_11024;
  v19 = unk_11028;
  v20 = unk_1102C;
  *(_DWORD *)v16 = unk_1101C;
  *(_DWORD *)(v16 + 4) = v17;
  *(_DWORD *)(v16 + 8) = v18;
  *(_DWORD *)(v16 + 12) = v19;
  *(_DWORD *)(v16 + 16) = v20;
  *(_DWORD *)v9 = sub_6E08;
  *((_DWORD *)v9 + 1) = sub_6E0E;
  *((_DWORD *)v9 + 2) = sub_6E16;
  *((_DWORD *)v9 + 3) = sub_6E22;
  *((_DWORD *)v9 + 4) = sub_6E28;
  *((_DWORD *)v9 + 5) = sub_6E2E;
  *((_DWORD *)v9 + 6) = sub_6644;
  *((_DWORD *)v9 + 7) = sub_6E34;
  *((_DWORD *)v9 + 10) = sub_6E38;
  *((_DWORD *)v9 + 11) = sub_723C;
  *((_DWORD *)v9 + 12) = sub_7320;
  *((_DWORD *)v9 + 13) = sub_7324;
  *((_DWORD *)v9 + 14) = sub_7328;
  *((_DWORD *)v9 + 15) = sub_733E;
  *((_DWORD *)v9 + 16) = sub_7344;
  *((_DWORD *)v9 + 17) = sub_7C90;
  *((_DWORD *)v9 + 18) = sub_7C96;
  *((_DWORD *)v9 + 24) = sub_7C9C;
  *((_DWORD *)v9 + 51) = v6;
  *((_DWORD *)v9 + 46) = 48000;
  *((_DWORD *)v9 + 47) = 1;
  v21 = sub_7D2C((int)v9);
  v22 = v21;
  *((_DWORD *)v10 + 48) = v21;
  v23 = (*((int (__fastcall **)(_DWORD))v10 + 4))(v10);
  v24 = (v23 & 0xFF000000) == 218103808;
  if ( (v23 & 0xFF000000) != 218103808 )
    v24 = (v23 & 0xFF000000) == 0;
  if ( v24 )
  {
    switch ( v23 )
    {
      case 3:
      case 4:
      case 5:
        v25 = 4;
        break;
      case 1:
        goto LABEL_12;
      case 2:
        v25 = 1;
        break;
      case 6:
        v25 = 3;
        break;
      default:
        if ( v23 == 218103808 )
LABEL_12:
          v25 = 2;
        else
          v25 = 0;
        break;
    }
    v26 = (*((int (__fastcall **)(_DWORD))v10 + 3))(v10);
    if ( 2 == v26 >> 30 )
    {
      v27 = v26 & 0x3FFFFFFF;
    }
    else
    {
      if ( v26 >> 30 )
      {
        v29 = 0;
        goto LABEL_22;
      }
      v27 = v26 & 0x3FFFF;
    }
    v28 = ((v27 - ((v27 >> 1) & 0x55555555)) & 0x33333333) + (((v27 - ((v27 >> 1) & 0x55555555)) >> 2) & 0x33333333);
    v29 = 16843009 * ((v28 + (v28 >> 4)) & 0xF0F0F0F) >> 24;
LABEL_22:
    v8 = v29 * v25;
  }
  *((_DWORD *)v10 + 31) = v22 / v8;
  *(_DWORD *)(a5 + 8) = *((_DWORD *)v10 + 47);
  *(_DWORD *)(a5 + 4) = *((_DWORD *)v10 + 42);
  *(_DWORD *)a5 = *((_DWORD *)v10 + 46);
  v10[160] = 1;
  pthread_mutex_lock((pthread_mutex_t *)(v6 + 164));
  if ( *(_DWORD *)(v6 + 256) )
  {
    pthread_mutex_unlock((pthread_mutex_t *)(v6 + 164));
    _android_log_print(6, "audio_hw_primary", "%s(): output device busy, abort...", "adev_open_output_stream");
    free(v10);
    *a6 = 0;
    result = -16;
  }
  else
  {
    *(_DWORD *)(v6 + 256) = v10;
    *(_BYTE *)(v6 + 269) = 1;
    pthread_mutex_unlock((pthread_mutex_t *)(v6 + 164));
    result = 0;
    *a6 = v10;
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 6E08: using guessed type int sub_6E08();
// 6E0E: using guessed type int sub_6E0E();
// 6E16: using guessed type int sub_6E16();
// 6E22: using guessed type int sub_6E22();
// 6E28: using guessed type int sub_6E28();
// 6E2E: using guessed type int sub_6E2E();
// 6E34: using guessed type int sub_6E34();
// 7320: using guessed type int sub_7320();
// 7324: using guessed type int sub_7324();
// 7328: using guessed type int sub_7328();
// 733E: using guessed type int sub_733E();
// 7C90: using guessed type int sub_7C90();
// 7C96: using guessed type int sub_7C96();
// 11010: using guessed type int dword_11010;

//----- (000052B8) --------------------------------------------------------
void __fastcall sub_52B8(int a1, int a2)
{
  void *v2; // r4@1
  int v3; // r5@1

  v2 = (void *)a2;
  v3 = a1;
  sub_6644(a2);
  pthread_mutex_lock((pthread_mutex_t *)(v3 + 164));
  if ( *(void **)(v3 + 256) == v2 )
    *(_DWORD *)(v3 + 256) = 0;
  *(_BYTE *)(v3 + 269) = 0;
  pthread_mutex_unlock((pthread_mutex_t *)(v3 + 164));
  j_j_free(v2);
}

//----- (000052F4) --------------------------------------------------------
signed int __fastcall sub_52F4(int a1, int a2, int a3, int a4, _DWORD *a5)
{
  int v5; // r8@1
  int v6; // r5@1
  int v7; // r9@1
  _DWORD *v8; // r7@2
  int v9; // r0@3
  void *v10; // r6@5
  signed int v11; // r1@6
  signed int v12; // r0@6
  signed int result; // r0@7
  int v14; // [sp+0h] [bp-A8h]@3
  int v15; // [sp+80h] [bp-28h]@1

  v5 = a1;
  v6 = a4;
  v7 = a3;
  v15 = _stack_chk_guard;
  _android_log_print(3, "audio_hw_primary", "%s():...", "adev_open_input_stream");
  *a5 = 0;
  if ( *(_DWORD *)(v6 + 4) != 16 )
  {
    *(_DWORD *)(v6 + 4) = 16;
    result = -22;
    goto LABEL_12;
  }
  v8 = calloc(1u, 0xB0u);
  if ( v8 )
  {
    property_get("persist.sys.audience.ustrhal", &v14, "0");
    property_set("persist.sys.audience.ustrhal", "0");
    v9 = strncmp((const char *)&v14, "1", 2u);
    if ( !(v7 & 4) || v9 )
    {
      _android_log_print(3, "audio_hw_primary", "audio audience cvq disable");
      v12 = 1024;
      v11 = 2;
      goto LABEL_9;
    }
    _android_log_print(3, "audio_hw_primary", "audio audience cvq enabled");
    v8[18] = 1;
    v10 = malloc(0x4E264u);
    if ( v10 )
    {
      _android_log_print(3, "audio_hw_primary", "audio audience cvq enabled");
      v8[17] = v10;
      j_cvq_init((int)v10);
      v8[24] = 160000;
      v8[23] = malloc(0x27100u);
      v8[25] = 0;
      v8[26] = 0;
      v11 = 1;
      v8[27] = 0;
      v8[19] = 0;
      v8[21] = 0;
      v8[22] = 0;
      v12 = 2048;
LABEL_9:
      pcm_config_in = v11;
      unk_11038 = v12;
      *v8 = sub_7DAC;
      v8[1] = sub_7DB2;
      v8[2] = sub_7DB8;
      v8[3] = sub_7DE0;
      v8[4] = sub_7DE4;
      v8[5] = sub_7DE8;
      v8[6] = sub_6676;
      v8[7] = sub_7DEE;
      v8[10] = sub_7DF4;
      v8[11] = sub_7F78;
      v8[12] = sub_7F84;
      v8[13] = sub_7F88;
      v8[14] = sub_7F8C;
      v8[15] = sub_7F90;
      v8[16] = sub_8A54;
      v8[43] = v5;
      *((_BYTE *)v8 + 124) = 1;
      v8[32] = *(_DWORD *)v6;
      result = 0;
      v8[39] = 0;
      v8[40] = v7;
      *a5 = v8;
      goto LABEL_12;
    }
    _android_log_print(6, "audio_hw_primary", "audio cvq Error audio in assigning mcvqstream");
    free(v8);
    *a5 = 0;
  }
  result = -12;
LABEL_12:
  if ( _stack_chk_guard != v15 )
    _stack_chk_fail(result);
  return result;
}
// 2F6C: using guessed type int __fastcall property_get(_DWORD, _DWORD, _DWORD);
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 30BC: using guessed type int __fastcall property_set(_DWORD, _DWORD);
// 7DAC: using guessed type int sub_7DAC();
// 7DB2: using guessed type int sub_7DB2();
// 7DB8: using guessed type int sub_7DB8();
// 7DE0: using guessed type int sub_7DE0();
// 7DE4: using guessed type int sub_7DE4();
// 7DE8: using guessed type int sub_7DE8();
// 7DEE: using guessed type int sub_7DEE();
// 7F78: using guessed type int sub_7F78();
// 7F84: using guessed type int sub_7F84();
// 7F88: using guessed type int sub_7F88();
// 7F8C: using guessed type int sub_7F8C();
// 8A54: using guessed type int sub_8A54();

//----- (00005520) --------------------------------------------------------
void __fastcall sub_5520(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r6@1
  int v4; // r5@1

  v2 = a2;
  v3 = *(_DWORD *)(a2 + 172);
  v4 = *(_DWORD *)(v3 + 256);
  sub_6676(a2);
  _android_log_print(2, "audio_hw_primary", "%s(): is_cvq=%d", "adev_close_input_stream", *(_DWORD *)(v2 + 72));
  if ( v4
    && !*(_BYTE *)(v3 + 289)
    && (*(_DWORD *)(v4 + 184) != dword_11034 || *(_DWORD *)(v4 + 188) != 1)
    && (!*(_BYTE *)(v3 + 313) || *(_DWORD *)(v2 + 72))
    && *(_DWORD *)(v3 + 168) != 2 )
  {
    sub_6644(v4);
  }
  j_j_free((void *)v2);
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 11034: using guessed type int dword_11034;

//----- (000055A4) --------------------------------------------------------
int __fastcall sub_55A4(int a1, int a2, int a3)
{
  int v3; // r4@1
  int v4; // r5@1
  int v5; // r6@2

  v3 = a1;
  v4 = a2;
  if ( !(*(_BYTE *)(a1 + 172) & 2) )
  {
    v5 = a3 + 2;
    sub_4364(*(_DWORD *)(a1 + 192), (int)off_10BDC[a2], a3 + 2);
    sub_4364(*(_DWORD *)(v3 + 192), (int)off_10BF0[v4], v5);
  }
  return 0;
}
// 10BDC: using guessed type char *off_10BDC[10];
// 10BF0: using guessed type char *off_10BF0[5];

//----- (000055E8) --------------------------------------------------------
int __fastcall sub_55E8(int a1)
{
  int v1; // r4@1
  int v2; // r0@1
  signed int v3; // r5@3
  int result; // r0@10
  int v5; // r0@11

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 172);
  if ( v2 & 0xC )
  {
    sub_42F0(v1);
LABEL_3:
    v3 = 15;
    goto LABEL_8;
  }
  if ( v2 & 1 )
  {
    v3 = *(_DWORD *)(v1 + 284);
  }
  else
  {
    if ( v2 & 0x70 )
      goto LABEL_3;
    v3 = *(_DWORD *)(v1 + 280);
  }
LABEL_8:
  if ( *(_BYTE *)(v1 + 312) )
  {
    _android_log_print(2, "audio_hw_primary", "%s(): auto answer, fixed modem volume at 0dB", "set_voice_volume");
    v3 = 15;
  }
  _android_log_print(
    3,
    "audio_hw_primary",
    "%s(): out_device=0x%02x, voice_volome_level=%d",
    "set_voice_volume",
    *(_DWORD *)(v1 + 172),
    v3);
  result = SetAudioVolume(v3);
  if ( result )
  {
    Open();
    v5 = SetAudioVolume(v3);
    result = _android_log_print(
               3,
               "audio_hw_primary",
               "%s(): failed to set cp volume, retry again, ret=%d",
               "set_voice_volume",
               v5);
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 31B8: using guessed type int Open(void);
// 3254: using guessed type int __fastcall SetAudioVolume(_DWORD);

//----- (0000569C) --------------------------------------------------------
int __fastcall sub_569C(int a1)
{
  int v1; // r4@1
  int v2; // r5@1
  int v3; // r5@3
  int result; // r0@6
  int v5; // r5@7

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 252);
  if ( v2 )
  {
    pthread_mutex_lock((pthread_mutex_t *)(v2 + 116));
    sub_605C(v2);
    pthread_mutex_unlock((pthread_mutex_t *)(v2 + 116));
  }
  v3 = *(_DWORD *)(v1 + 256);
  if ( v3 && !*(_BYTE *)(v3 + 160) )
  {
    pthread_mutex_lock((pthread_mutex_t *)(v3 + 100));
    if ( *(_BYTE *)(v1 + 260) && *(_BYTE *)(v1 + 172) & 2 )
    {
      sub_6164(v1);
      *(_BYTE *)(v1 + 260) = 0;
    }
    sub_61B8(v3);
    sub_629C(v1);
    result = j_j_pthread_mutex_unlock((pthread_mutex_t *)(v3 + 100));
  }
  else if ( *(_DWORD *)(v1 + 228) || (result = *(_DWORD *)(v1 + 232)) != 0 )
  {
    v5 = *(_DWORD *)(v1 + 172);
    *(_DWORD *)(v1 + 172) = 0;
    sub_5730(v1);
    *(_DWORD *)(v1 + 172) = v5;
    result = sub_629C(v1);
  }
  return result;
}

//----- (00005730) --------------------------------------------------------
int __fastcall sub_5730(int a1)
{
  int v1; // r4@1
  signed int v2; // r8@1
  signed int v3; // r10@1
  int v4; // r5@1
  unsigned int v5; // r11@2
  int v6; // r0@6
  char v7; // r1@6
  int v8; // r1@8
  int v9; // r0@8
  bool v10; // zf@8
  int v11; // r9@16
  __int64 v12; // kr00_8@29
  int v13; // r2@29
  signed int v14; // r7@31
  signed int *v15; // r1@32
  signed int *v16; // r1@44
  int *v17; // r0@44
  bool v18; // zf@49
  int v19; // r0@59
  int v20; // r0@61
  int v21; // r0@63
  int v22; // r0@65
  int v23; // r0@68
  int v24; // r0@69
  int v25; // r0@69
  int v26; // r0@71
  int v27; // r12@75
  unsigned int v28; // r0@75
  bool v29; // zf@76
  int v30; // r7@82
  int v31; // r0@82
  int v32; // r0@83
  int v33; // r7@86
  int v34; // r0@86
  int v35; // r0@87
  int v36; // r0@90
  int v37; // r7@92
  int v38; // r0@92
  int v39; // r0@93
  int v40; // r7@96
  int v41; // r0@96
  int v42; // r0@97
  int v43; // r0@101
  int v44; // r0@103
  int v45; // r0@104
  const char *v46; // r5@108
  const char *v47; // r7@108
  signed int v48; // r0@111
  int v49; // r0@112
  signed int v50; // r1@112
  const char *v51; // r0@121
  const char *v52; // r3@121
  int v53; // r5@135
  signed int v54; // r2@137
  signed int v55; // r0@137
  int result; // r0@150
  int v57; // r0@153
  int v58; // r0@154
  int v59; // r0@154
  int v60; // r0@156
  int v61; // [sp+10h] [bp-B0h]@1
  int v62; // [sp+14h] [bp-ACh]@17
  char s1[4]; // [sp+18h] [bp-A8h]@5
  int v64; // [sp+1Ch] [bp-A4h]@29
  int v65; // [sp+20h] [bp-A0h]@29
  int v66; // [sp+24h] [bp-9Ch]@29
  int v67; // [sp+28h] [bp-98h]@29
  int v68; // [sp+2Ch] [bp-94h]@29
  int v69; // [sp+30h] [bp-90h]@29
  int v70; // [sp+34h] [bp-8Ch]@29
  int v71; // [sp+38h] [bp-88h]@29
  int v72; // [sp+3Ch] [bp-84h]@29
  int v73; // [sp+98h] [bp-28h]@1

  v1 = a1;
  v73 = _stack_chk_guard;
  v2 = j_get_output_device_id(a1, *(_DWORD *)(a1 + 172));
  v3 = j_get_input_source_id(v1, *(_DWORD *)(v1 + 200));
  v4 = *(_DWORD *)(v1 + 172);
  v61 = *(_DWORD *)(v1 + 256);
  if ( v4 & 0x70 )
    v5 = 1;
  else
    v5 = (*(_BYTE *)(v1 + 176) & 8u) >> 3;
  if ( *(_DWORD *)(v1 + 168) == 2 )
  {
    _aeabi_memclr8(s1, 128);
    if ( property_get("hw.messagerecord.state", s1, "0") <= -1 )
    {
      _android_log_print(6, "audio_hw_primary", "%s(): cann't get hw.messagerecord.state", "set_voice_autoanswer");
      v8 = *(_DWORD *)(v1 + 168);
    }
    else
    {
      v6 = strcmp(s1, "1");
      v7 = 0;
      if ( !v6 )
        v7 = 1;
      *(_BYTE *)(v1 + 312) = v7;
      v8 = *(_DWORD *)(v1 + 168);
      v9 = v6 != 0;
      v10 = v8 == 2;
      if ( v8 == 2 )
        v10 = v9 == 0;
      if ( v10 )
      {
        j_audio_route_reset(*(_DWORD *)(v1 + 188));
        j_audio_route_apply_path(*(_DWORD *)(v1 + 188), "voice-call-auto-answer-capture");
        j_audio_route_update_mixer(*(_DWORD *)(v1 + 188));
        goto LABEL_150;
      }
    }
    if ( v8 == 2 )
      sub_55E8(v1);
  }
  v11 = v4 & 2;
  if ( *(_BYTE *)(v1 + 289) )
  {
    v62 = v4 & 0xC;
    sub_62E0(v1);
    sub_427C(v1);
  }
  else
  {
    v62 = v4 & 0xC;
    if ( v4 & 0xC )
      sub_42F0(v1);
  }
  if ( !(v4 & 2) && *(_BYTE *)(v1 + 260) )
  {
    sub_6164(v1);
    *(_BYTE *)(v1 + 260) = 0;
  }
  if ( v2 == 8 && v3 == 11 )
    sub_629C(v1);
  if ( v3 == 11 && (v2 == 8 || *(_BYTE *)(v1 + 289)) )
    goto LABEL_73;
  v12 = *(_QWORD *)(v1 + 252);
  *(_DWORD *)s1 = pcm_config_backend;
  v64 = unk_11084;
  v65 = unk_11088;
  v66 = unk_1108C;
  v67 = unk_11090;
  v68 = unk_11094;
  v69 = unk_11098;
  v70 = unk_1109C;
  v71 = unk_110A0;
  v72 = unk_110A4;
  v13 = *(_DWORD *)(v1 + 168);
  if ( v13 == 3 )
  {
    v15 = (signed int *)(HIDWORD(v12) + 120);
    if ( !HIDWORD(v12) )
      v15 = (signed int *)&unk_1100C;
    v14 = *v15;
    v64 = *v15;
LABEL_49:
    v18 = (_DWORD)v12 == 0;
    if ( !(_DWORD)v12 )
      v18 = HIDWORD(v12) == 0;
    if ( v18 && !*(_DWORD *)(v1 + 220) )
      goto LABEL_73;
    goto LABEL_54;
  }
  if ( v13 == 2 )
  {
    v14 = unk_1105C;
    v64 = unk_1105C;
    goto LABEL_49;
  }
  if ( !(_DWORD)v12 )
  {
    v16 = (signed int *)&unk_1100C;
    v17 = (int *)&unk_11018;
    if ( HIDWORD(v12) )
      v16 = (signed int *)(HIDWORD(v12) + 120);
    v14 = *v16;
    v64 = *v16;
    if ( HIDWORD(v12) )
      v17 = (int *)(HIDWORD(v12) + 132);
    v67 = *v17;
    goto LABEL_49;
  }
  if ( *(_DWORD *)(v12 + 156) != 6 || *(_DWORD *)(v12 + 72) != 1 )
    v14 = dword_11034;
  else
    v14 = 48000;
  v64 = v14;
  if ( !*(_BYTE *)(v1 + 313) )
  {
    if ( *(_BYTE *)(v1 + 260) )
    {
      NxpTfa98xx_SetMute(2);
      *(_BYTE *)(v1 + 261) = 1;
    }
    sub_4364(*(_DWORD *)(v1 + 192), (int)"HPOUT Digital Switch", 0);
    sub_4364(*(_DWORD *)(v1 + 192), (int)"EPOUT Digital Switch", 0);
    sub_4364(*(_DWORD *)(v1 + 192), (int)"AIF2TX1 Input 1", 0);
    sub_4364(*(_DWORD *)(v1 + 192), (int)"AIF2TX2 Input 1", 0);
    *(_BYTE *)(v1 + 268) = 1;
  }
LABEL_54:
  if ( !*(_DWORD *)(v1 + 228) || !*(_DWORD *)(v1 + 232) || byte_116D4 != 1 || v14 != dword_116D8 || v67 != dword_116DC )
  {
    _android_log_print(
      3,
      "audio_hw_primary",
      "%s(): open %s-dai, rate=%d, format=%d,channels=%d",
      "start_backend",
      "media",
      v14,
      v67,
      *(_DWORD *)s1);
    v19 = *(_DWORD *)(v1 + 228);
    if ( v19 )
    {
      pcm_close(v19);
      *(_DWORD *)(v1 + 228) = 0;
    }
    v20 = *(_DWORD *)(v1 + 232);
    if ( v20 )
    {
      pcm_close(v20);
      *(_DWORD *)(v1 + 232) = 0;
    }
    v21 = pcm_open(0, 2, 0, s1);
    *(_DWORD *)(v1 + 228) = v21;
    if ( v21 && !pcm_is_ready() )
    {
      v23 = pcm_get_error(*(_DWORD *)(v1 + 228));
      _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(BACKEND_OUT) failed: %s", "start_backend", v23);
    }
    else
    {
      v22 = pcm_open(0, 2, 0x10000000, s1);
      *(_DWORD *)(v1 + 232) = v22;
      if ( !v22 || pcm_is_ready() )
      {
        pcm_prepare(*(_DWORD *)(v1 + 228));
        pcm_prepare(*(_DWORD *)(v1 + 232));
        byte_116D4 = 1;
        dword_116D8 = v64;
        dword_116DC = v67;
        goto LABEL_73;
      }
      v24 = pcm_get_error(*(_DWORD *)(v1 + 232));
      _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(BACKEND_IN) failed: %s", "start_backend", v24);
      v25 = *(_DWORD *)(v1 + 232);
      if ( v25 )
      {
        pcm_close(v25);
        *(_DWORD *)(v1 + 232) = 0;
      }
    }
    v26 = *(_DWORD *)(v1 + 228);
    if ( v26 )
    {
      pcm_close(v26);
      *(_DWORD *)(v1 + 228) = 0;
    }
  }
LABEL_73:
  if ( !(v4 & 2) || *(_BYTE *)(v1 + 260) )
    goto LABEL_90;
  v27 = *(_DWORD *)(v1 + 256);
  *(_DWORD *)s1 = pcm_config_amplifier;
  v64 = unk_110D4;
  v65 = unk_110D8;
  v66 = unk_110DC;
  v67 = unk_110E0;
  v68 = unk_110E4;
  v69 = unk_110E8;
  v70 = unk_110EC;
  v71 = unk_110F0;
  v72 = unk_110F4;
  v28 = *(_DWORD *)(v1 + 168) & 0xFFFFFFFE;
  if ( v28 == 2 )
    goto LABEL_80;
  v29 = v27 == 0;
  if ( v27 )
  {
    v28 = *(_DWORD *)(v27 + 120);
    v29 = v28 == 0;
  }
  if ( !v29 )
  {
    if ( v28 % 0xAC44 )
    {
LABEL_80:
      v64 = 48000;
      goto LABEL_81;
    }
    v64 = 44100;
  }
LABEL_81:
  if ( *(_DWORD *)(v1 + 244) )
  {
LABEL_85:
    if ( *(_DWORD *)(v1 + 248) )
    {
LABEL_89:
      *(_DWORD *)(v1 + 264) = v64;
      goto LABEL_90;
    }
    v33 = 0;
    v34 = pcm_open(0, 6, 0x10000000, s1);
    *(_DWORD *)(v1 + 248) = v34;
    if ( !v34 || (v35 = pcm_is_ready(), v33 = *(_DWORD *)(v1 + 248), v35) )
    {
      pcm_prepare(v33);
      goto LABEL_89;
    }
    v58 = pcm_get_error(*(_DWORD *)(v1 + 248));
    _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(PA_IN) failed: %s", "pre_start_amplifier", v58);
    v59 = *(_DWORD *)(v1 + 248);
    if ( v59 )
    {
      pcm_close(v59);
      *(_DWORD *)(v1 + 248) = 0;
    }
    goto LABEL_156;
  }
  v30 = 0;
  v31 = pcm_open(0, 6, 0, s1);
  *(_DWORD *)(v1 + 244) = v31;
  if ( !v31 || (v32 = pcm_is_ready(), v30 = *(_DWORD *)(v1 + 244), v32) )
  {
    pcm_prepare(v30);
    goto LABEL_85;
  }
  v57 = pcm_get_error(*(_DWORD *)(v1 + 244));
  _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(PA_OUT) failed: %s", "pre_start_amplifier", v57);
LABEL_156:
  v60 = *(_DWORD *)(v1 + 244);
  if ( v60 )
  {
    pcm_close(v60);
    *(_DWORD *)(v1 + 244) = 0;
  }
LABEL_90:
  v36 = *(_DWORD *)(v1 + 236);
  if ( v5 == 1 )
  {
    if ( !v36 )
    {
      _android_log_print(3, "audio_hw_primary", "%s():...", "start_bt_sco");
      v37 = 0;
      v38 = pcm_open(0, 5, 0, &pcm_config_sco);
      *(_DWORD *)(v1 + 236) = v38;
      if ( v38 )
      {
        v39 = pcm_is_ready();
        v37 = *(_DWORD *)(v1 + 236);
        if ( !v39 )
        {
          v44 = pcm_get_error(*(_DWORD *)(v1 + 236));
          _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(SCO_OUT) failed: %s", "start_bt_sco", v44);
LABEL_105:
          pcm_close(*(_DWORD *)(v1 + 236));
          *(_DWORD *)(v1 + 236) = 0;
          goto LABEL_106;
        }
      }
      pcm_prepare(v37);
    }
    if ( *(_DWORD *)(v1 + 240) )
      goto LABEL_106;
    v40 = 0;
    v41 = pcm_open(0, 5, 0x10000000, &pcm_config_sco);
    *(_DWORD *)(v1 + 240) = v41;
    if ( !v41 || (v42 = pcm_is_ready(), v40 = *(_DWORD *)(v1 + 240), v42) )
    {
      pcm_prepare(v40);
      goto LABEL_106;
    }
    v45 = pcm_get_error(*(_DWORD *)(v1 + 240));
    _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(SCO_IN) failed: %s", "start_bt_sco", v45);
    pcm_close(*(_DWORD *)(v1 + 240));
    *(_DWORD *)(v1 + 240) = 0;
    goto LABEL_105;
  }
  if ( v36 )
  {
    _android_log_print(3, "audio_hw_primary", "%s():...", "stop_bt_sco");
    pcm_stop(*(_DWORD *)(v1 + 236));
    pcm_close(*(_DWORD *)(v1 + 236));
    *(_DWORD *)(v1 + 236) = 0;
  }
  v43 = *(_DWORD *)(v1 + 240);
  if ( v43 )
  {
    pcm_stop(v43);
    pcm_close(*(_DWORD *)(v1 + 240));
    *(_DWORD *)(v1 + 240) = 0;
  }
LABEL_106:
  j_audio_route_reset(*(_DWORD *)(v1 + 188));
  j_audio_route_apply_path(*(_DWORD *)(v1 + 188), "dummy");
  if ( v3 == 11 )
  {
    if ( v2 == 8 )
    {
      v46 = 0;
      v47 = 0;
    }
    else
    {
      if ( *(_DWORD *)(v1 + 168) == 2 )
      {
        v48 = 0;
      }
      else
      {
        v48 = *(_BYTE *)(v1 + 313);
        if ( *(_BYTE *)(v1 + 313) )
          v48 = 2;
      }
      v46 = 0;
      v47 = (**(&off_10AC4 + 7 * v48 + v2))[0];
    }
  }
  else if ( v2 == 8 )
  {
    v49 = *(_DWORD *)(v1 + 176);
    v50 = 0;
    if ( v49 == -2147483640 )
      v50 = 3;
    if ( v49 == -2147483632 )
      v50 = 1;
    v47 = 0;
    v46 = (**(&off_10AC4 + 7 * v3 + v50))[1];
  }
  else
  {
    v46 = (const char *)(*(_QWORD *)*(&off_10AC4 + 7 * v3 + v2) >> 32);
    v47 = (const char *)*(_QWORD *)*(&off_10AC4 + 7 * v3 + v2);
  }
  v51 = "none";
  v52 = "none";
  if ( v46 )
    v52 = v46;
  if ( v47 )
    v51 = v47;
  _android_log_print(
    3,
    "audio_hw_primary",
    "%s(): devices %#x input src %d output route %s input route %s",
    "select_devices",
    *(_DWORD *)(v1 + 172),
    *(_DWORD *)(v1 + 200),
    v51,
    v52);
  if ( v47 )
    j_audio_route_apply_path(*(_DWORD *)(v1 + 188), v47);
  if ( v46 )
    j_audio_route_apply_path(*(_DWORD *)(v1 + 188), v46);
  _android_log_print(3, "audio_hw_primary", "%s(): route time measurement: start", "select_devices");
  j_audio_route_update_mixer(*(_DWORD *)(v1 + 188));
  _android_log_print(3, "audio_hw_primary", "%s(): route time measurement: end", "select_devices");
  if ( v62 && !*(_DWORD *)(v1 + 168) && !*(_BYTE *)(v1 + 289) )
    usleep(0x4E20u);
  if ( !v11 )
  {
    if ( !*(_BYTE *)(v1 + 260) )
      goto LABEL_148;
LABEL_145:
    if ( *(_BYTE *)(v1 + 261) && !*(_BYTE *)(v1 + 313) )
    {
      NxpTfa98xx_SetMute(0);
      *(_BYTE *)(v1 + 261) = 0;
    }
    goto LABEL_148;
  }
  if ( *(_BYTE *)(v1 + 260) )
    goto LABEL_145;
  v53 = *(_DWORD *)(v1 + 168);
  if ( v61 || v53 == 2 )
  {
    usleep(0x1388u);
    v54 = 0;
    v55 = 0;
    if ( !v61 )
      v55 = 1;
    if ( v53 == 2 )
      v54 = 1;
    if ( NxpTfa98xx_PowerOn(v55 | v54, *(_DWORD *)(v1 + 264), 0) )
      _android_log_print(6, "audio_hw_primary", "%s(): failed to power on tfa98xx", "start_amplifier");
    *(_BYTE *)(v1 + 260) = 1;
    goto LABEL_145;
  }
LABEL_148:
  if ( *(_BYTE *)(v1 + 268) )
  {
    sub_4364(*(_DWORD *)(v1 + 192), (int)"HPOUT Digital Switch", 1);
    sub_4364(*(_DWORD *)(v1 + 192), (int)"EPOUT Digital Switch", 1);
    sub_4364(*(_DWORD *)(v1 + 192), (int)"AIF2TX1 Input 1", 38);
    sub_4364(*(_DWORD *)(v1 + 192), (int)"AIF2TX2 Input 1", 39);
    *(_BYTE *)(v1 + 268) = 0;
  }
LABEL_150:
  result = _stack_chk_guard - v73;
  if ( _stack_chk_guard != v73 )
    _stack_chk_fail(result);
  return result;
}
// 2F6C: using guessed type int __fastcall property_get(_DWORD, _DWORD, _DWORD);
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3050: using guessed type int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD);
// 305C: using guessed type int pcm_is_ready(void);
// 3068: using guessed type int __fastcall pcm_prepare(_DWORD);
// 30A4: using guessed type int __fastcall pcm_get_error(_DWORD);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 31DC: using guessed type int __fastcall pcm_stop(_DWORD);
// 3278: using guessed type int __fastcall _aeabi_memclr8(_DWORD, _DWORD);
// 3284: using guessed type int __fastcall NxpTfa98xx_SetMute(_DWORD);
// 3290: using guessed type int __fastcall NxpTfa98xx_PowerOn(_DWORD, _DWORD, _DWORD);
// 10AC4: using guessed type char *(*off_10AC4)[80];
// 11034: using guessed type int dword_11034;
// 116D4: using guessed type char byte_116D4;
// 116D8: using guessed type int dword_116D8;
// 116DC: using guessed type int dword_116DC;

//----- (0000605C) --------------------------------------------------------
void __fastcall sub_605C(int a1)
{
  int v1; // r4@1
  int v2; // r5@1
  int v3; // r6@1
  int v4; // r1@2
  int v5; // r0@3
  signed int v6; // r1@3
  int v7; // r0@9

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 68);
  v3 = *(_DWORD *)(a1 + 172);
  _android_log_print(3, "audio_hw_primary", "%s():...", "do_in_standby");
  if ( !*(_BYTE *)(v1 + 124) )
  {
    v4 = *(_DWORD *)(v3 + 168);
    if ( v4 == 2 )
    {
      v5 = *(_DWORD *)(v1 + 172);
      v6 = 4;
    }
    else
    {
      v5 = *(_DWORD *)(v1 + 172);
      if ( v4 == 3 )
        v6 = 7;
      else
        v6 = 0;
    }
    *(_DWORD *)(v5 + 200) = v6;
    if ( (*(_DWORD *)(v3 + 168) & 0xFFFFFFFE) != 2 )
      *(_DWORD *)(*(_DWORD *)(v1 + 172) + 176) = 0;
    _android_log_print(
      2,
      "audio_hw_primary",
      "%s(): asr_ready=%d, is_cvq=%d",
      "do_in_standby",
      *(_BYTE *)(v3 + 313),
      *(_DWORD *)(v1 + 72));
    v7 = *(_DWORD *)(v1 + 72);
    if ( !v7 )
    {
      sub_5730(*(_DWORD *)(v1 + 172));
      v7 = *(_DWORD *)(v1 + 72);
    }
    if ( v7 == 1 )
    {
      if ( !*(_DWORD *)(v2 + 320072) )
        (*(void (__fastcall **)(int))(v2 + 320080))(v2);
      *(_DWORD *)(v1 + 76) = 1;
      pthread_join(*(_DWORD *)(v1 + 80), 0);
      free(*(void **)(v1 + 68));
      free(*(void **)(v1 + 92));
    }
    pcm_close(*(_DWORD *)(v1 + 120));
    *(_DWORD *)(v1 + 120) = 0;
    *(_BYTE *)(v1 + 124) = 1;
    *(_DWORD *)(v3 + 252) = 0;
    if ( *(_DWORD *)(v1 + 132) )
    {
      release_resampler();
      *(_DWORD *)(v1 + 132) = 0;
    }
    j_j_free(*(void **)(v1 + 144));
  }
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 32A8: using guessed type int release_resampler(void);

//----- (00006164) --------------------------------------------------------
int __fastcall sub_6164(int a1)
{
  int v1; // r4@1
  int v2; // r0@3
  int result; // r0@5

  v1 = a1;
  if ( NxpTfa98xx_PowerOff(a1) )
    _android_log_print(6, "audio_hw_primary", "%s(): failed to power off tfa98xx", "stop_amplifier");
  usleep(0x1388u);
  v2 = *(_DWORD *)(v1 + 244);
  if ( v2 )
  {
    pcm_close(v2);
    *(_DWORD *)(v1 + 244) = 0;
  }
  result = *(_DWORD *)(v1 + 248);
  if ( result )
  {
    pcm_close(result);
    result = 0;
    *(_DWORD *)(v1 + 248) = 0;
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 32B4: using guessed type int __fastcall NxpTfa98xx_PowerOff(_DWORD);

//----- (000061B8) --------------------------------------------------------
void __fastcall sub_61B8(int a1)
{
  int v1; // r4@1
  int v2; // r8@1
  int v3; // r6@8
  int v4; // r1@8
  int v5; // r0@8
  int v6; // r6@14
  int v7; // r5@14
  int v8; // r0@15

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 204);
  _android_log_print(3, "audio_hw_primary", "%s():...", "do_out_standby");
  if ( !*(_BYTE *)(v1 + 160) )
  {
    if ( *(_BYTE *)(v2 + 289) )
    {
      *(_BYTE *)(v2 + 289) = 0;
      if ( *(_BYTE *)(v2 + 314) )
      {
        free(*(void **)(v2 + 316));
        *(_BYTE *)(v2 + 314) = 0;
      }
      *(_DWORD *)(v2 + 296) = -1;
    }
    if ( *(_DWORD *)(v2 + 168) != 2 && !*(_BYTE *)(v2 + 313) )
    {
      v3 = *(_DWORD *)(v2 + 172);
      v4 = *(_DWORD *)(*(_DWORD *)(v1 + 204) + 256);
      v5 = 0;
      if ( v4 && v4 != v1 )
      {
        if ( *(_BYTE *)(v4 + 160) )
          v5 = 0;
        else
          v5 = *(_DWORD *)(v4 + 164);
      }
      *(_DWORD *)(v2 + 172) = v5;
      sub_5730(v2);
      *(_DWORD *)(v2 + 172) = v3;
    }
    v6 = v1 + 104;
    v7 = 0;
    do
    {
      v8 = *(_DWORD *)(v6 + 4 * v7);
      if ( v8 )
      {
        pcm_stop(v8);
        pcm_close(*(_DWORD *)(v6 + 4 * v7));
        *(_DWORD *)(v6 + 4 * v7) = 0;
      }
      ++v7;
    }
    while ( v7 != 3 );
    *(_BYTE *)(v1 + 160) = 1;
    *(_DWORD *)(v2 + 256) = 0;
    if ( *(_DWORD *)(v1 + 196) )
    {
      release_resampler();
      *(_DWORD *)(v1 + 196) = 0;
      j_j_free(*(void **)(v1 + 200));
    }
  }
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 31DC: using guessed type int __fastcall pcm_stop(_DWORD);
// 32A8: using guessed type int release_resampler(void);

//----- (0000629C) --------------------------------------------------------
int __fastcall sub_629C(int a1)
{
  int v1; // r4@1
  int v2; // r0@1
  int result; // r0@3

  v1 = a1;
  _android_log_print(3, "audio_hw_primary", "%s():...", "stop_backend");
  v2 = *(_DWORD *)(v1 + 232);
  if ( v2 )
  {
    pcm_close(v2);
    *(_DWORD *)(v1 + 232) = 0;
  }
  result = *(_DWORD *)(v1 + 228);
  if ( result )
  {
    pcm_close(result);
    result = 0;
    *(_DWORD *)(v1 + 228) = 0;
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);

//----- (000062E0) --------------------------------------------------------
int __fastcall sub_62E0(int a1)
{
  int v1; // r4@1
  int v2; // r6@1
  int v3; // r5@2
  int v4; // r7@3
  int v5; // r0@4
  signed int v6; // r0@9
  int v7; // r5@11
  int result; // r0@53
  int v16; // [sp+0h] [bp-38h]@8
  char nptr; // [sp+Ch] [bp-2Ch]@3
  int v18; // [sp+20h] [bp-18h]@1

  v1 = a1;
  v18 = _stack_chk_guard;
  v2 = open("/sys/class/arizona/wm8998_hp_impedance/hp_impedance", 0);
  if ( v2 < 0 )
  {
    v5 = _android_log_print(
           6,
           "audio_hw_primary",
           "%s(): failed to open %s\n",
           "read_impedance",
           "/sys/class/arizona/wm8998_hp_impedance/hp_impedance");
    v4 = 128;
    v3 = -*(_DWORD *)_errno(v5);
  }
  else
  {
    v3 = _read_chk();
    if ( v3 <= -1 )
    {
      _android_log_print(
        6,
        "audio_hw_primary",
        "%s(): failed to read %s",
        "read_impedance",
        "/sys/class/arizona/wm8998_hp_impedance/hp_impedance");
      v4 = 128;
    }
    else
    {
      v4 = atoi(&nptr);
    }
    close(v2);
  }
  if ( v3 <= -1 )
  {
    _android_log_print(6, "audio_hw_primary", "%s : %d", "set_hifi_gain", v3);
  }
  else
  {
    *(_DWORD *)(v1 + 308) = v4 - 35;
    _android_log_print(
      2,
      "audio_hw_primary",
      "%s(): hp_impedance=%d, gain_state=%d",
      "set_hifi_gain",
      v4 - 35,
      *(_DWORD *)(v1 + 292));
    switch ( *(_DWORD *)(v1 + 292) )
    {
      case 0:
        v6 = *(_DWORD *)(v1 + 308);
        if ( (unsigned int)v6 < 8 )
          goto LABEL_27;
        if ( (unsigned int)(v6 - 8) < 5 )
          goto LABEL_32;
        v7 = 1;
        _R6 = 0;
        if ( (unsigned int)(v6 - 50) >= 0xF )
        {
          _CF = (unsigned int)(v6 - 13) >= 7;
          if ( (unsigned int)(v6 - 13) >= 7 )
            _CF = (unsigned int)(v6 - 20) >= 0x1E;
          if ( _CF )
          {
            v7 = 1;
            if ( v6 > 64 )
              v7 = 2;
            _R6 = 0;
          }
        }
        goto LABEL_46;
      case 1:
        v6 = *(_DWORD *)(v1 + 308);
        if ( (unsigned int)v6 < 8 )
          goto LABEL_27;
        _R6 = 0;
        if ( (unsigned int)(v6 - 8) < 5 )
          _R6 = 6;
        v7 = 1;
        goto LABEL_46;
      case 2:
        v6 = *(_DWORD *)(v1 + 308);
        if ( (unsigned int)v6 >= 8 )
        {
          if ( (unsigned int)(v6 - 8) >= 5 )
          {
            if ( (unsigned int)(v6 - 13) >= 7 )
            {
              if ( (unsigned int)(v6 - 20) >= 0xA )
              {
                if ( (unsigned int)(v6 - 30) >= 0xA )
                {
                  if ( (unsigned int)(v6 - 40) >= 0xA )
                  {
                    if ( (unsigned int)(v6 - 50) >= 0xA )
                    {
                      v7 = 1;
                      if ( v6 > 59 )
                        v7 = 2;
                      _R6 = 0;
                    }
                    else
                    {
                      _R6 = 2;
                      v7 = 2;
                    }
                  }
                  else
                  {
                    v7 = 2;
                    _R6 = 4;
                  }
                }
                else
                {
                  v7 = 2;
                  _R6 = 8;
                }
              }
              else
              {
                v7 = 2;
                _R6 = 12;
              }
            }
            else
            {
              v7 = 1;
              _R6 = 0;
            }
          }
          else
          {
LABEL_32:
            v7 = 1;
            _R6 = 6;
          }
        }
        else
        {
LABEL_27:
          v7 = 1;
          _R6 = 12;
        }
        goto LABEL_46;
      case 3:
        v6 = *(_DWORD *)(v1 + 308);
        v7 = 1;
        *(_DWORD *)(v1 + 296) = 3;
        if ( v6 > 49 )
          v7 = 2;
        _R6 = 0;
LABEL_46:
        _android_log_print(
          3,
          "audio_hw_primary",
          "%s:is_oversea=%d,impedance=%d",
          "set_hifi_gain",
          *(_BYTE *)(v1 + 304),
          v6);
        if ( *(_BYTE *)(v1 + 304) )
        {
          LODWORD(_R0) = *(_DWORD *)(v1 + 308);
          if ( SLODWORD(_R0) <= 120 )
          {
            __asm
            {
              VMOV            S0, R0
              VCVT.F64.S32    D16, S0
              VMOV            R0, R1, D16
            }
            _R0 = COERCE_UNSIGNED_INT64(log10(_R0));
            __asm
            {
              VLDR            D16, =43.0
              VMOV.F64        D17, #-20.0
              VMOV            D18, R0, R1
              VMLA.F64        D16, D18, D17
              VCVTR.S32.F64   S0, D16
              VMOV            R6, S0
            }
          }
          else
          {
            _R6 = 0;
          }
        }
        *(_DWORD *)(v1 + 300) = _R6;
        _android_log_print(
          3,
          "audio_hw_primary",
          "%s(): gain: %d >> %d,volume_compensation=%d",
          "set_hifi_gain",
          *(_DWORD *)(v1 + 296),
          v7,
          _R6);
        if ( v7 != *(_DWORD *)(v1 + 296) )
        {
          sub_4364(*(_DWORD *)(v1 + 196), (int)"Filter Shape", 0);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"bypass IIR", 0);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"IIR bandwidth", 0);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"Gain selection", v7);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"THD Compensation", 1);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"2nd Harmonic Compensation", 0);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"3nd Harmonic Compensation", 254);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"custom FIR enable", 1);
          sub_4364(*(_DWORD *)(v1 + 196), (int)"stage2 filter type", 0);
          if ( *(_DWORD *)(v1 + 292) != 3 )
            *(_DWORD *)(v1 + 296) = v7;
        }
        break;
      default:
        _android_log_print(6, "audio_hw_primary", "%s(): invalid gain state", "set_hifi_gain", v16);
        break;
    }
  }
  result = _stack_chk_guard - v18;
  if ( _stack_chk_guard != v18 )
    _stack_chk_fail(result);
  return result;
}
// 2FC0: using guessed type int __fastcall _errno(_DWORD);
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 32CC: using guessed type int _read_chk(void);

//----- (00006644) --------------------------------------------------------
int __fastcall sub_6644(int a1)
{
  int v1; // r4@1

  v1 = a1;
  pthread_mutex_lock((pthread_mutex_t *)(*(_DWORD *)(a1 + 204) + 164));
  pthread_mutex_lock((pthread_mutex_t *)(v1 + 100));
  sub_61B8(v1);
  pthread_mutex_unlock((pthread_mutex_t *)(v1 + 100));
  pthread_mutex_unlock((pthread_mutex_t *)(*(_DWORD *)(v1 + 204) + 164));
  return 0;
}

//----- (00006676) --------------------------------------------------------
int __fastcall sub_6676(int a1)
{
  int v1; // r4@1

  v1 = a1;
  pthread_mutex_lock((pthread_mutex_t *)(*(_DWORD *)(a1 + 172) + 164));
  pthread_mutex_lock((pthread_mutex_t *)(v1 + 116));
  sub_605C(v1);
  pthread_mutex_unlock((pthread_mutex_t *)(v1 + 116));
  pthread_mutex_unlock((pthread_mutex_t *)(*(_DWORD *)(v1 + 172) + 164));
  return 0;
}

//----- (000066B0) --------------------------------------------------------
int __fastcall sub_66B0(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r6@1
  int v4; // r5@1
  int v5; // r6@1
  signed int v6; // r7@14
  char ***v7; // r0@14
  signed int v8; // r6@16
  signed int v9; // r9@16
  char **v10; // r8@16
  signed int v11; // r10@21
  int v20; // r0@24
  int v21; // r0@26
  int v22; // r0@28
  int v23; // r0@30
  int v24; // r0@32
  int v25; // r0@34
  int v26; // r0@40
  int v27; // r0@41
  int v28; // r0@42
  int v29; // r0@43
  int v30; // r0@44
  const char *v31; // r1@46
  const char *v32; // r2@46
  const char *v33; // r3@46
  int v34; // r0@47
  int v35; // r0@48
  int v37; // r0@66
  pthread_t newthread; // [sp+4h] [bp-74h]@23
  char v39; // [sp+8h] [bp-70h]@24
  int v40; // [sp+28h] [bp-50h]@24
  int v41; // [sp+2Ch] [bp-4Ch]@24
  char s1; // [sp+30h] [bp-48h]@1
  int v43; // [sp+50h] [bp-28h]@1

  v2 = a1;
  v43 = _stack_chk_guard;
  v3 = str_parms_create_str(a2);
  v4 = j_is_headphone_on();
  v5 = str_parms_get_str(v3, "factory_test", &s1, 32);
  if ( v5 < 0 )
    goto LABEL_54;
  if ( !strcmp(&s1, "earphone") )
  {
    v6 = -1;
    v7 = test_earphones_ptr;
LABEL_20:
    v10 = *v7;
    v9 = 0;
    v8 = 0;
    goto LABEL_21;
  }
  if ( !strcmp(&s1, "headphone") )
  {
    v6 = -1;
    v7 = test_headphone_ptr;
    goto LABEL_20;
  }
  if ( !strcmp(&s1, "speaker") )
  {
    v6 = -1;
    v8 = 0;
    v9 = 1;
    v10 = &test_speaker;
LABEL_21:
    v11 = 0;
    goto LABEL_22;
  }
  if ( !strcmp(&s1, "pri_mic") )
  {
    v6 = -1;
    v7 = test_pri_mic_ptr;
    goto LABEL_20;
  }
  if ( !strcmp(&s1, "sec_mic") )
  {
    v6 = -1;
    v7 = test_sec_mic_ptr;
    goto LABEL_20;
  }
  if ( !strcmp(&s1, "ter_mic") )
  {
    v6 = -1;
    v7 = test_ter_mic_ptr;
    goto LABEL_20;
  }
  if ( !strcmp(&s1, "hifi_high_gain") )
  {
    v6 = 2;
    v8 = 1;
    v10 = 0;
    v9 = 0;
    goto LABEL_21;
  }
  if ( !strcmp(&s1, "hifi_low_gain") )
  {
    v8 = 1;
    v10 = 0;
    v9 = 0;
    v6 = 1;
    goto LABEL_21;
  }
  if ( strcmp(&s1, "pa_calibration") )
  {
    if ( strcmp(&s1, "modem_loopback") )
    {
      if ( !strcmp(&s1, "off") )
      {
        _android_log_print(3, "audio_hw_primary", "%s(): factory test over, close all pcm streams", "audio_test");
        v37 = pthread_mutex_lock((pthread_mutex_t *)(v2 + 164));
        NxpTfa98xx_PowerOff(v37);
        sub_6CBC(v2);
        v5 = 0;
        sub_6D54(*(_DWORD *)(v2 + 192), &default_settings, 0);
        dword_116CC = 1;
        SetAudioLoopback(0, 0);
        pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
      }
      else
      {
        _android_log_print(6, "audio_hw_primary", "%s(): unsupported factory test command", "audio_test");
        v5 = -22;
      }
      goto LABEL_54;
    }
    SetAudioLoopback(1, 1);
    SetAudioVolume(15);
    if ( v4 == 1 )
    {
      _android_log_print(3, "audio_hw_primary", "test modem loopback: outdevice=headphone");
      v6 = -1;
      v7 = &test_modem_loopback_headphone_ptr;
    }
    else
    {
      _android_log_print(3, "audio_hw_primary", "test modem loopback: outdevice=earphone");
      v6 = -1;
      v7 = test_modem_loopback_earphone_ptr;
    }
    goto LABEL_20;
  }
  v11 = 1;
  v6 = -1;
  v10 = 0;
  v9 = 0;
  v8 = 0;
LABEL_22:
  pthread_mutex_lock((pthread_mutex_t *)(v2 + 164));
  sub_6CBC(v2);
  sub_6D54(*(_DWORD *)(v2 + 192), &default_settings, 0);
  dword_116CC = 1;
  if ( v8 == 1 )
  {
    v5 = 0;
    dword_116C8 = v6;
    pthread_create(&newthread, 0, (void *(*)(void *))thread_test_hifi, (void *)v2);
    pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
    goto LABEL_54;
  }
  __asm { VMOV.I32        Q8, #0 }
  _R0 = dword_6BC0;
  _R3 = &v39;
  __asm { VLD1.64         {D18-D19}, [R0@128] }
  _R0 = &v39;
  __asm
  {
    VST1.64         {D16-D17}, [R0]!
    VST1.64         {D16-D17}, [R0]
  }
  v40 = 0;
  v41 = 0;
  __asm { VST1.64         {D18-D19}, [R3] }
  v20 = pcm_open(0, 2, 0, &v39);
  *(_DWORD *)(v2 + 228) = v20;
  if ( v20 && !pcm_is_ready() )
  {
    v26 = pcm_get_error(*(_DWORD *)(v2 + 228));
    _android_log_print(6, "audio_hw_primary", "pcm_open(VOICE_BE_OUT) failed: %s", v26);
LABEL_53:
    _android_log_print(6, "audio_hw_primary", "%s(): failed to start pcms", "audio_test");
    pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
    v5 = -22;
    goto LABEL_54;
  }
  v21 = pcm_open(0, 2, 0x10000000, &v39);
  *(_DWORD *)(v2 + 232) = v21;
  if ( v21 && !pcm_is_ready() )
  {
    v27 = pcm_get_error(*(_DWORD *)(v2 + 232));
    _android_log_print(6, "audio_hw_primary", "pcm_open(VOICE_BE_IN) failed: %s", v27);
LABEL_52:
    pcm_close(*(_DWORD *)(v2 + 228));
    *(_DWORD *)(v2 + 228) = 0;
    goto LABEL_53;
  }
  v22 = pcm_open(0, 3, 0, &v39);
  *(_DWORD *)(v2 + 220) = v22;
  if ( v22 && !pcm_is_ready() )
  {
    v28 = pcm_get_error(*(_DWORD *)(v2 + 220));
    _android_log_print(6, "audio_hw_primary", "pcm_open(VOICE_OUT) failed: %s", v28);
LABEL_51:
    pcm_close(*(_DWORD *)(v2 + 232));
    *(_DWORD *)(v2 + 232) = 0;
    goto LABEL_52;
  }
  v23 = pcm_open(0, 3, 0x10000000, &v39);
  *(_DWORD *)(v2 + 224) = v23;
  if ( v23 && !pcm_is_ready() )
  {
    v29 = pcm_get_error(*(_DWORD *)(v2 + 224));
    _android_log_print(6, "audio_hw_primary", "pcm_open(VOICE_IN) failed: %s", v29);
LABEL_50:
    pcm_close(*(_DWORD *)(v2 + 220));
    *(_DWORD *)(v2 + 220) = 0;
    goto LABEL_51;
  }
  v24 = pcm_open(0, 6, 0, &v39);
  *(_DWORD *)(v2 + 244) = v24;
  if ( v24 && !pcm_is_ready() )
  {
    v34 = pcm_get_error(*(_DWORD *)(v2 + 244));
    _android_log_print(6, "audio_hw_primary", "pcm_open(PA_OUT) failed: %s", v34);
LABEL_49:
    pcm_close(*(_DWORD *)(v2 + 224));
    *(_DWORD *)(v2 + 224) = 0;
    goto LABEL_50;
  }
  v25 = pcm_open(0, 6, 0x10000000, &v39);
  *(_DWORD *)(v2 + 248) = v25;
  if ( v25 && !pcm_is_ready() )
  {
    v35 = pcm_get_error(*(_DWORD *)(v2 + 248));
    _android_log_print(6, "audio_hw_primary", "pcm_open(PA_IN) failed: %s", v35);
    pcm_close(*(_DWORD *)(v2 + 244));
    *(_DWORD *)(v2 + 244) = 0;
    goto LABEL_49;
  }
  pcm_prepare(*(_DWORD *)(v2 + 228));
  pcm_prepare(*(_DWORD *)(v2 + 232));
  pcm_prepare(*(_DWORD *)(v2 + 220));
  pcm_prepare(*(_DWORD *)(v2 + 224));
  pcm_prepare(*(_DWORD *)(v2 + 244));
  pcm_prepare(*(_DWORD *)(v2 + 248));
  if ( v11 != 1 )
  {
    v30 = sub_6D54(*(_DWORD *)(v2 + 192), v10, 1);
    if ( v9 == 1 )
    {
      if ( NxpTfa98xx_PowerOn(0, 48000, 0) )
      {
        v31 = "audio_hw_primary";
        v32 = "%s(): failed to power on tfa98xx";
        v33 = "audio_test";
LABEL_59:
        _android_log_print(6, v31, v32, v33);
        goto LABEL_60;
      }
    }
    else if ( NxpTfa98xx_PowerOff(v30) )
    {
      v31 = "audio_hw_primary";
      v32 = "%s(): failed to power off tfa98xx";
      v33 = "audio_test";
      goto LABEL_59;
    }
LABEL_60:
    pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
    v5 = 0;
    goto LABEL_54;
  }
  v5 = j_amplifier_calibrate(v2);
  pthread_mutex_unlock((pthread_mutex_t *)(v2 + 164));
  if ( v5 )
    v5 = -1;
LABEL_54:
  if ( _stack_chk_guard != v43 )
    _stack_chk_fail(_stack_chk_guard - v43);
  return v5;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3050: using guessed type int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD);
// 305C: using guessed type int pcm_is_ready(void);
// 3068: using guessed type int __fastcall pcm_prepare(_DWORD);
// 30A4: using guessed type int __fastcall pcm_get_error(_DWORD);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 31F4: using guessed type int __fastcall str_parms_create_str(_DWORD);
// 3200: using guessed type int __fastcall str_parms_get_str(_DWORD, _DWORD, _DWORD, _DWORD);
// 3254: using guessed type int __fastcall SetAudioVolume(_DWORD);
// 3290: using guessed type int __fastcall NxpTfa98xx_PowerOn(_DWORD, _DWORD, _DWORD);
// 32B4: using guessed type int __fastcall NxpTfa98xx_PowerOff(_DWORD);
// 3314: using guessed type int __fastcall SetAudioLoopback(_DWORD, _DWORD);
// 6BC0: using guessed type int dword_6BC0[4];
// 10DB4: using guessed type char **test_earphones_ptr[9];
// 10DB8: using guessed type char **test_headphone_ptr[8];
// 10DC0: using guessed type char **test_pri_mic_ptr[6];
// 10DC4: using guessed type char **test_sec_mic_ptr[5];
// 10DC8: using guessed type char **test_ter_mic_ptr[4];
// 10DD0: using guessed type char **test_modem_loopback_earphone_ptr[2];
// 10DD4: using guessed type char **test_modem_loopback_headphone_ptr;
// 110F8: using guessed type char *default_settings;
// 11290: using guessed type char *test_speaker;
// 116C8: using guessed type int dword_116C8;
// 116CC: using guessed type int dword_116CC;

//----- (00006CBC) --------------------------------------------------------
int __fastcall sub_6CBC(int a1)
{
  int v1; // r4@1
  int v2; // r0@1
  int v3; // r0@3
  int v4; // r0@5
  int v5; // r0@7
  int v6; // r0@9
  int result; // r0@11

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 228);
  if ( v2 )
  {
    pcm_stop(v2);
    pcm_close(*(_DWORD *)(v1 + 228));
    *(_DWORD *)(v1 + 228) = 0;
  }
  v3 = *(_DWORD *)(v1 + 232);
  if ( v3 )
  {
    pcm_stop(v3);
    pcm_close(*(_DWORD *)(v1 + 232));
    *(_DWORD *)(v1 + 232) = 0;
  }
  v4 = *(_DWORD *)(v1 + 220);
  if ( v4 )
  {
    pcm_stop(v4);
    pcm_close(*(_DWORD *)(v1 + 220));
    *(_DWORD *)(v1 + 220) = 0;
  }
  v5 = *(_DWORD *)(v1 + 224);
  if ( v5 )
  {
    pcm_stop(v5);
    pcm_close(*(_DWORD *)(v1 + 224));
    *(_DWORD *)(v1 + 224) = 0;
  }
  v6 = *(_DWORD *)(v1 + 244);
  if ( v6 )
  {
    pcm_stop(v6);
    pcm_close(*(_DWORD *)(v1 + 244));
    *(_DWORD *)(v1 + 244) = 0;
  }
  result = *(_DWORD *)(v1 + 248);
  if ( result )
  {
    pcm_stop(result);
    pcm_close(*(_DWORD *)(v1 + 248));
    result = 0;
    *(_DWORD *)(v1 + 248) = 0;
  }
  return result;
}
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 31DC: using guessed type int __fastcall pcm_stop(_DWORD);

//----- (00006D54) --------------------------------------------------------
int __fastcall sub_6D54(int result, _DWORD *a2, int a3)
{
  _DWORD *v3; // r10@1
  int v4; // r11@1
  int v5; // r9@1
  int v6; // r5@2
  _DWORD *v7; // r4@2
  int v8; // r7@3
  int v9; // r4@4
  const char *v10; // r1@4
  int *v11; // r4@9
  unsigned int v12; // r6@9
  int v13; // r2@11
  int v14; // r0@11
  unsigned int v15; // r1@11

  v3 = a2;
  v4 = a3;
  v5 = result;
  if ( *a2 )
  {
    v6 = 0;
    v7 = a2;
    while ( 1 )
    {
      v8 = mixer_get_ctl_by_name(v5);
      if ( !v8 )
        break;
      v9 = (int)&v3[3 * v6];
      v10 = *(const char **)(v9 + 8);
      if ( v10 )
      {
        if ( !v4 )
          v10 = "Off";
        mixer_ctl_set_enum_by_string(v8, v10);
      }
      else if ( mixer_ctl_get_num_values(v8) )
      {
        v11 = (int *)(v9 + 4);
        v12 = 0;
        do
        {
          if ( v4 )
          {
            v13 = *v11;
            v14 = v8;
            v15 = v12;
          }
          else
          {
            v14 = v8;
            v15 = v12;
            v13 = 0;
          }
          mixer_ctl_set_value(v14, v15, v13);
          ++v12;
        }
        while ( v12 < mixer_ctl_get_num_values(v8) );
      }
      result = 3 * ++v6;
      v7 = &v3[3 * v6];
      if ( !v3[3 * v6] )
        return result;
    }
    result = _android_log_print(6, "audio_hw_primary", "%s(): failed to set ctl: %s ", "set_route_by_array", *v7);
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FFC: using guessed type int __fastcall mixer_get_ctl_by_name(_DWORD);
// 3170: using guessed type int __fastcall mixer_ctl_get_num_values(_DWORD);
// 317C: using guessed type int __fastcall mixer_ctl_set_value(_DWORD, _DWORD, _DWORD);
// 3320: using guessed type int __fastcall mixer_ctl_set_enum_by_string(_DWORD, _DWORD);

//----- (00006E38) --------------------------------------------------------
int __fastcall sub_6E38(int a1, int a2)
{
  int v2; // r7@1
  int v3; // r5@1
  int v4; // r10@1
  int v5; // r4@1
  int v6; // r6@2
  int v7; // r8@2
  int v8; // r0@3
  signed int v9; // r11@3
  bool v10; // zf@4
  int v11; // r8@8
  char v12; // r2@11
  bool v13; // zf@14
  bool v14; // zf@21
  int v15; // r2@31
  int v16; // r1@31
  int v17; // r1@36
  int v18; // r0@36
  int v19; // r0@41
  int v20; // r2@46
  int v21; // r1@46
  int v22; // r1@51
  int v23; // r0@51
  int v24; // r6@59
  char v25; // r1@61
  int v26; // r6@65
  char v27; // r1@67
  int v28; // r6@71
  const char *v29; // r1@71
  signed int v30; // r2@73
  char v31; // r0@73
  char nptr; // [sp+10h] [bp-48h]@1
  int v34; // [sp+30h] [bp-28h]@1

  v2 = a1;
  v34 = _stack_chk_guard;
  v3 = *(_DWORD *)(a1 + 204);
  v4 = *(_DWORD *)(v3 + 252);
  v5 = str_parms_create_str(a2);
  pthread_mutex_lock((pthread_mutex_t *)(v3 + 164));
  pthread_mutex_lock((pthread_mutex_t *)(v2 + 100));
  if ( str_parms_get_str(v5, "routing", &nptr, 32) < 0 )
  {
    v7 = 0;
    goto LABEL_10;
  }
  v6 = atoi(&nptr);
  v7 = 0;
  if ( !v6 )
  {
LABEL_10:
    v9 = 0;
    goto LABEL_58;
  }
  v8 = *(_DWORD *)(v3 + 172);
  v9 = 0;
  if ( v8 != v6 )
  {
    v10 = (v6 & 0x1000) == (*(_DWORD *)(v3 + 172) & 0x1000);
    if ( (v6 & 0x1000) == (*(_DWORD *)(v3 + 172) & 0x1000) )
      v10 = (*(_DWORD *)(v3 + 172) & 0x1000) == 0;
    if ( v10 )
    {
      v11 = 0;
      v9 = 0;
    }
    else
    {
      v12 = v4;
      if ( v4 )
        v12 = 1;
      v11 = (unsigned __int8)v12 & (*(_DWORD *)(v2 + 104) != 0);
      v9 = 1;
    }
    v13 = v8 == 8;
    if ( v8 != 8 )
      v13 = v8 == 4;
    if ( v13 && *(_DWORD *)(v3 + 256) && *(_BYTE *)(v3 + 289) )
      sub_61B8(v2);
    v14 = v6 == 8;
    if ( v6 != 8 )
      v14 = v6 == 4;
    if ( v14 )
    {
      _android_log_print(
        3,
        "audio_hw_primary",
        "%s(): out_device change: (0x%x >> 0x%x)",
        "out_set_parameters",
        *(_DWORD *)(v3 + 172),
        v6);
      if ( *(_DWORD *)(v3 + 256) )
      {
        if ( !*(_DWORD *)(v3 + 168) && *(_BYTE *)(v3 + 288) )
          v9 = 1;
      }
    }
    if ( !*(_BYTE *)(v2 + 160) && *(_DWORD *)(v3 + 168) != 2 )
    {
      v15 = *(_DWORD *)(*(_DWORD *)(v2 + 204) + 256);
      v16 = 0;
      if ( v15 && v15 != v2 )
      {
        if ( *(_BYTE *)(v15 + 160) )
          v16 = 0;
        else
          v16 = *(_DWORD *)(v15 + 164);
      }
      _android_log_print(
        3,
        "audio_hw_primary",
        "%s(): out_device change: (0x%x >> 0x%x)",
        "out_set_parameters",
        *(_DWORD *)(v3 + 172),
        v16 | v6);
      v17 = *(_DWORD *)(*(_DWORD *)(v2 + 204) + 256);
      v18 = 0;
      if ( v17 && v17 != v2 )
      {
        if ( *(_BYTE *)(v17 + 160) )
          v18 = 0;
        else
          v18 = *(_DWORD *)(v17 + 164);
      }
      *(_DWORD *)(v3 + 172) = v18 | v6;
      sub_5730(v3);
      v9 = 1;
      v19 = v11;
      if ( *(_DWORD *)(v2 + 104) )
        v11 = 1;
      if ( !v4 )
        v11 = v19;
    }
    if ( *(_DWORD *)(v3 + 168) == 2 )
    {
      *(_DWORD *)(v3 + 200) = 4;
      v20 = *(_DWORD *)(*(_DWORD *)(v2 + 204) + 256);
      v21 = 0;
      if ( v20 && v20 != v2 )
      {
        if ( *(_BYTE *)(v20 + 160) )
          v21 = 0;
        else
          v21 = *(_DWORD *)(v20 + 164);
      }
      _android_log_print(
        3,
        "audio_hw_primary",
        "%s(): out_device change: (0x%x >> 0x%x)",
        "out_set_parameters",
        *(_DWORD *)(v3 + 172),
        v21 | v6);
      v22 = *(_DWORD *)(*(_DWORD *)(v2 + 204) + 256);
      v23 = 0;
      if ( v22 && v22 != v2 )
      {
        if ( *(_BYTE *)(v22 + 160) )
          v23 = 0;
        else
          v23 = *(_DWORD *)(v22 + 164);
      }
      *(_DWORD *)(v3 + 172) = v23 | v6;
      sub_5730(v3);
    }
    *(_DWORD *)(v3 + 172) = v6;
    v7 = v11 != 0;
  }
LABEL_58:
  if ( str_parms_get_str(v5, "sampling_rate", &nptr, 32) >= 0 )
  {
    v24 = atoi(&nptr);
    if ( v24 )
    {
      if ( *(_DWORD *)(v2 + 184) != v24 )
      {
        _android_log_print(
          3,
          "audio_hw_primary",
          "%s(): sample_rate change: (%d >> %d)",
          "out_set_parameters",
          *(_DWORD *)(v2 + 184),
          v24);
        *(_DWORD *)(v2 + 184) = v24;
        *(_DWORD *)(v2 + 192) = sub_7D2C(v2);
        v25 = v4;
        if ( v4 )
          v25 = 1;
        v9 = 1;
        v7 |= (*(_DWORD *)(v2 + 104) != 0) & (unsigned __int8)v25;
      }
    }
  }
  if ( str_parms_get_str(v5, "format", &nptr, 32) >= 0 )
  {
    v26 = atoi(&nptr);
    _android_log_print(
      3,
      "audio_hw_primary",
      "%s(): format change: (%d >> %d)",
      "out_set_parameters",
      *(_DWORD *)(v2 + 188),
      v26);
    if ( v26 )
    {
      if ( *(_DWORD *)(v2 + 188) != v26 )
      {
        *(_DWORD *)(v2 + 188) = v26;
        *(_DWORD *)(v2 + 192) = sub_7D2C(v2);
        v27 = v4;
        if ( v4 )
          v27 = 1;
        v9 = 1;
        v7 |= (*(_DWORD *)(v2 + 104) != 0) & (unsigned __int8)v27;
      }
    }
  }
  if ( str_parms_get_str(v5, "hifi_state", &nptr, 32) >= 0 )
  {
    v28 = strcmp(&nptr, "on");
    v29 = "Disable";
    if ( !v28 )
      v29 = "Enable";
    _android_log_print(3, "audio_hw_primary", "%s(): %s hifi_card", "out_set_parameters", v29);
    v30 = 0;
    v31 = 0;
    if ( !v28 )
      v30 = 1;
    if ( *(_BYTE *)(v3 + 288) != v30 && !*(_DWORD *)(v3 + 168) && *(_BYTE *)(v3 + 172) & 0xC )
      v9 = 1;
    if ( !v28 )
      v31 = 1;
    *(_BYTE *)(v3 + 288) = v31;
  }
  if ( v9 == 1 )
    sub_61B8(v2);
  pthread_mutex_unlock((pthread_mutex_t *)(v2 + 100));
  if ( v7 == 1 )
  {
    pthread_mutex_lock((pthread_mutex_t *)(v4 + 116));
    sub_605C(v4);
    pthread_mutex_unlock((pthread_mutex_t *)(v4 + 116));
  }
  pthread_mutex_unlock((pthread_mutex_t *)(v3 + 164));
  str_parms_destroy(v5);
  if ( _stack_chk_guard != v34 )
    _stack_chk_fail(_stack_chk_guard - v34);
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 31F4: using guessed type int __fastcall str_parms_create_str(_DWORD);
// 3200: using guessed type int __fastcall str_parms_get_str(_DWORD, _DWORD, _DWORD, _DWORD);
// 320C: using guessed type int __fastcall str_parms_destroy(_DWORD);

//----- (0000723C) --------------------------------------------------------
char *__fastcall sub_723C(int a1, const char *a2)
{
  int v2; // r6@1
  const char *v3; // r4@1
  int v4; // r8@1
  int v5; // r9@1
  int v6; // r4@2
  char *v7; // r1@2
  int v8; // r6@2
  char *v9; // t1@2
  char v10; // r0@3
  int v11; // r7@4
  char *v12; // r0@12
  char *v13; // r4@14
  char v15[256]; // [sp+0h] [bp-128h]@1
  int v16; // [sp+100h] [bp-28h]@1

  v2 = a1;
  v3 = a2;
  v16 = _stack_chk_guard;
  v4 = str_parms_create_str(a2);
  v5 = str_parms_create();
  if ( str_parms_get_str(v4, "sup_channels", v15, 256) < 0 )
  {
    v12 = strdup(v3);
  }
  else
  {
    v6 = 0;
    v15[0] = 0;
    v9 = *(char **)(v2 + 172);
    v8 = v2 + 172;
    v7 = v9;
    if ( v9 )
    {
      v10 = 1;
      do
      {
        v11 = 0;
        while ( (char *)out_channels_name_to_enum_table[2 * v11 + 1] != v7 )
        {
          if ( (unsigned int)++v11 >= 3 )
            goto LABEL_11;
        }
        if ( !(v10 & 1) )
          *(_WORD *)&v15[strlen(v15)] = 124;
        _strcat_chk(v15, out_channels_name_to_enum_table[2 * v11], 256);
        v10 = 0;
LABEL_11:
        v7 = *(char **)(v8 + 4 * ++v6);
      }
      while ( v7 );
    }
    str_parms_add_str(v5, "sup_channels", v15);
    v12 = (char *)str_parms_to_str(v5);
  }
  v13 = v12;
  str_parms_destroy(v4);
  str_parms_destroy(v5);
  if ( _stack_chk_guard != v16 )
    _stack_chk_fail(_stack_chk_guard - v16);
  return v13;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 31F4: using guessed type int __fastcall str_parms_create_str(_DWORD);
// 3200: using guessed type int __fastcall str_parms_get_str(_DWORD, _DWORD, _DWORD, _DWORD);
// 320C: using guessed type int __fastcall str_parms_destroy(_DWORD);
// 3218: using guessed type int __fastcall str_parms_to_str(_DWORD);
// 332C: using guessed type int str_parms_create(void);
// 3344: using guessed type int __fastcall _strcat_chk(_DWORD, _DWORD, _DWORD);
// 3350: using guessed type int __fastcall str_parms_add_str(_DWORD, _DWORD, _DWORD);
// 723C: using guessed type char var_128[256];

//----- (00007344) --------------------------------------------------------
unsigned int __fastcall sub_7344(int a1, int a2, unsigned int a3)
{
  int v3; // r9@1
  int v4; // r8@1
  int v5; // r11@1
  int v6; // r0@1
  signed int v8; // r5@6
  unsigned int v9; // r4@4
  unsigned int v10; // r0@12
  unsigned int v11; // r0@14
  unsigned int v12; // r0@16
  unsigned int v13; // r0@16
  pthread_mutex_t *v14; // r10@19
  char *v15; // r6@20
  int v16; // r4@20
  int v21; // r10@20
  int v22; // r5@20
  int v23; // r0@20
  signed int v24; // r0@23
  signed int *v25; // r1@24
  _DWORD *v26; // r2@24
  int v27; // r0@28
  signed int v28; // r2@28
  signed int v29; // r10@28
  bool v30; // zf@28
  signed int v31; // r0@32
  int v32; // r1@32
  signed int v33; // r1@33
  signed int v34; // r7@39
  bool v35; // zf@44
  unsigned int v36; // r5@48
  int v37; // r0@48
  bool v38; // zf@48
  int v39; // r6@52
  signed int v40; // r8@53
  unsigned int v41; // r0@51
  signed int v42; // r4@51
  unsigned int v43; // r0@60
  unsigned int v44; // r0@62
  unsigned int v45; // r0@64
  unsigned int v46; // r0@64
  int v47; // r0@67
  char *v48; // r0@67
  int v49; // r3@67
  int v50; // r5@67
  int v51; // r6@67
  int v52; // r7@67
  int v53; // r3@67
  int v54; // r5@67
  int v55; // r6@67
  int v56; // r7@67
  int v57; // r5@68
  int v58; // r0@68
  _DWORD *v59; // r7@69
  int v60; // r0@69
  int v61; // r4@71
  int v62; // r0@73
  signed int v63; // r1@74
  void *v64; // r0@75
  int v65; // r2@76
  int v66; // r3@76
  int v67; // r6@76
  int v68; // r7@76
  int v69; // r2@76
  int v70; // r3@76
  int v71; // r6@76
  int v72; // r7@76
  int v73; // r5@77
  int v74; // r0@77
  int v75; // r0@78
  int v76; // r0@81
  int v77; // r0@85
  void *v78; // r0@86
  int v79; // r0@89
  int v80; // r0@90
  int v81; // r0@91
  int v82; // r0@92
  int v83; // r0@94
  int v84; // r1@102
  char v85; // r0@104
  int v86; // r2@107
  int v87; // r3@113
  unsigned int v88; // r7@114
  char v89; // r5@114
  char v90; // r7@114
  int v91; // r6@114
  int v92; // r0@119
  int v93; // r3@123
  int v94; // r0@123
  int v95; // r7@127
  int v96; // r9@127
  int v97; // r11@127
  int v98; // r5@127
  int v99; // r8@127
  int v100; // r0@128
  int v101; // r0@130
  int v102; // r2@131
  signed int v103; // r1@132
  int v104; // r0@141
  bool v105; // zf@141
  signed int v106; // r5@146
  int v107; // r0@144
  unsigned int v108; // r0@152
  unsigned int v109; // r0@154
  unsigned int v110; // r0@156
  unsigned int v111; // r0@156
  unsigned int v113; // [sp+18h] [bp-70h]@20
  _DWORD *v114; // [sp+1Ch] [bp-6Ch]@67
  int v115; // [sp+20h] [bp-68h]@51
  pthread_mutex_t *mutex; // [sp+28h] [bp-60h]@19
  unsigned int v117; // [sp+2Ch] [bp-5Ch]@1
  unsigned int v118; // [sp+30h] [bp-58h]@19
  unsigned int v119; // [sp+34h] [bp-54h]@19
  char v120; // [sp+38h] [bp-50h]@20
  int v121; // [sp+3Ch] [bp-4Ch]@76
  int v122; // [sp+40h] [bp-48h]@67
  int v123; // [sp+44h] [bp-44h]@76
  int v124; // [sp+48h] [bp-40h]@76
  int v125; // [sp+4Ch] [bp-3Ch]@76
  int v126; // [sp+50h] [bp-38h]@76
  int v127; // [sp+54h] [bp-34h]@76
  int v128; // [sp+58h] [bp-30h]@20
  int v129; // [sp+5Ch] [bp-2Ch]@20
  int v130; // [sp+60h] [bp-28h]@1

  v3 = a1;
  v117 = a3;
  v4 = a2;
  v130 = _stack_chk_guard;
  v5 = *(_DWORD *)(a1 + 204);
  v6 = (*(int (**)(void))(a1 + 16))();
  _ZF = (v6 & 0xFF000000) == 218103808;
  if ( (v6 & 0xFF000000) != 218103808 )
    _ZF = (v6 & 0xFF000000) == 0;
  if ( !_ZF )
  {
    v9 = 1;
    goto LABEL_19;
  }
  switch ( v6 )
  {
    case 3:
    case 4:
    case 5:
      v8 = 4;
      break;
    case 1:
      goto LABEL_8;
    case 2:
      v8 = 1;
      break;
    case 6:
      v8 = 3;
      break;
    default:
      if ( v6 == 218103808 )
LABEL_8:
        v8 = 2;
      else
        v8 = 0;
      break;
  }
  v10 = (*(int (__fastcall **)(int))(v3 + 12))(v3);
  if ( 2 == v10 >> 30 )
  {
    v11 = v10 & 0x3FFFFFFF;
  }
  else
  {
    if ( v10 >> 30 )
    {
      v13 = 0;
      goto LABEL_18;
    }
    v11 = v10 & 0x3FFFF;
  }
  v12 = ((v11 - ((v11 >> 1) & 0x55555555)) & 0x33333333) + (((v11 - ((v11 >> 1) & 0x55555555)) >> 2) & 0x33333333);
  v13 = 16843009 * ((v12 + (v12 >> 4)) & 0xF0F0F0F) >> 24;
LABEL_18:
  v9 = v13 * v8;
LABEL_19:
  v14 = (pthread_mutex_t *)(v5 + 164);
  v119 = v117 / v9;
  v118 = 4 * dword_11010 * unk_11014 / v9;
  pthread_mutex_lock((pthread_mutex_t *)(v5 + 164));
  mutex = (pthread_mutex_t *)(v3 + 100);
  pthread_mutex_lock((pthread_mutex_t *)(v3 + 100));
  if ( !*(_BYTE *)(v3 + 160) )
    goto LABEL_102;
  v113 = v9;
  v15 = &v120;
  v16 = *(_DWORD *)(v3 + 204);
  _R0 = &v120;
  __asm { VMOV.I32        Q8, #0 }
  v21 = 0;
  v22 = *(_DWORD *)(v16 + 252);
  __asm
  {
    VST1.64         {D16-D17}, [R0]!
    VST1.64         {D16-D17}, [R0]
  }
  v128 = 0;
  v129 = 0;
  *(_DWORD *)(v16 + 256) = v3;
  _android_log_print(
    3,
    "audio_hw_primary",
    "%s(): mode=%d, out_device=0x%x",
    "start_output_stream",
    *(_QWORD *)(v16 + 168));
  v23 = *(_DWORD *)(v16 + 168);
  if ( v23 == 1 )
  {
    *(_BYTE *)(v16 + 289) = 0;
    v25 = (signed int *)(v3 + 120);
    *(_DWORD *)(v3 + 120) = *(_DWORD *)(v3 + 184);
    *(_DWORD *)(v3 + 132) = 0;
    v26 = (_DWORD *)(v3 + 132);
  }
  else
  {
    if ( v23 == 3 )
    {
      v21 = 0;
      v24 = 48000;
      *(_BYTE *)(v16 + 289) = 0;
      goto LABEL_26;
    }
    if ( v23 == 2 )
    {
      v21 = 0;
      *(_BYTE *)(v16 + 289) = 0;
      v24 = unk_1105C;
LABEL_26:
      *(_DWORD *)(v3 + 120) = v24;
      v25 = (signed int *)(v3 + 120);
      *(_DWORD *)(v3 + 132) = 0;
      v26 = (_DWORD *)(v3 + 132);
      goto LABEL_39;
    }
    if ( !*(_BYTE *)(v16 + 288) )
      goto LABEL_165;
    v27 = *(_DWORD *)(v16 + 172);
    v28 = 0;
    v29 = 1;
    v30 = v27 == 4;
    if ( v27 != 4 )
      v30 = v27 == 8;
    if ( !v30 )
    {
LABEL_165:
      v29 = 0;
      v28 = 1;
      *(_BYTE *)(v16 + 289) = 0;
    }
    v31 = *(_DWORD *)(v3 + 184);
    *(_DWORD *)(v3 + 120) = v31;
    v32 = *(_DWORD *)(v3 + 188);
    if ( v32 == 3 )
    {
      v33 = 1;
    }
    else if ( v32 == 4 )
    {
      v33 = 3;
    }
    else
    {
      v33 = 0;
    }
    *(_DWORD *)(v3 + 132) = v33;
    v21 = v29 != 0;
    if ( !v28 )
    {
      v34 = 0;
      goto LABEL_42;
    }
    v25 = (signed int *)(v3 + 120);
    v26 = (_DWORD *)(v3 + 132);
  }
LABEL_39:
  v34 = 1;
  v31 = unk_1105C;
  if ( *(_DWORD *)(v16 + 168) != 2 )
    v31 = 48000;
  *v25 = v31;
  v33 = 0;
  *v26 = 0;
LABEL_42:
  if ( v22 && !v21 )
  {
    v35 = dword_11034 == v31;
    if ( dword_11034 == v31 )
      v35 = unk_11040 == v33;
    if ( !v35 )
    {
      *(_DWORD *)(v3 + 120) = dword_11034;
      *(_DWORD *)(v3 + 132) = 0;
    }
  }
  v36 = *(_DWORD *)(v3 + 192);
  v37 = (*(int (__fastcall **)(int))(v3 + 16))(v3);
  v38 = (v37 & 0xFF000000) == 218103808;
  if ( (v37 & 0xFF000000) != 218103808 )
    v38 = (v37 & 0xFF000000) == 0;
  if ( v38 )
  {
    v39 = v4;
    switch ( v37 )
    {
      case 3:
      case 4:
      case 5:
        v40 = 4;
        break;
      case 1:
        goto LABEL_55;
      case 2:
        v40 = 1;
        break;
      case 6:
        v40 = 3;
        break;
      default:
        if ( v37 == 218103808 )
LABEL_55:
          v40 = 2;
        else
          v40 = 0;
        break;
    }
    v115 = v16;
    v43 = (*(int (__fastcall **)(int))(v3 + 12))(v3);
    if ( 2 == v43 >> 30 )
    {
      v44 = v43 & 0x3FFFFFFF;
      v42 = v34;
    }
    else
    {
      v42 = v34;
      if ( v43 >> 30 )
      {
        v46 = 0;
        goto LABEL_66;
      }
      v44 = v43 & 0x3FFFF;
    }
    v45 = ((v44 - ((v44 >> 1) & 0x55555555)) & 0x33333333) + (((v44 - ((v44 >> 1) & 0x55555555)) >> 2) & 0x33333333);
    v46 = 16843009 * ((v45 + (v45 >> 4)) & 0xF0F0F0F) >> 24;
LABEL_66:
    v41 = v46 * v40;
    v4 = v39;
    v15 = &v120;
    goto LABEL_67;
  }
  v115 = v16;
  v41 = 1;
  v42 = v34;
LABEL_67:
  v47 = v36 / v41;
  *(_DWORD *)(v3 + 124) = v47;
  v114 = (_DWORD *)(v3 + 116);
  *(_DWORD *)(v3 + 136) = *(_DWORD *)(v3 + 128) * v47;
  v48 = v15;
  v49 = *(_DWORD *)(v3 + 120);
  v50 = *(_DWORD *)(v3 + 124);
  v51 = *(_DWORD *)(v3 + 128);
  v52 = *(_DWORD *)(v3 + 132);
  *(_DWORD *)v48 = *(_DWORD *)(v3 + 116);
  *((_DWORD *)v48 + 1) = v49;
  *((_DWORD *)v48 + 2) = v50;
  *((_DWORD *)v48 + 3) = v51;
  *((_DWORD *)v48 + 4) = v52;
  v48 += 20;
  v53 = *(_DWORD *)(v3 + 140);
  v54 = *(_DWORD *)(v3 + 144);
  v55 = *(_DWORD *)(v3 + 148);
  v56 = *(_DWORD *)(v3 + 152);
  *(_DWORD *)v48 = *(_DWORD *)(v3 + 136);
  *((_DWORD *)v48 + 1) = v53;
  *((_DWORD *)v48 + 2) = v54;
  *((_DWORD *)v48 + 3) = v55;
  *((_DWORD *)v48 + 4) = v56;
  v122 = 4096;
  if ( v42 == 1 )
  {
    v57 = 0;
    _android_log_print(
      3,
      "audio_hw_primary",
      "%s(): primary: pcm_open card=%d, device=%d, sample_rate=%d, format=%d, period_size=%d",
      "start_output_stream",
      0,
      *(_DWORD *)(v3 + 156),
      *(_DWORD *)(v3 + 120),
      *(_DWORD *)(v3 + 132),
      4096);
    v58 = pcm_open(0, *(_DWORD *)(v3 + 156), 8, &v120);
    *(_DWORD *)(v3 + 104) = v58;
    if ( v58 )
    {
      v59 = (_DWORD *)(v3 + 104);
      v60 = pcm_is_ready();
      v57 = *(_DWORD *)(v3 + 104);
      if ( !v60 )
      {
        v79 = pcm_get_error(*v59);
        _android_log_print(
          6,
          "audio_hw_primary",
          "%s(): pcm_open(PCM_CARD_PRIMARY) failed: %s",
          "start_output_stream",
          v79);
        v14 = (pthread_mutex_t *)(v5 + 164);
        v61 = v115;
LABEL_97:
        if ( *v59 )
        {
          pcm_close(*v59);
          *v59 = 0;
        }
        *(_DWORD *)(v61 + 256) = 0;
        pthread_mutex_unlock(v14);
        pthread_mutex_unlock(mutex);
        goto LABEL_141;
      }
    }
    pcm_prepare(v57);
  }
  _ZF = v21 == 1;
  v14 = (pthread_mutex_t *)(v5 + 164);
  v61 = v115;
  if ( _ZF )
  {
    v62 = *(_DWORD *)(v3 + 132);
    if ( v62 )
    {
      v63 = v122;
    }
    else
    {
      *(_DWORD *)(v3 + 132) = 3;
      *(_BYTE *)(v115 + 314) = 1;
      v64 = malloc(4 * dword_11010 * unk_11014);
      *(_DWORD *)(v115 + 316) = v64;
      if ( !v64 )
      {
LABEL_96:
        free(*(void **)(v115 + 316));
        v59 = (_DWORD *)(v3 + 104);
        goto LABEL_97;
      }
      _aeabi_memclr(v64, 4 * dword_11010 * unk_11014);
      v65 = *(_DWORD *)(v3 + 120);
      v66 = *(_DWORD *)(v3 + 124);
      v67 = *(_DWORD *)(v3 + 128);
      v68 = *(_DWORD *)(v3 + 132);
      *(_DWORD *)&v120 = *v114;
      v121 = v65;
      v122 = v66;
      v123 = v67;
      v124 = v68;
      v69 = *(_DWORD *)(v3 + 140);
      v70 = *(_DWORD *)(v3 + 144);
      v71 = *(_DWORD *)(v3 + 148);
      v72 = *(_DWORD *)(v3 + 152);
      v125 = *(_DWORD *)(v3 + 136);
      v126 = v69;
      v127 = v70;
      v128 = v71;
      v129 = v72;
      v63 = 4096;
      v122 = 4096;
      v62 = *(_DWORD *)(v3 + 132);
    }
    v73 = 0;
    _android_log_print(
      3,
      "audio_hw_primary",
      "%s(): hifi: pcm_open card=%d, device=%d, sample_rate=%d,format=%d, period_size=%d",
      "start_output_stream",
      1,
      0,
      *(_DWORD *)(v3 + 120),
      v62,
      v63);
    v74 = pcm_open(1, 0, 8, &v120);
    *(_DWORD *)(v3 + 108) = v74;
    if ( v74 )
    {
      v75 = pcm_is_ready();
      v73 = *(_DWORD *)(v3 + 108);
      if ( !v75 )
      {
        v80 = pcm_get_error(*(_DWORD *)(v3 + 108));
        _android_log_print(
          6,
          "audio_hw_primary",
          "%s(): pcm_open(PCM_CARD_HIFI) failed: %s",
          "start_output_stream",
          v80);
LABEL_94:
        v83 = *(_DWORD *)(v3 + 108);
        if ( v83 )
        {
          pcm_close(v83);
          *(_DWORD *)(v3 + 108) = 0;
        }
        goto LABEL_96;
      }
    }
    pcm_prepare(v73);
    *(_BYTE *)(v115 + 289) = 1;
  }
  if ( *(_BYTE *)(v115 + 173) & 0x10 )
  {
    _android_log_print(
      2,
      "audio_hw_primary",
      "%s(): spdif: pcm_open card=%d, device=%d, sample_rate=%d",
      "start_output_stream",
      2,
      *(_DWORD *)(v3 + 156),
      *(_DWORD *)(v3 + 120));
    v76 = pcm_open(2, *(_DWORD *)(v3 + 156), 8, v114);
    *(_DWORD *)(v3 + 112) = v76;
    if ( v76 )
    {
      if ( !pcm_is_ready() )
      {
        v81 = pcm_get_error(*(_DWORD *)(v3 + 112));
        _android_log_print(
          6,
          "audio_hw_primary",
          "%s(): pcm_open(PCM_CARD_SPDIF) failed: %s",
          "start_output_stream",
          v81);
LABEL_92:
        v82 = *(_DWORD *)(v3 + 112);
        if ( v82 )
        {
          pcm_close(v82);
          *(_DWORD *)(v3 + 112) = 0;
        }
        goto LABEL_94;
      }
    }
  }
  if ( *(_DWORD *)(v115 + 168) == 2 )
    *(_DWORD *)(v115 + 200) = 4;
  sub_5730(v115);
  v77 = *(_DWORD *)(v3 + 120);
  if ( v77 != *(_DWORD *)(v3 + 184) )
  {
    _android_log_print(
      3,
      "audio_hw_primary",
      "%s(): create_resampler: (%d >> %d)",
      "start_output_stream",
      *(_DWORD *)(v3 + 184),
      v77);
    v78 = malloc(4 * dword_11010 * unk_11014);
    *(_DWORD *)(v3 + 200) = v78;
    if ( !v78 )
      goto LABEL_92;
    _aeabi_memclr(v78, 4 * dword_11010 * unk_11014);
    if ( create_resampler(*(_DWORD *)(v3 + 184), *(_DWORD *)(v3 + 120), 2, 4) )
    {
      free(*(void **)(v3 + 200));
      goto LABEL_92;
    }
    (**(void (__cdecl ***)(_DWORD, _DWORD))(v3 + 196))(*(_DWORD *)(v3 + 196), **(_DWORD **)(v3 + 196));
  }
  v9 = v113;
  *(_BYTE *)(v3 + 160) = 0;
LABEL_102:
  pthread_mutex_unlock(v14);
  j_pcm_data_dump("/sdcard/Android/log/audio_dump/audio_hw_out1.pcm", v4, v117, (int)"audio.hw.pcm.dump");
  v84 = *(_DWORD *)(v3 + 188);
  if ( v84 != 1 && !*(_DWORD *)(v3 + 132) )
  {
    v85 = 16;
    if ( v84 == 4 )
      v85 = 8;
    if ( v117 >> 2 )
    {
      v86 = 0;
      do
      {
        *(_WORD *)(v4 + 2 * v86) = *(_DWORD *)(v4 + 4 * v86) >> v85;
        ++v86;
      }
      while ( v117 >> 2 != v86 );
    }
    v9 >>= 1;
    v119 = (v117 >> 1) / v9;
    v118 = 4 * unk_11014 * dword_11010 / v9;
  }
  if ( *(_BYTE *)(v5 + 314) && *(_BYTE *)(v5 + 289) )
  {
    if ( v117 >> 1 )
    {
      v87 = 0;
      do
      {
        v88 = 127 * *(_WORD *)(v4 + 2 * v87);
        *(_BYTE *)(*(_DWORD *)(v5 + 316) + 4 * v87 + 1) = v88 >> 7;
        v89 = v88 >> 15;
        v90 = 2 * v88;
        *(_BYTE *)(*(_DWORD *)(v5 + 316) + 4 * v87 + 2) = v89;
        v91 = *(_DWORD *)(v5 + 316) + 4 * v87;
        if ( (signed int)*(_BYTE *)(v4 + 2 * v87 + 1) <= -1 )
          *(_BYTE *)(v91 + 3) = -1;
        else
          *(_BYTE *)(v91 + 3) = 0;
        *(_BYTE *)(*(_DWORD *)(v5 + 316) + 4 * v87++) = v90;
      }
      while ( v117 >> 1 != v87 );
    }
    v9 *= 2;
    v119 = 2 * v117 / v9;
    v118 = 4 * unk_11014 * dword_11010 / v9;
  }
  v92 = *(_DWORD *)(v3 + 196);
  if ( v92 )
  {
    if ( *(_BYTE *)(v5 + 314) && *(_BYTE *)(v5 + 289) )
      v4 = *(_DWORD *)(v5 + 316);
    v93 = *(_DWORD *)(v3 + 200);
    (*(void (__cdecl **)(int, int))(v92 + 8))(v92, v4);
    v4 = *(_DWORD *)(v3 + 200);
    v94 = v118;
  }
  else
  {
    v94 = v119;
    v118 = v119;
    if ( *(_BYTE *)(v5 + 314) && *(_BYTE *)(v5 + 289) )
      v4 = *(_DWORD *)(v5 + 316);
  }
  v95 = v3;
  v96 = v4;
  j_pcm_data_dump("/sdcard/Android/log/audio_dump/audio_hw_out2.pcm", v4, v94 * v9, (int)"audio.hw.pcm.dump");
  v97 = v95 + 104;
  v98 = 0;
  v99 = 0;
  do
  {
    v100 = *(_DWORD *)(v97 + 4 * v99);
    if ( v100 )
    {
      v98 = pcm_write(v100, v96);
      if ( v98 )
      {
        v101 = pcm_get_error(*(_DWORD *)(v97 + 4 * v99));
        _android_log_print(6, "audio_hw_primary", "%s: ret=%d, card_device = %d, error=%s", "out_write", v98, v99, v101);
      }
      else
      {
        v102 = *(_DWORD *)(v95 + 188);
        switch ( v102 )
        {
          case 3:
          case 4:
          case 5:
            v103 = 4;
            break;
          case 1:
            goto LABEL_134;
          case 2:
            v103 = 1;
            break;
          case 6:
            v103 = 3;
            break;
          default:
            if ( v102 == 218103808 )
LABEL_134:
              v103 = 2;
            else
              v103 = 0;
            break;
        }
        v98 = 0;
        *(_QWORD *)(v95 + 208) += v117 / (*(_DWORD *)(v95 + 116) * v103);
      }
    }
    ++v99;
  }
  while ( v99 != 3 );
  pthread_mutex_unlock(mutex);
  v3 = v95;
  if ( v98 )
  {
LABEL_141:
    v104 = (*(int (__fastcall **)(int))(v3 + 16))(v3);
    v105 = (v104 & 0xFF000000) == 218103808;
    if ( (v104 & 0xFF000000) != 218103808 )
      v105 = (v104 & 0xFF000000) == 0;
    if ( !v105 )
    {
      v107 = 1;
LABEL_159:
      usleep(1000000 * v117 / (*(_DWORD *)(v3 + 184) * v107));
      goto LABEL_160;
    }
    switch ( v104 )
    {
      case 3:
      case 4:
      case 5:
        v106 = 4;
        break;
      case 1:
        goto LABEL_148;
      case 2:
        v106 = 1;
        break;
      case 6:
        v106 = 3;
        break;
      default:
        if ( v104 == 218103808 )
LABEL_148:
          v106 = 2;
        else
          v106 = 0;
        break;
    }
    v108 = (*(int (__fastcall **)(_DWORD))(v3 + 12))(v3);
    if ( 2 == v108 >> 30 )
    {
      v109 = v108 & 0x3FFFFFFF;
    }
    else
    {
      if ( v108 >> 30 )
      {
        v111 = 0;
        goto LABEL_158;
      }
      v109 = v108 & 0x3FFFF;
    }
    v110 = ((v109 - ((v109 >> 1) & 0x55555555)) & 0x33333333)
         + (((v109 - ((v109 >> 1) & 0x55555555)) >> 2) & 0x33333333);
    v111 = 16843009 * ((v110 + (v110 >> 4)) & 0xF0F0F0F) >> 24;
LABEL_158:
    v107 = v111 * v106;
    goto LABEL_159;
  }
LABEL_160:
  if ( _stack_chk_guard != v130 )
    _stack_chk_fail(_stack_chk_guard - v130);
  return v117;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3050: using guessed type int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD);
// 305C: using guessed type int pcm_is_ready(void);
// 3068: using guessed type int __fastcall pcm_prepare(_DWORD);
// 30A4: using guessed type int __fastcall pcm_get_error(_DWORD);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 3134: using guessed type int __fastcall pcm_write(_DWORD, _DWORD);
// 335C: using guessed type int __fastcall _aeabi_memclr(_DWORD, _DWORD);
// 3368: using guessed type int __fastcall create_resampler(_DWORD, _DWORD, _DWORD, _DWORD);
// 11010: using guessed type int dword_11010;
// 11034: using guessed type int dword_11034;

//----- (00007C9C) --------------------------------------------------------
signed int __fastcall sub_7C9C(int a1, _QWORD *a2)
{
  int v2; // r10@1
  pthread_mutex_t *v3; // r9@1
  _QWORD *v4; // r8@1
  int v5; // r6@1
  __int64 v6; // r0@6
  signed int v7; // r5@7
  unsigned int v9; // [sp+0h] [bp-28h]@6
  int v10; // [sp+4h] [bp-24h]@1

  v2 = a1;
  v3 = (pthread_mutex_t *)(a1 + 100);
  v4 = a2;
  v10 = _stack_chk_guard;
  pthread_mutex_lock((pthread_mutex_t *)(a1 + 100));
  v5 = 0;
  while ( !*(_DWORD *)(v2 + 104 + 4 * v5) || pcm_get_htimestamp() )
  {
    if ( ++v5 >= 3 )
      goto LABEL_8;
  }
  v6 = *(_QWORD *)(v2 + 208) - (unsigned int)((*(_QWORD *)(v2 + 124) >> 32) * *(_QWORD *)(v2 + 124)) + v9;
  if ( SHIDWORD(v6) >= 0 )
  {
    *v4 = v6;
    v7 = 0;
    goto LABEL_9;
  }
LABEL_8:
  v7 = -1;
LABEL_9:
  pthread_mutex_unlock(v3);
  if ( _stack_chk_guard != v10 )
    _stack_chk_fail(_stack_chk_guard - v10);
  return v7;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3380: using guessed type int pcm_get_htimestamp(void);

//----- (00007D2C) --------------------------------------------------------
unsigned int __fastcall sub_7D2C(int a1)
{
  int v1; // r1@1
  int v2; // r0@1
  unsigned int v3; // r4@4

  v1 = 0;
  v2 = *(_DWORD *)(a1 + 184);
  while ( v2 != dword_ED40[2 * v1] )
  {
    if ( (unsigned int)++v1 >= 0xF )
    {
      _android_log_print(6, "audio_hw_primary", "%s(): invalid sampling rate: %d", "get_output_buffer_size", v2);
      return 0;
    }
  }
  v3 = 0x4000u / dword_ED40[2 * v1 + 1];
  _android_log_print(
    2,
    "audio_hw_primary",
    "%s(): buffer_size=%d",
    "get_output_buffer_size",
    0x4000u / dword_ED40[2 * v1 + 1]);
  return v3;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00007DF4) --------------------------------------------------------
int __fastcall sub_7DF4(int a1, int a2)
{
  int v2; // r6@1
  int v3; // r11@1
  int v4; // r10@1
  int v5; // r7@2
  signed int v6; // r5@2
  int v7; // r7@8
  int v8; // r4@9
  int v9; // r1@14
  signed int v10; // r0@15
  int v11; // r0@17
  int v12; // r4@17
  signed int v13; // r0@21
  char nptr; // [sp+8h] [bp-48h]@1
  int v16; // [sp+28h] [bp-28h]@1

  v2 = a1;
  v16 = _stack_chk_guard;
  v3 = *(_DWORD *)(a1 + 172);
  v4 = str_parms_create_str(a2);
  pthread_mutex_lock((pthread_mutex_t *)(v3 + 164));
  pthread_mutex_lock((pthread_mutex_t *)(v2 + 116));
  if ( str_parms_get_str(v4, "input_source", &nptr, 32) < 0 )
  {
    v6 = 0;
  }
  else
  {
    v5 = atoi(&nptr);
    _android_log_print(
      3,
      "audio_hw_primary",
      "%s(): input_source change: (0x%x >> 0x%x)",
      "in_set_parameters",
      *(_DWORD *)(v2 + 156),
      v5);
    v6 = 0;
    if ( v5 )
    {
      if ( *(_DWORD *)(v2 + 156) != v5 )
      {
        *(_DWORD *)(v2 + 156) = v5;
        v6 = 0;
        if ( !*(_BYTE *)(v2 + 124) )
          v6 = 1;
      }
    }
  }
  v7 = str_parms_get_str(v4, "routing", &nptr, 32);
  if ( v7 >= 0
    && (v8 = atoi(&nptr),
        _android_log_print(
          3,
          "audio_hw_primary",
          "%s(): in_device change: (0x%x >> 0x%x)",
          "in_set_parameters",
          *(_DWORD *)(v3 + 176),
          v8),
        v8)
    && *(_DWORD *)(v2 + 160) != v8 )
  {
    *(_DWORD *)(v2 + 160) = v8;
    if ( *(_BYTE *)(v2 + 124) )
      goto LABEL_26;
  }
  else if ( v6 != 1 )
  {
    goto LABEL_26;
  }
  v9 = *(_DWORD *)(v3 + 168);
  if ( v9 == 2 )
    v10 = 4;
  else
    v10 = *(_DWORD *)(v2 + 156);
  *(_DWORD *)(v3 + 200) = v10;
  v11 = *(_DWORD *)(v2 + 160);
  *(_DWORD *)(v3 + 176) = v11;
  v12 = *(_DWORD *)(v3 + 172);
  if ( !v9 )
  {
    if ( v11 == -2147483644 )
    {
      v13 = 2;
      goto LABEL_24;
    }
    if ( v11 == -2147483640 )
    {
      v13 = 32;
      goto LABEL_24;
    }
    if ( v11 == -2147483632 )
    {
      v13 = 4;
LABEL_24:
      *(_DWORD *)(v3 + 172) = v13;
      goto LABEL_25;
    }
  }
LABEL_25:
  sub_5730(v3);
  *(_DWORD *)(v3 + 172) = v12;
LABEL_26:
  pthread_mutex_unlock((pthread_mutex_t *)(v2 + 116));
  pthread_mutex_unlock((pthread_mutex_t *)(v3 + 164));
  str_parms_destroy(v4);
  if ( _stack_chk_guard != v16 )
    _stack_chk_fail(_stack_chk_guard - v16);
  return v7;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 31F4: using guessed type int __fastcall str_parms_create_str(_DWORD);
// 3200: using guessed type int __fastcall str_parms_get_str(_DWORD, _DWORD, _DWORD, _DWORD);
// 320C: using guessed type int __fastcall str_parms_destroy(_DWORD);

//----- (00007F90) --------------------------------------------------------
int __fastcall sub_7F90(int a1, int a2, int a3)
{
  int v3; // r5@1
  int v4; // r4@1
  __int64 v5; // r8@1
  int v6; // r7@1
  int v7; // r0@1
  bool v8; // zf@1
  signed int v9; // r4@6
  unsigned int v10; // r11@4
  unsigned int v11; // r0@12
  unsigned int v12; // r0@14
  unsigned int v13; // r0@16
  unsigned int v14; // r0@16
  pthread_mutex_t *v15; // r9@19
  int v16; // r6@19
  int v17; // r10@20
  int v18; // r4@20
  _DWORD *v19; // r1@21
  signed int v20; // r0@21
  _DWORD *v21; // r1@26
  bool v22; // zf@27
  int v23; // r0@39
  int v24; // r4@41
  int v25; // r7@41
  int v26; // r0@41
  int v27; // r4@41
  bool v28; // zf@41
  signed int v29; // r7@46
  int v30; // r0@44
  int v31; // r0@47
  unsigned int v32; // r0@53
  unsigned int v33; // r0@55
  unsigned int v34; // r0@57
  unsigned int v35; // r0@57
  void *v36; // r0@60
  int v37; // r0@61
  int v38; // r0@67
  int v39; // r1@69
  signed int *v40; // r4@70
  signed int v41; // r7@70
  unsigned int v42; // r0@71
  int (__fastcall **v43)(_DWORD, _DWORD, _DWORD); // r7@73
  int v44; // r4@73
  signed int v45; // r0@77
  const char *v46; // r1@77
  const char *v47; // r2@77
  int v48; // r0@80
  int v49; // r1@81
  unsigned int v50; // r1@89
  int v51; // r2@90
  int v52; // r0@90
  int v53; // r11@91
  int v54; // r9@91
  int v55; // r0@91
  int v56; // r4@91
  int v57; // r7@93
  int v58; // r1@97
  int v59; // r0@114
  bool v60; // zf@114
  signed int v61; // r4@119
  int v62; // r6@121
  int v63; // r9@117
  int v64; // r3@123
  __int64 v65; // kr00_8@125
  __int64 v66; // r0@126
  int v67; // r7@126
  int v68; // r0@134
  signed int v69; // r0@137
  unsigned int v70; // r0@143
  unsigned int v71; // r0@145
  unsigned int v72; // r0@147
  unsigned int v73; // r0@147
  unsigned int v74; // r7@150
  int i; // r4@150
  int v76; // r0@152
  __int64 v77; // r0@154
  int v78; // r6@155
  unsigned int v79; // r1@162
  unsigned int v80; // r0@165
  unsigned int v81; // r1@168
  unsigned int v82; // r2@168
  int v83; // r6@169
  int v84; // r0@178
  bool v85; // zf@178
  signed int v86; // r6@183
  int v87; // r0@181
  unsigned int v88; // r0@189
  unsigned int v89; // r0@191
  unsigned int v90; // r0@193
  unsigned int v91; // r0@193
  int v93; // [sp+0h] [bp-60h]@0
  int v94; // [sp+4h] [bp-5Ch]@0
  int v95; // [sp+4h] [bp-5Ch]@125
  int v96; // [sp+14h] [bp-4Ch]@19
  __int64 newthread; // [sp+20h] [bp-40h]@150
  int v98; // [sp+28h] [bp-38h]@4
  int (__fastcall **v99)(_DWORD, _DWORD, _DWORD); // [sp+28h] [bp-38h]@91
  __int64 v100; // [sp+2Ch] [bp-34h]@154
  int v101; // [sp+34h] [bp-2Ch]@152
  int v102; // [sp+38h] [bp-28h]@1

  v3 = a1;
  v4 = a2;
  LODWORD(v5) = a3;
  v102 = _stack_chk_guard;
  v6 = *(_DWORD *)(a1 + 172);
  v7 = (*(int (**)(void))(a1 + 16))();
  v8 = (v7 & 0xFF000000) == 218103808;
  if ( (v7 & 0xFF000000) != 218103808 )
    v8 = (v7 & 0xFF000000) == 0;
  if ( !v8 )
  {
    v98 = v4;
    v10 = 1;
    goto LABEL_19;
  }
  v98 = v4;
  switch ( v7 )
  {
    case 3:
    case 4:
    case 5:
      v9 = 4;
      break;
    case 1:
      goto LABEL_8;
    case 2:
      v9 = 1;
      break;
    case 6:
      v9 = 3;
      break;
    default:
      v98 = v4;
      if ( v7 == 218103808 )
LABEL_8:
        v9 = 2;
      else
        v9 = 0;
      break;
  }
  v11 = (*(int (__fastcall **)(int))(v3 + 12))(v3);
  if ( 2 == v11 >> 30 )
  {
    v12 = v11 & 0x3FFFFFFF;
  }
  else
  {
    if ( v11 >> 30 )
    {
      v14 = 0;
      goto LABEL_18;
    }
    v12 = v11 & 0xFFFC;
  }
  v13 = ((v12 - ((v12 >> 1) & 0x55555555)) & 0x33333333) + (((v12 - ((v12 >> 1) & 0x55555555)) >> 2) & 0x33333333);
  v14 = 16843009 * ((v13 + (v13 >> 4)) & 0xF0F0F0F) >> 24;
LABEL_18:
  v10 = v14 * v9;
LABEL_19:
  v15 = (pthread_mutex_t *)(v6 + 164);
  v16 = *(_DWORD *)(v3 + 68);
  v96 = v6;
  pthread_mutex_lock((pthread_mutex_t *)(v6 + 164));
  pthread_mutex_lock((pthread_mutex_t *)(v3 + 116));
  if ( !*(_BYTE *)(v3 + 124) )
    goto LABEL_72;
  v17 = *(_DWORD *)(v3 + 172);
  v18 = *(_DWORD *)(v17 + 256);
  _android_log_print(3, "audio_hw_primary", "%s():...", "start_input_stream");
  *(_DWORD *)(v17 + 252) = v3;
  if ( *(_DWORD *)(v17 + 168) == 2 )
  {
    v19 = &pcm_config_in;
    v20 = unk_1105C;
  }
  else if ( *(_DWORD *)(v3 + 156) != 6 || *(_DWORD *)(v3 + 72) != 1 )
  {
    if ( v18 )
    {
      v21 = (_DWORD *)(v18 + 104);
      if ( *(_DWORD *)(v18 + 104) )
      {
        v20 = *(_DWORD *)(v18 + 120);
        v22 = v20 == 48000;
        if ( v20 != 48000 )
          v22 = v20 == 44100;
        if ( v22 )
        {
          dword_11034 = *(_DWORD *)(v18 + 120);
          goto LABEL_35;
        }
      }
    }
    v19 = &pcm_config_in;
    v20 = 48000;
  }
  else
  {
    v19 = &pcm_config_in;
    v20 = 16000;
  }
  v19[1] = v20;
  if ( !v18 )
    goto LABEL_39;
  v21 = (_DWORD *)(v18 + 104);
LABEL_35:
  if ( *v21 && (*(_DWORD *)(v18 + 132) != unk_11040 || *(_DWORD *)(v18 + 120) != v20) )
  {
    pthread_mutex_lock((pthread_mutex_t *)(v18 + 100));
    _android_log_print(2, "audio_hw_primary", "%s(): sync with input stream, standby output", "start_input_stream");
    sub_61B8(v18);
    pthread_mutex_unlock((pthread_mutex_t *)(v18 + 100));
    v20 = dword_11034;
  }
LABEL_39:
  _android_log_print(
    2,
    "audio_hw_primary",
    "%s(): pcm_open card=%d, device=%d, sample_rate=%d,channel=%d,format=%d",
    "start_input_stream",
    0,
    0,
    v20,
    pcm_config_in,
    unk_11040);
  v23 = pcm_open(0, 0, 0x10000000, &pcm_config_in);
  *(_DWORD *)(v3 + 120) = v23;
  if ( v23 && !pcm_is_ready() )
  {
    v31 = pcm_get_error(*(_DWORD *)(v3 + 120));
    _android_log_print(6, "audio_hw_primary", "%s(): pcm_open(PCM_CARD_PRIMARY) failed: %s", "start_input_stream", v31);
LABEL_64:
    pcm_close(*(_DWORD *)(v3 + 120));
    *(_DWORD *)(v3 + 120) = 0;
    *(_DWORD *)(v17 + 252) = 0;
    goto LABEL_65;
  }
  v24 = pcm_config_in;
  v25 = unk_11038;
  v26 = (*(int (__fastcall **)(int))(v3 + 16))(v3);
  v27 = v24 * v25;
  v28 = (v26 & 0xFF000000) == 218103808;
  if ( (v26 & 0xFF000000) != 218103808 )
    v28 = (v26 & 0xFF000000) == 0;
  if ( !v28 )
  {
    v30 = 1;
    goto LABEL_60;
  }
  switch ( v26 )
  {
    case 3:
    case 4:
    case 5:
      v29 = 4;
      break;
    case 1:
      goto LABEL_49;
    case 2:
      v29 = 1;
      break;
    case 6:
      v29 = 3;
      break;
    default:
      if ( v26 == 218103808 )
LABEL_49:
        v29 = 2;
      else
        v29 = 0;
      break;
  }
  v32 = (*(int (__fastcall **)(int))(v3 + 12))(v3);
  if ( 2 == v32 >> 30 )
  {
    v33 = v32 & 0x3FFFFFFF;
  }
  else
  {
    if ( v32 >> 30 )
    {
      v35 = 0;
      goto LABEL_59;
    }
    v33 = v32 & 0xFFFC;
  }
  v34 = ((v33 - ((v33 >> 1) & 0x55555555)) & 0x33333333) + (((v33 - ((v33 >> 1) & 0x55555555)) >> 2) & 0x33333333);
  v35 = 16843009 * ((v34 + (v34 >> 4)) & 0xF0F0F0F) >> 24;
LABEL_59:
  v30 = v35 * v29;
LABEL_60:
  v36 = malloc(v27 * v30);
  *(_DWORD *)(v3 + 144) = v36;
  if ( !v36 )
  {
LABEL_65:
    pthread_mutex_unlock((pthread_mutex_t *)HIDWORD(v5));
    HIDWORD(v5) = v3 + 116;
    goto LABEL_178;
  }
  v37 = *(_DWORD *)(v3 + 128);
  if ( v37 != dword_11034 )
  {
    *(_DWORD *)(v3 + 136) = sub_8BD4;
    *(_DWORD *)(v3 + 140) = sub_8C90;
    _android_log_print(
      3,
      "audio_hw_primary",
      "%s(): create_resampler: (%d >> %d)",
      "start_input_stream",
      dword_11034,
      v37);
    v93 = v3 + 136;
    v94 = v3 + 132;
    if ( create_resampler(dword_11034, *(_DWORD *)(v3 + 128), 1, 4) )
    {
      free(*(void **)(v3 + 144));
      goto LABEL_64;
    }
    (**(void (__cdecl ***)(_DWORD, _DWORD))(v3 + 132))(*(_DWORD *)(v3 + 132), **(_DWORD **)(v3 + 132));
  }
  *(_DWORD *)(v3 + 148) = 0;
  v38 = *(_DWORD *)(v17 + 168);
  if ( v38 == 2 )
  {
    *(_DWORD *)(v17 + 200) = 4;
  }
  else
  {
    v39 = *(_DWORD *)(v3 + 156);
    *(_DWORD *)(v17 + 200) = v39;
    if ( !v38 )
    {
      if ( v39 == 4 )
        *(_DWORD *)(v17 + 200) = 0;
      v68 = *(_DWORD *)(v3 + 160);
      *(_DWORD *)(v17 + 176) = v68;
      v40 = (signed int *)(v17 + 172);
      v41 = *(_DWORD *)(v17 + 172);
      if ( v68 == -2147483644 )
      {
        v69 = 2;
      }
      else if ( v68 == -2147483640 )
      {
        v69 = 32;
      }
      else
      {
        if ( v68 != -2147483632 )
          goto LABEL_71;
        v69 = 4;
      }
      *v40 = v69;
      goto LABEL_71;
    }
  }
  *(_DWORD *)(v17 + 176) = *(_DWORD *)(v3 + 160);
  v40 = (signed int *)(v17 + 172);
  v41 = *(_DWORD *)(v17 + 172);
LABEL_71:
  sub_5730(v17);
  *v40 = v41;
  v42 = 100 * *(_DWORD *)(v3 + 128) / 0x3E8u;
  *(_DWORD *)(v3 + 168) = v42;
  *(_WORD *)(v3 + 166) = 0xFFFF / v42;
  *(_WORD *)(v3 + 164) = 0;
  *(_BYTE *)(v3 + 124) = 0;
LABEL_72:
  pthread_mutex_unlock(v15);
  if ( !*(_DWORD *)(v3 + 72) )
  {
    v59 = (*(int (__fastcall **)(int))(v3 + 16))(v3);
    v60 = (v59 & 0xFF000000) == 218103808;
    if ( (v59 & 0xFF000000) != 218103808 )
      v60 = (v59 & 0xFF000000) == 0;
    if ( !v60 )
    {
      v63 = 1;
LABEL_150:
      v74 = (unsigned int)v5 / v10;
      LODWORD(newthread) = v5;
      for ( i = 0; (signed int)v74 > i; i += v101 )
      {
        v101 = v74 - i;
        v76 = *(_DWORD *)(v3 + 132);
        if ( v76 )
        {
          (*(void (__cdecl **)(int, int))(v76 + 4))(v76, v98 + i * v63);
        }
        else
        {
          LODWORD(v77) = 0;
          HIDWORD(v77) = v74 - i;
          v100 = v77;
          sub_8BD4(v3 + 136, (int)&v100);
          if ( (_DWORD)v100 )
          {
            v78 = HIDWORD(v100);
            _aeabi_memcpy(v98 + i * v63, v100);
            v101 = v78;
          }
          else
          {
            v78 = HIDWORD(v100);
          }
          *(_DWORD *)(v3 + 148) -= v78;
        }
        v53 = *(_DWORD *)(v3 + 152);
        if ( v53 )
          goto LABEL_162;
      }
      v53 = i;
LABEL_162:
      v79 = *(_DWORD *)(v3 + 168);
      if ( v53 > 0 )
        v53 = 0;
      if ( v79 )
      {
        v80 = *(_DWORD *)(v3 + 164);
        if ( v79 <= v74 )
          v74 = *(_DWORD *)(v3 + 168);
        v44 = v98;
        HIDWORD(v5) = v3 + 116;
        if ( v74 )
        {
          v81 = v80 >> 16;
          v82 = 0;
          do
          {
            v83 = (unsigned __int16)v80;
            LOWORD(v80) = v81 + v80;
            *(_WORD *)(v98 + 2 * v82) = (unsigned int)(v83 * *(_WORD *)(v98 + 2 * v82)) >> 16;
            ++v82;
          }
          while ( v82 < v74 );
          v79 = *(_DWORD *)(v3 + 168);
        }
        *(_WORD *)(v3 + 164) = v80;
        *(_DWORD *)(v3 + 168) = v79 - v74;
      }
      else
      {
        HIDWORD(newthread) = v3 + 116;
        v5 = newthread;
        v44 = v98;
      }
      goto LABEL_173;
    }
    switch ( v59 )
    {
      case 3:
      case 4:
      case 5:
        v61 = 4;
        break;
      case 1:
        goto LABEL_139;
      case 2:
        v61 = 1;
        break;
      case 6:
        v61 = 3;
        break;
      default:
        if ( v59 == 218103808 )
LABEL_139:
          v61 = 2;
        else
          v61 = 0;
        break;
    }
    v70 = (*(int (__fastcall **)(_DWORD))(v3 + 12))(v3);
    if ( 2 == v70 >> 30 )
    {
      v71 = v70 & 0x3FFFFFFF;
    }
    else
    {
      if ( v70 >> 30 )
      {
        v73 = 0;
        goto LABEL_149;
      }
      v71 = v70 & 0xFFFC;
    }
    v72 = ((v71 - ((v71 >> 1) & 0x55555555)) & 0x33333333) + (((v71 - ((v71 >> 1) & 0x55555555)) >> 2) & 0x33333333);
    v73 = 16843009 * ((v72 + (v72 >> 4)) & 0xF0F0F0F) >> 24;
LABEL_149:
    v63 = v73 * v61;
    goto LABEL_150;
  }
  v43 = (int (__fastcall **)(_DWORD, _DWORD, _DWORD))(v16 + 320092);
  v44 = v98;
  while ( 1 )
  {
    *(_DWORD *)(v3 + 88) = v5;
    if ( !*(_DWORD *)(v3 + 84) )
    {
      _android_log_print(4, "audio_hw_primary", "#### start pcm read thread ####");
      if ( pthread_create((pthread_t *)(v3 + 80), 0, (void *(*)(void *))sub_8A58, (void *)v3) <= -1 )
      {
        v45 = 6;
        v46 = "audio_hw_primary";
        v47 = "#### pcm_read_thread() thread creation failed ####";
      }
      else
      {
        *(_DWORD *)(v3 + 76) = 0;
        *(_DWORD *)(v3 + 84) = 1;
        v45 = 4;
        v46 = "audio_hw_primary";
        v47 = "#### Pcm read thread created successfully ####";
      }
      _android_log_print(v45, v46, v47);
    }
    v48 = *(_DWORD *)(v3 + 104);
    if ( v48
      && (v49 = *(_DWORD *)(v3 + 100)) != 0
      && v48 >= v49
      && v48 - v49 <= (unsigned int)v5
      && *(_DWORD *)(v16 + 4) )
    {
      if ( !*(_DWORD *)(v3 + 76) )
      {
        *(_DWORD *)(v3 + 76) = 1;
        pthread_join(*(_DWORD *)(v3 + 80), 0);
        _android_log_print(3, "audio_hw_primary", "#### Pcm read thread stopped successfully ####");
LABEL_101:
        if ( !*(_DWORD *)v16 )
        {
          _android_log_print(
            2,
            "audio_hw_primary",
            "#### before waiting for first read - %d ####",
            *(_DWORD *)(v3 + 104),
            v93,
            v94);
          do
            usleep(0x3E8u);
          while ( !*(_DWORD *)(v3 + 104) );
          _android_log_print(2, "audio_hw_primary", "#### after waiting for first read  - %d ####");
          (*(void (__fastcall **)(int))(v16 + 320076))(v16);
          (*(void (__fastcall **)(int))(v16 + 320084))(v16);
          *(_DWORD *)v16 = 1;
        }
        v53 = 0;
        goto LABEL_106;
      }
    }
    else if ( !*(_DWORD *)(v3 + 76) )
    {
      goto LABEL_101;
    }
    if ( v48 - *(_DWORD *)(v3 + 100) >= (unsigned int)v5 )
      goto LABEL_101;
    _android_log_print(2, "audio_hw_primary", "before slim read");
    v50 = *(_DWORD *)(v3 + 96);
    if ( *(_DWORD *)(v3 + 108) + (signed int)v5 >= v50 )
    {
      _android_log_print(2, "audio_hw_primary", "after slim read");
      goto LABEL_101;
    }
    v51 = *(_DWORD *)(v3 + 104);
    v52 = *(_DWORD *)(v3 + 120);
    if ( v51 + (signed int)v5 <= v50 )
    {
      HIDWORD(v5) = v44;
      v53 = pcm_read(v52, *(_DWORD *)(v3 + 92) + v51, v5);
      v58 = 0;
      if ( !v53 )
        v58 = v5;
      *(_DWORD *)(v3 + 104) += v58;
      *(_DWORD *)(v3 + 108) += v58;
    }
    else
    {
      v99 = v43;
      v53 = pcm_read(v52, v44, v5);
      _android_log_print(
        3,
        "audio_hw_primary",
        "before write overflow - (write offset, max bytes) = (%d, %d)",
        *(_DWORD *)(v3 + 104),
        *(_DWORD *)(v3 + 96),
        v94);
      v54 = v44;
      v55 = *(_DWORD *)(v3 + 104);
      v56 = 0;
      if ( !v53 )
        v56 = v5;
      v57 = v55 + v56 - *(_DWORD *)(v3 + 96);
      if ( v56 - v57 >= 1 )
        _aeabi_memcpy(v55 + *(_DWORD *)(v3 + 92), v54);
      *(_DWORD *)(v3 + 104) = 0;
      _aeabi_memcpy(*(_DWORD *)(v3 + 92), v54 + v56 - v57);
      *(_DWORD *)(v3 + 104) += v57;
      *(_DWORD *)(v3 + 108) += v56;
      v93 = v56;
      _android_log_print(3, "audio_hw_primary", "after write overflow - (write offset, max bytes) = (%d, %d)");
      v43 = v99;
    }
    _android_log_print(2, "audio_hw_primary", "after slim read");
    v44 = v54;
    if ( !v53 )
      goto LABEL_101;
LABEL_106:
    if ( *(_DWORD *)(v16 + 4) )
    {
      HIDWORD(v5) = 0;
      v62 = v5;
LABEL_123:
      v64 = *(_DWORD *)(v3 + 108);
      if ( v64 >= v62 )
      {
        _android_log_print(3, "audio_hw_primary", "hal read memcpy cvq %d", v62, v93, v94);
        v65 = *(_QWORD *)(v3 + 96);
        if ( HIDWORD(v65) + v62 <= (signed int)v65 )
        {
          _aeabi_memcpy(v44 + HIDWORD(v5), *(_DWORD *)(v3 + 92) + HIDWORD(v65));
          *(_DWORD *)(v3 + 100) += v62;
          *(_DWORD *)(v3 + 108) -= v62;
        }
        else
        {
          _android_log_print(3, "audio_hw_primary", "before read overflow - (read offset, max size) = (%d, %d)");
          v66 = *(_QWORD *)(v3 + 96);
          v67 = HIDWORD(v66) + v62 - v66;
          if ( v62 - v67 >= 1 )
            _aeabi_memcpy(v44 + HIDWORD(v5), HIDWORD(v66) + *(_DWORD *)(v3 + 92));
          _aeabi_memcpy(v44 + HIDWORD(v5) + v62 - v67, *(_DWORD *)(v3 + 92));
          *(_DWORD *)(v3 + 100) = v67;
          *(_DWORD *)(v3 + 108) -= v62;
          _android_log_print(
            3,
            "audio_hw_primary",
            "after read overflow - (read offset, max size) = (%d, %d)",
            v67,
            *(_DWORD *)(v3 + 96));
        }
        _android_log_print(2, "audio_hw_primary", "hal read memcpy end cvq %d", v62);
        _android_log_print(2, "audio_hw_primary", "read/write offset - %d/%d ", *(_QWORD *)(v3 + 100), v95);
      }
      else
      {
        _android_log_print(
          6,
          "audio_hw_primary",
          "#### Not enough data for reading in circular buffer (filled, req) = (%d, %d) ####",
          v64,
          v62,
          v94);
      }
      goto LABEL_131;
    }
    if ( *(_DWORD *)v16 != 1 )
      goto LABEL_131;
    HIDWORD(v5) = (*v43)(v16, v44, v5);
    if ( HIDWORD(v5) )
      goto LABEL_111;
    if ( *(_DWORD *)(v16 + 8) )
      break;
    _android_log_print(3, "audio_hw_primary", "CVQ data not ready!");
    usleep(0x2710u);
  }
  HIDWORD(v5) = 0;
LABEL_111:
  if ( HIDWORD(v5) < (unsigned int)v5 && *(_DWORD *)(v16 + 8) )
  {
    _android_log_print(3, "audio_hw_primary", "end of uartstreaming");
    *(_DWORD *)(v16 + 4) = 1;
    (*(void (__fastcall **)(int))(v16 + 320080))(v16);
    LODWORD(v5) = HIDWORD(v5);
    HIDWORD(v5) = v3 + 116;
    goto LABEL_177;
  }
  _android_log_print(2, "audio_hw_primary", "hal read strm end cvq %d", HIDWORD(v5), v93, v94);
  if ( *(_DWORD *)(v16 + 4) )
  {
    v62 = v5 - HIDWORD(v5);
    goto LABEL_123;
  }
LABEL_131:
  HIDWORD(v5) = v3 + 116;
LABEL_173:
  if ( !v53 && *(_BYTE *)(v96 + 180) )
    _aeabi_memclr(v44, v5);
  j_pcm_data_dump("/sdcard/Android/log/audio_dump/audio_hw_in.pcm", v44, v5, (int)"audio.hw.pcm.dump");
LABEL_177:
  if ( v53 <= -1 )
  {
LABEL_178:
    v84 = (*(int (__fastcall **)(_DWORD))(v3 + 16))(v3);
    v85 = (v84 & 0xFF000000) == 218103808;
    if ( (v84 & 0xFF000000) != 218103808 )
      v85 = (v84 & 0xFF000000) == 0;
    if ( !v85 )
    {
      v87 = 1;
      goto LABEL_196;
    }
    switch ( v84 )
    {
      case 3:
      case 4:
      case 5:
        v86 = 4;
        break;
      case 1:
        goto LABEL_185;
      case 2:
        v86 = 1;
        break;
      case 6:
        v86 = 3;
        break;
      default:
        if ( v84 == 218103808 )
LABEL_185:
          v86 = 2;
        else
          v86 = 0;
        break;
    }
    v88 = (*(int (__fastcall **)(_DWORD))(v3 + 12))(v3);
    if ( 2 == v88 >> 30 )
    {
      v89 = v88 & 0x3FFFFFFF;
LABEL_193:
      v90 = ((v89 - ((v89 >> 1) & 0x55555555)) & 0x33333333) + (((v89 - ((v89 >> 1) & 0x55555555)) >> 2) & 0x33333333);
      v91 = 16843009 * ((v90 + (v90 >> 4)) & 0xF0F0F0F) >> 24;
    }
    else
    {
      if ( !(v88 >> 30) )
      {
        v89 = v88 & 0xFFFC;
        goto LABEL_193;
      }
      v91 = 0;
    }
    v87 = v91 * v86;
LABEL_196:
    usleep(1000000 * (signed int)v5 / (unsigned int)(*(_DWORD *)(v3 + 128) * v87));
  }
  pthread_mutex_unlock((pthread_mutex_t *)HIDWORD(v5));
  if ( _stack_chk_guard != v102 )
    _stack_chk_fail(_stack_chk_guard - v102);
  return v5;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3050: using guessed type int __fastcall pcm_open(_DWORD, _DWORD, _DWORD, _DWORD);
// 305C: using guessed type int pcm_is_ready(void);
// 30A4: using guessed type int __fastcall pcm_get_error(_DWORD);
// 30B0: using guessed type int __fastcall pcm_close(_DWORD);
// 335C: using guessed type int __fastcall _aeabi_memclr(_DWORD, _DWORD);
// 3368: using guessed type int __fastcall create_resampler(_DWORD, _DWORD, _DWORD, _DWORD);
// 338C: using guessed type int __fastcall pcm_read(_DWORD, _DWORD, _DWORD);
// 3398: using guessed type int __fastcall _aeabi_memcpy(_DWORD, _DWORD);
// 8C90: using guessed type int sub_8C90();
// 11034: using guessed type int dword_11034;

//----- (00008A58) --------------------------------------------------------
int __fastcall sub_8A58(int a1)
{
  int v1; // r4@1
  size_t v2; // r5@1
  char *v3; // r10@1
  const char *v4; // r7@1
  const char *v5; // r6@1
  int v6; // r0@2
  int v7; // r1@3
  const char *v8; // r6@4
  int v9; // r7@6
  bool v10; // zf@6
  int v11; // r0@6
  size_t v12; // r7@6
  int v13; // r11@8
  size_t v14; // r0@11
  size_t v16; // [sp+0h] [bp-28h]@1

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 88);
  _android_log_print(3, "audio_hw_primary", "%s():...%d", "pcm_read_thread", 898);
  v3 = 0;
  v4 = "%s: before slim read";
  v5 = "%s: after slim read";
  do
  {
    _android_log_print(2, "audio_hw_primary", v4, "pcm_read_thread");
    v6 = *(_DWORD *)(v1 + 96);
    if ( (signed int)(*(_DWORD *)(v1 + 108) + v2) < v6 )
    {
      v7 = *(_DWORD *)(v1 + 104);
      if ( (signed int)(v7 + v2) <= v6 )
      {
        v10 = pcm_read(*(_DWORD *)(v1 + 120), v7 + *(_DWORD *)(v1 + 92), v2) == 0;
        v14 = 0;
        if ( v10 )
          v14 = v2;
        *(_DWORD *)(v1 + 104) += v14;
        *(_DWORD *)(v1 + 108) += v14;
      }
      else
      {
        v8 = v4;
        v3 = (char *)malloc(v2);
        if ( !v3 )
          _android_log_print(6, "audio_hw_primary", "%s: malloc fail!!!", "pcm_read_thread");
        v9 = pcm_read(*(_DWORD *)(v1 + 120), v3, v2);
        _android_log_print(
          3,
          "audio_hw_primary",
          "before write overflow %d, %d",
          *(_DWORD *)(v1 + 104),
          *(_DWORD *)(v1 + 96));
        v10 = v9 == 0;
        v11 = *(_DWORD *)(v1 + 104);
        v12 = 0;
        if ( v10 )
          v12 = v2;
        v13 = v11 + v12 - *(_DWORD *)(v1 + 96);
        if ( (signed int)(v12 - v13) >= 1 )
          _aeabi_memcpy(v11 + *(_DWORD *)(v1 + 92), v3);
        *(_DWORD *)(v1 + 104) = 0;
        _aeabi_memcpy(*(_DWORD *)(v1 + 92), &v3[v12] - v13);
        *(_DWORD *)(v1 + 104) += v13;
        *(_DWORD *)(v1 + 108) += v12;
        v16 = v12;
        _android_log_print(3, "audio_hw_primary", "after write overflow %d : %d");
        v4 = v8;
        v5 = "%s: after slim read";
      }
    }
    _android_log_print(2, "audio_hw_primary", v5, "pcm_read_thread", v16);
    usleep(0x2710u);
  }
  while ( !*(_DWORD *)(v1 + 76) );
  if ( v3 )
    free(v3);
  _android_log_print(4, "audio_hw_primary", "#### pcm read thread exit ####");
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 338C: using guessed type int __fastcall pcm_read(_DWORD, _DWORD, _DWORD);
// 3398: using guessed type int __fastcall _aeabi_memcpy(_DWORD, _DWORD);

//----- (00008BD4) --------------------------------------------------------
signed int __fastcall sub_8BD4(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r5@1
  signed int result; // r0@1
  int v5; // r6@3
  unsigned int v6; // r0@4
  int v7; // r7@5
  int v8; // r0@5
  int v9; // r3@5
  bool v10; // cf@8
  unsigned int v11; // r1@10
  unsigned int v12; // r1@12

  v2 = a1;
  v3 = a2;
  result = -22;
  if ( v2 && a2 )
  {
    v5 = *(_DWORD *)(v2 - 16);
    if ( !v5 )
    {
      *(_DWORD *)a2 = 0;
      *(_DWORD *)(a2 + 4) = 0;
      result = -19;
      *(_DWORD *)(v2 + 16) = -19;
      return result;
    }
    v6 = *(_DWORD *)(v2 + 12);
    if ( !v6 )
    {
      v7 = *(_DWORD *)(v2 + 8);
      v8 = pcm_frames_to_bytes(*(_DWORD *)(v2 - 16), unk_11038);
      v9 = pcm_read(v5, v7, v8);
      *(_DWORD *)(v2 + 16) = v9;
      if ( v9 )
      {
        _android_log_print(6, "audio_hw_primary", "get_next_buffer() pcm_read error %d");
        *(_DWORD *)v3 = 0;
        *(_DWORD *)(v3 + 4) = 0;
        return *(_DWORD *)(v2 + 16);
      }
      v6 = unk_11038;
      v10 = unk_11038 >= 2u;
      *(_DWORD *)(v2 + 12) = unk_11038;
      if ( v10 )
      {
        v11 = 1;
        do
        {
          *(_WORD *)(*(_DWORD *)(v2 + 8) + 2 * v11) = *(_WORD *)(*(_DWORD *)(v2 + 8) + 4 * v11);
          ++v11;
          v6 = *(_DWORD *)(v2 + 12);
        }
        while ( v11 < v6 );
      }
    }
    v12 = *(_DWORD *)(v3 + 4);
    if ( v12 > v6 )
      v12 = v6;
    *(_DWORD *)(v3 + 4) = v12;
    *(_DWORD *)v3 = *(_QWORD *)(v2 + 8) + 2 * (unk_11038 - (*(_QWORD *)(v2 + 8) >> 32));
    return *(_DWORD *)(v2 + 16);
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 3104: using guessed type int __fastcall pcm_frames_to_bytes(_DWORD, _DWORD);
// 338C: using guessed type int __fastcall pcm_read(_DWORD, _DWORD, _DWORD);

//----- (00008C9E) --------------------------------------------------------
int __fastcall audio_route_update_mixer(int a1)
{
  int v1; // r8@1
  unsigned int v2; // r12@1
  unsigned int v3; // r6@2
  int v4; // r0@3
  int v5; // r1@3
  unsigned int v6; // lr@3
  unsigned int v7; // r5@4
  int v8; // r0@5
  int v9; // r2@5
  __int64 v10; // kr00_8@5
  __int64 v11; // r0@12

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 4);
  if ( v2 )
  {
    v3 = 0;
    do
    {
      v4 = *(_DWORD *)(v1 + 8);
      v5 = v4 + 24 * v3;
      v6 = *(_DWORD *)(v5 + 4);
      if ( v6 <= 2 )
      {
        v7 = *(_DWORD *)(v5 + 8);
        if ( v7 )
        {
          v8 = *(_DWORD *)(v4 + 24 * v3);
          v9 = 0;
          v10 = *(_QWORD *)(v5 + 12);
          while ( *(_DWORD *)(v10 + 4 * v9) == *(_DWORD *)(HIDWORD(v10) + 4 * v9) )
          {
            if ( ++v9 >= v7 )
              goto LABEL_13;
          }
          if ( v6 == 2 )
            mixer_ctl_set_value(v8, 0, *(_DWORD *)HIDWORD(v10));
          else
            mixer_ctl_set_array(v8);
          v11 = *(_QWORD *)(*(_DWORD *)(v1 + 8) + 24 * v3 + 12);
          _aeabi_memcpy4(v11, HIDWORD(v11), 4 * v7);
          v2 = *(_DWORD *)(v1 + 4);
        }
      }
LABEL_13:
      ++v3;
    }
    while ( v3 < v2 );
  }
  return 0;
}
// 317C: using guessed type int __fastcall mixer_ctl_set_value(_DWORD, _DWORD, _DWORD);
// 33A4: using guessed type int __fastcall mixer_ctl_set_array(_DWORD);
// 33B0: using guessed type int __fastcall _aeabi_memcpy4(_DWORD, _DWORD, _DWORD);

//----- (00008D24) --------------------------------------------------------
unsigned int __fastcall audio_route_reset(int a1)
{
  int v1; // r4@1
  unsigned int result; // r0@1
  int v3; // r5@2
  unsigned int v4; // r6@2
  int v5; // r1@3

  v1 = a1;
  result = *(_DWORD *)(a1 + 4);
  if ( result )
  {
    v3 = 0;
    v4 = 0;
    do
    {
      v5 = *(_DWORD *)(v1 + 8) + v3;
      if ( *(_DWORD *)(v5 + 4) <= 2u )
      {
        _aeabi_memcpy4(*(_QWORD *)(v5 + 16), *(_QWORD *)(v5 + 16) >> 32, 4 * *(_DWORD *)(v5 + 8));
        result = *(_DWORD *)(v1 + 4);
      }
      ++v4;
      v3 += 24;
    }
    while ( v4 < result );
  }
  return result;
}
// 33B0: using guessed type int __fastcall _aeabi_memcpy4(_DWORD, _DWORD, _DWORD);

//----- (00008D54) --------------------------------------------------------
signed int __fastcall audio_route_apply_path(int a1, const char *a2)
{
  int v2; // r8@1
  const char *v3; // r6@1
  const char **v4; // r0@2
  const char **v5; // r5@2
  int v6; // r6@4
  unsigned int v7; // r7@4
  signed int result; // r0@6

  v2 = a1;
  v3 = a2;
  if ( a1 )
  {
    v4 = sub_8DE4(a1, a2);
    v5 = v4;
    if ( v4 )
    {
      if ( v4[2] )
      {
        v6 = 0;
        v7 = 0;
        do
        {
          _aeabi_memcpy4(
            *(_DWORD *)(*(_DWORD *)(v2 + 8) + 24 * *(_DWORD *)&v5[3][v6] + 16),
            *(_QWORD *)&v5[3][v6 + 4] >> 32,
            4 * *(_QWORD *)&v5[3][v6 + 4]);
          ++v7;
          v6 += 12;
        }
        while ( v7 < (unsigned int)v5[2] );
      }
      result = 0;
    }
    else
    {
      _android_log_print(6, "audio_route", "unable to find path '%s'", v3);
      result = -1;
    }
  }
  else
  {
    _android_log_print(6, "audio_route", "invalid audio_route");
    result = -1;
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 33B0: using guessed type int __fastcall _aeabi_memcpy4(_DWORD, _DWORD, _DWORD);

//----- (00008DE4) --------------------------------------------------------
const char **__fastcall sub_8DE4(int a1, const char *a2)
{
  unsigned int v2; // r6@1
  const char *v3; // r5@1
  const char **v4; // r4@2
  unsigned int v5; // r7@2

  v2 = *(_DWORD *)(a1 + 16);
  v3 = a2;
  if ( v2 )
  {
    v4 = *(const char ***)(a1 + 20);
    v5 = 0;
    while ( strcmp(*v4, v3) )
    {
      ++v5;
      v4 += 4;
      if ( v5 >= v2 )
        goto LABEL_5;
    }
  }
  else
  {
LABEL_5:
    v4 = 0;
  }
  return v4;
}

//----- (00008E0C) --------------------------------------------------------
signed int __fastcall audio_route_reset_path(int a1, const char *a2)
{
  int v2; // r4@1
  const char *v3; // r6@1
  const char **v4; // r0@2
  const char **v5; // r5@2
  int v6; // r6@4
  unsigned int v7; // r7@4
  int v8; // r1@5
  signed int result; // r0@6

  v2 = a1;
  v3 = a2;
  if ( a1 )
  {
    v4 = sub_8DE4(a1, a2);
    v5 = v4;
    if ( v4 )
    {
      if ( v4[2] )
      {
        v6 = 0;
        v7 = 0;
        do
        {
          v8 = *(_DWORD *)(v2 + 8) + 24 * *(_DWORD *)&v5[3][v6];
          _aeabi_memcpy4(*(_QWORD *)(v8 + 16), *(_QWORD *)(v8 + 16) >> 32, 4 * *(_DWORD *)(v8 + 8));
          ++v7;
          v6 += 12;
        }
        while ( v7 < (unsigned int)v5[2] );
      }
      result = 0;
    }
    else
    {
      _android_log_print(6, "audio_route", "unable to find path '%s'", v3);
      result = -1;
    }
  }
  else
  {
    _android_log_print(6, "audio_route", "invalid audio_route");
    result = -1;
  }
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 33B0: using guessed type int __fastcall _aeabi_memcpy4(_DWORD, _DWORD, _DWORD);

//----- (00008E90) --------------------------------------------------------
_DWORD *__fastcall audio_route_init(int a1, const char *a2)
{
  int v2; // r4@1
  const char *v3; // r8@1
  _DWORD *v4; // r9@1
  int v5; // r0@2
  int v6; // r4@3
  void *v7; // r0@3
  unsigned int v8; // r6@5
  signed int v9; // r4@5
  int v10; // r7@6
  int v11; // r11@6
  unsigned int v12; // r5@6
  __int64 v13; // kr00_8@10
  const char *v14; // r4@12
  FILE *v15; // r5@14
  struct XML_ParserStruct *v16; // r0@15
  struct XML_ParserStruct *v17; // r6@15
  void *v18; // r0@17
  int v19; // r4@18
  int v20; // r2@19
  unsigned int v21; // r0@23
  int v22; // r4@24
  unsigned int v23; // r7@24
  int v24; // r2@25
  _DWORD *userData; // [sp+8h] [bp-38h]@16
  int v27; // [sp+Ch] [bp-34h]@16
  int v28; // [sp+10h] [bp-30h]@16
  int v29; // [sp+18h] [bp-28h]@1

  v2 = a1;
  v3 = a2;
  v29 = _stack_chk_guard;
  v4 = calloc(1u, 0x18u);
  if ( !v4 )
    goto LABEL_38;
  v5 = mixer_open(v2);
  *v4 = v5;
  if ( !v5 )
  {
    _android_log_print(6, "audio_route", "Unable to open the mixer, aborting.");
LABEL_37:
    free(v4);
LABEL_38:
    v4 = 0;
    goto LABEL_39;
  }
  v4[3] = 0;
  v4[4] = 0;
  v4[5] = 0;
  v6 = mixer_get_num_ctls();
  v4[1] = v6;
  v7 = malloc(24 * v6);
  v4[2] = v7;
  if ( !v7 )
  {
LABEL_36:
    mixer_close(*v4);
    goto LABEL_37;
  }
  if ( v6 )
  {
    v8 = 0;
    v9 = 20;
    do
    {
      v10 = mixer_get_ctl(*v4, v8);
      v11 = mixer_ctl_get_num_values(v10);
      *(_DWORD *)(v4[2] + v9 - 20) = v10;
      *(_DWORD *)(v4[2] + v9 - 12) = v11;
      v12 = mixer_ctl_get_type(v10);
      *(_DWORD *)(v4[2] + v9 - 16) = v12;
      if ( v12 <= 2 )
      {
        *(_DWORD *)(v4[2] + v9 - 8) = malloc(4 * v11);
        *(_DWORD *)(v4[2] + v9 - 4) = malloc(4 * v11);
        *(_DWORD *)(v4[2] + v9) = malloc(4 * v11);
        if ( v12 == 2 )
          **(_DWORD **)(v4[2] + v9 - 8) = mixer_ctl_get_value(v10, 0);
        else
          mixer_ctl_get_array(v10, *(_DWORD *)(v4[2] + v9 - 8), v11);
        v13 = *(_QWORD *)(v4[2] + v9 - 8);
        _aeabi_memcpy4(HIDWORD(v13), v13, 4 * v11);
      }
      ++v8;
      v9 += 24;
    }
    while ( v8 < v4[1] );
  }
  v14 = "/system/etc/mixer_paths.xml";
  if ( v3 )
    v14 = v3;
  v15 = fopen(v14, "r");
  if ( !v15 )
  {
    _android_log_print(6, "audio_route", "Failed to open %s", v14);
LABEL_35:
    sub_9570((int)v4);
    goto LABEL_36;
  }
  v16 = XML_ParserCreate(0);
  v17 = v16;
  if ( !v16 )
  {
    _android_log_print(6, "audio_route", "Failed to create XML parser");
LABEL_34:
    fclose(v15);
    goto LABEL_35;
  }
  v27 = 0;
  v28 = 0;
  userData = v4;
  XML_SetUserData(v16, &userData);
  XML_SetElementHandler(v17, (XML_StartElementHandler)sub_9130, (XML_EndElementHandler)sub_9568);
  do
  {
    v18 = XML_GetBuffer(v17, 1024);
    if ( !v18 )
      goto LABEL_33;
    v19 = _fread_chk(v18, 1, 1024, v15);
    if ( v19 < 0 )
      goto LABEL_33;
    v20 = 0;
    if ( !v19 )
      v20 = 1;
    if ( XML_ParseBuffer(v17, v19, v20) == XML_STATUS_ERROR )
    {
      _android_log_print(6, "audio_route", "Error in mixer xml (%s)", "/system/etc/mixer_paths.xml", -1);
LABEL_33:
      XML_ParserFree(v17);
      goto LABEL_34;
    }
  }
  while ( v19 );
  j_audio_route_update_mixer((int)v4);
  v21 = v4[1];
  if ( v21 )
  {
    v22 = 0;
    v23 = 0;
    do
    {
      v24 = v4[2] + v22;
      if ( *(_DWORD *)(v24 + 4) <= 2u )
      {
        _aeabi_memcpy4(*(_QWORD *)(v24 + 16) >> 32, *(_QWORD *)(v24 + 16), 4 * *(_DWORD *)(v24 + 8));
        v21 = v4[1];
      }
      ++v23;
      v22 += 24;
    }
    while ( v23 < v21 );
  }
  XML_ParserFree(v17);
  fclose(v15);
LABEL_39:
  if ( _stack_chk_guard != v29 )
    _stack_chk_fail(_stack_chk_guard - v29);
  return v4;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 2FF0: using guessed type int __fastcall mixer_open(_DWORD);
// 3008: using guessed type int __fastcall mixer_close(_DWORD);
// 30C8: using guessed type int __fastcall _fread_chk(_DWORD, _DWORD, _DWORD, _DWORD);
// 3170: using guessed type int __fastcall mixer_ctl_get_num_values(_DWORD);
// 33B0: using guessed type int __fastcall _aeabi_memcpy4(_DWORD, _DWORD, _DWORD);
// 33BC: using guessed type int mixer_get_num_ctls(void);
// 33C8: using guessed type int __fastcall mixer_get_ctl(_DWORD, _DWORD);
// 33D4: using guessed type int __fastcall mixer_ctl_get_type(_DWORD);
// 33E0: using guessed type int __fastcall mixer_ctl_get_value(_DWORD, _DWORD);
// 33EC: using guessed type int __fastcall mixer_ctl_get_array(_DWORD, _DWORD, _DWORD);
// 9568: using guessed type int sub_9568();

//----- (00009130) --------------------------------------------------------
int __fastcall sub_9130(__int64 a1, const char **a2)
{
  const char *v2; // r9@1
  int v3; // r10@2
  const char *v4; // r6@2
  const char *v5; // r7@2
  const char *v6; // r11@2
  int v7; // r0@14
  int v8; // r4@14
  unsigned int v9; // r0@15
  unsigned int v10; // r6@16
  int v11; // r0@20
  const char **v12; // r8@22
  int v13; // r6@23
  int v14; // r4@23
  unsigned int v15; // r1@24
  const char *v16; // r9@24
  int v17; // r0@25
  unsigned int v18; // r2@25
  _DWORD *v19; // r3@25
  signed int v20; // r0@30
  int v21; // r5@31
  int v22; // r7@31
  const char *v23; // r0@37
  __int64 v24; // r0@40
  signed int v25; // r1@41
  void *v26; // r0@43
  int v27; // r0@45
  unsigned int v28; // r0@46
  _DWORD *v29; // r1@47
  unsigned int v30; // r5@47
  unsigned int v31; // r0@54
  int v32; // r1@54
  int v33; // r10@57
  int v34; // r1@58
  unsigned int v35; // r2@59
  int v36; // r4@63
  int v37; // r7@63
  int v38; // r8@63
  unsigned int v39; // r0@64
  _DWORD *v40; // r1@65
  signed int v41; // r4@65
  int v42; // r0@69
  int v43; // r3@70
  const char *v44; // r1@70
  const char *v45; // r2@70
  signed int v46; // r0@72
  int v47; // r0@79
  int result; // r0@84
  int v49; // [sp+0h] [bp-38h]@0
  __int64 v50; // [sp+8h] [bp-30h]@2
  int v51; // [sp+10h] [bp-28h]@1

  v51 = a1;
  v2 = *a2;
  LODWORD(a1) = *(_DWORD *)a1;
  if ( *a2 )
  {
    v3 = (int)(a2 + 1);
    v4 = 0;
    v5 = 0;
    v6 = 0;
    v50 = a1;
    do
    {
      if ( !strcmp(v2, "name") )
        v4 = *(const char **)v3;
      if ( !strcmp(v2, "id") )
      {
        v5 = *(const char **)v3;
      }
      else if ( !strcmp(v2, "value") )
      {
        v6 = *(const char **)v3;
      }
      v2 = *(const char **)(v3 + 4);
      v3 += 8;
    }
    while ( v2 );
  }
  else
  {
    v50 = a1;
    v4 = 0;
    v5 = 0;
    v6 = 0;
  }
  if ( strcmp((const char *)HIDWORD(v50), "path") )
  {
    if ( !strcmp((const char *)HIDWORD(v50), "ctl") )
    {
      v7 = mixer_get_ctl_by_name(*(_DWORD *)v50);
      v8 = v7;
      if ( v7 )
      {
        v9 = mixer_ctl_get_type(v7);
        if ( v9 >= 2 )
        {
          if ( v9 == 2 )
          {
            v10 = 0;
            if ( mixer_ctl_get_num_enums(v8) )
            {
              do
              {
                v23 = (const char *)mixer_ctl_get_enum_string(v8, v10);
                if ( !strcmp(v23, v6) )
                  break;
                ++v10;
              }
              while ( v10 < mixer_ctl_get_num_enums(v8) );
            }
          }
          else
          {
            v10 = 0;
          }
        }
        else
        {
          v10 = atoi(v6);
        }
        v28 = *(_DWORD *)(v50 + 4);
        if ( v28 )
        {
          v29 = *(_DWORD **)(v50 + 8);
          v30 = 0;
          do
          {
            if ( *v29 == v8 )
              break;
            ++v30;
            v29 += 6;
          }
          while ( v30 < v28 );
        }
        else
        {
          v30 = 0;
        }
        if ( *(_DWORD *)(v51 + 8) == 1 )
        {
          if ( v5 )
          {
            v31 = atoi(v5);
            v32 = *(_DWORD *)(v50 + 8) + 24 * v30;
            if ( v31 < *(_DWORD *)(v32 + 8) )
            {
              *(_DWORD *)(*(_DWORD *)(v32 + 16) + 4 * v31) = v10;
              goto LABEL_84;
            }
            v43 = mixer_ctl_get_name(v8);
            v44 = "audio_route";
            v45 = "value id out of range for mixer ctl '%s'";
LABEL_77:
            _android_log_print(6, v44, v45, v43, v49);
            goto LABEL_84;
          }
          v34 = *(_DWORD *)(v50 + 8);
          if ( *(_DWORD *)(v34 + 24 * v30 + 8) )
          {
            v35 = 0;
            do
            {
              *(_DWORD *)(*(_DWORD *)(v34 + 24 * v30 + 16) + 4 * v35++) = v10;
              v34 = *(_DWORD *)(v50 + 8);
            }
            while ( v35 < *(_DWORD *)(v34 + 24 * v30 + 8) );
          }
        }
        else
        {
          if ( v5 )
            v33 = atoi(v5);
          else
            v33 = -1;
          v36 = *(_DWORD *)(*(_DWORD *)(v50 + 8) + 24 * v30);
          v37 = *(_DWORD *)(v51 + 4);
          v38 = mixer_ctl_get_num_values(*(_DWORD *)(*(_DWORD *)(v50 + 8) + 24 * v30));
          if ( v33 >= v38 )
          {
            v42 = mixer_ctl_get_name(v36);
            _android_log_print(6, "audio_route", "mixer index %d is out of range for '%s'", v33, v42);
          }
          else
          {
            v39 = *(_DWORD *)(v37 + 8);
            if ( !v39 )
              goto LABEL_72;
            v40 = *(_DWORD **)(v37 + 12);
            v41 = 0;
            while ( *v40 != v30 )
            {
              ++v41;
              v40 += 3;
              if ( v41 >= v39 )
                goto LABEL_72;
            }
            if ( v41 <= -1 )
            {
LABEL_72:
              v46 = sub_95D4(v37);
              v41 = v46;
              if ( v46 < 0 )
                goto LABEL_84;
              *(_DWORD *)(*(_DWORD *)(v37 + 12) + 12 * v46) = v30;
              *(_DWORD *)(*(_DWORD *)(v37 + 12) + 12 * v46 + 4) = v38;
              *(_DWORD *)(*(_DWORD *)(v37 + 12) + 12 * v46 + 8) = malloc(4 * v38);
              **(_DWORD **)(*(_DWORD *)(v37 + 12) + 12 * v41 + 8) = v10;
            }
            if ( v33 == -1 )
            {
              if ( v38 )
              {
                v47 = 0;
                do
                  *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v37 + 12) + 12 * v41 + 8) + 4 * v47++) = v10;
                while ( v38 != v47 );
              }
            }
            else
            {
              *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v37 + 12) + 12 * v41 + 8) + 4 * v33) = v10;
            }
          }
        }
      }
      else
      {
        _android_log_print(6, "audio_route", "Control '%s' doesn't exist - skipping", v4);
      }
    }
    goto LABEL_84;
  }
  if ( !v4 )
  {
    _android_log_print(6, "audio_route", "Unnamed path!");
    goto LABEL_84;
  }
  if ( *(_DWORD *)(v51 + 8) == 1 )
  {
    if ( sub_8DE4(v50, v4) )
    {
      _android_log_print(6, "audio_route", "Path name '%s' already exists", v4);
      v11 = 0;
    }
    else
    {
      v24 = *(_QWORD *)(v50 + 12);
      if ( (unsigned int)v24 <= HIDWORD(v24) )
      {
        HIDWORD(v24) = 2 * v24;
        if ( !(_DWORD)v24 )
          v25 = 8;
        *(_DWORD *)(v50 + 12) = v25;
        v26 = realloc(*(void **)(v50 + 20), 16 * v25);
        if ( !v26 )
        {
          _android_log_print(6, "audio_route", "Unable to allocate more paths");
          v11 = 0;
          goto LABEL_83;
        }
        *(_DWORD *)(v50 + 20) = v26;
      }
      *(_DWORD *)((*(_QWORD *)(v50 + 16) >> 32) + 16 * *(_QWORD *)(v50 + 16)) = strdup(v4);
      *(_DWORD *)((*(_QWORD *)(v50 + 16) >> 32) + 16 * *(_QWORD *)(v50 + 16) + 4) = 0;
      *(_DWORD *)((*(_QWORD *)(v50 + 16) >> 32) + 16 * *(_QWORD *)(v50 + 16) + 8) = 0;
      *(_DWORD *)((*(_QWORD *)(v50 + 16) >> 32) + 16 * *(_QWORD *)(v50 + 16) + 12) = 0;
      v27 = *(_DWORD *)(v50 + 16);
      *(_DWORD *)(v50 + 16) = v27 + 1;
      v11 = *(_DWORD *)(v50 + 20) + 16 * v27;
    }
LABEL_83:
    *(_DWORD *)(v51 + 4) = v11;
    goto LABEL_84;
  }
  v12 = sub_8DE4(v50, v4);
  if ( v12[2] )
  {
    v13 = 0;
    v14 = *(_DWORD *)(v51 + 4);
    while ( 1 )
    {
      v15 = *(_DWORD *)(v14 + 8);
      v16 = v12[3];
      if ( v15 )
      {
        v17 = *(_DWORD *)&v16[12 * v13];
        v18 = 0;
        v19 = *(_DWORD **)(v14 + 12);
        while ( *v19 != v17 )
        {
          ++v18;
          v19 += 3;
          if ( v18 >= v15 )
            goto LABEL_30;
        }
        if ( v18 != -1 )
          break;
      }
LABEL_30:
      v20 = sub_95D4(v14);
      if ( v20 >= 0 )
      {
        v21 = (int)&v16[12 * v13];
        v22 = 3 * v20;
        *(_DWORD *)(*(_DWORD *)(v14 + 12) + 12 * v20) = *(_DWORD *)v21;
        *(_DWORD *)(*(_DWORD *)(v14 + 12) + 12 * v20 + 4) = *(_DWORD *)(v21 + 4);
        *(_DWORD *)(*(_DWORD *)(v14 + 12) + 4 * v22 + 8) = malloc(4 * *(_DWORD *)(v21 + 4));
        _aeabi_memcpy4(
          *(_DWORD *)(*(_DWORD *)(v14 + 12) + 4 * v22 + 8),
          *(_QWORD *)(v21 + 4) >> 32,
          4 * *(_QWORD *)(v21 + 4));
        if ( ++v13 < (unsigned int)v12[2] )
          continue;
      }
      goto LABEL_84;
    }
    v43 = mixer_ctl_get_name(*(_DWORD *)(*(_DWORD *)(v50 + 8) + 24 * v17));
    v49 = *(_DWORD *)v14;
    v44 = "audio_route";
    v45 = "Control '%s' already exists in path '%s'";
    goto LABEL_77;
  }
LABEL_84:
  result = *(_DWORD *)(v51 + 8) + 1;
  *(_DWORD *)(v51 + 8) = result;
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FFC: using guessed type int __fastcall mixer_get_ctl_by_name(_DWORD);
// 3170: using guessed type int __fastcall mixer_ctl_get_num_values(_DWORD);
// 33B0: using guessed type int __fastcall _aeabi_memcpy4(_DWORD, _DWORD, _DWORD);
// 33D4: using guessed type int __fastcall mixer_ctl_get_type(_DWORD);
// 3440: using guessed type int __fastcall mixer_ctl_get_num_enums(_DWORD);
// 344C: using guessed type int __fastcall mixer_ctl_get_enum_string(_DWORD, _DWORD);
// 3464: using guessed type int __fastcall mixer_ctl_get_name(_DWORD);

//----- (00009570) --------------------------------------------------------
void __fastcall sub_9570(int a1)
{
  int v1; // r4@1
  unsigned int v2; // r0@1
  int v3; // r6@2
  unsigned int v4; // r7@2
  int v5; // r1@3

  v1 = a1;
  v2 = *(_DWORD *)(a1 + 4);
  if ( v2 )
  {
    v3 = 0;
    v4 = 0;
    do
    {
      v5 = *(_DWORD *)(v1 + 8) + v3;
      if ( *(_DWORD *)(v5 + 4) <= 2u )
      {
        free(*(void **)(v5 + 12));
        free(*(void **)(*(_DWORD *)(v1 + 8) + v3 + 16));
        free(*(void **)(*(_DWORD *)(v1 + 8) + v3 + 20));
        v2 = *(_DWORD *)(v1 + 4);
      }
      ++v4;
      v3 += 24;
    }
    while ( v4 < v2 );
  }
  free(*(void **)(v1 + 8));
  *(_DWORD *)(v1 + 8) = 0;
}

//----- (000095BA) --------------------------------------------------------
void __fastcall audio_route_free(int a1)
{
  _DWORD *v1; // r4@1

  v1 = (_DWORD *)a1;
  sub_9570(a1);
  mixer_close(*v1);
  j_j_free(v1);
}
// 3008: using guessed type int __fastcall mixer_close(_DWORD);

//----- (000095D4) --------------------------------------------------------
unsigned int __fastcall sub_95D4(int a1)
{
  int v1; // r4@1
  unsigned int result; // r0@1
  __int64 v3; // kr00_8@1
  signed int v4; // r0@2
  void *v5; // r0@4

  v1 = a1;
  v3 = *(_QWORD *)(a1 + 4);
  result = *(_QWORD *)(a1 + 4) >> 32;
  if ( (unsigned int)v3 > result )
    goto LABEL_6;
  v4 = 2 * v3;
  if ( !(_DWORD)v3 )
    v4 = 8;
  *(_DWORD *)(v1 + 4) = v4;
  v5 = realloc(*(void **)(v1 + 12), 12 * v4);
  if ( v5 )
  {
    *(_DWORD *)(v1 + 12) = v5;
    result = *(_DWORD *)(v1 + 8);
LABEL_6:
    *(_DWORD *)(v1 + 8) = result + 1;
    return result;
  }
  _android_log_print(6, "audio_route", "Unable to allocate more path settings");
  return -1;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00009620) --------------------------------------------------------
signed int __fastcall get_value(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r0@3
  int v4; // r5@3

  v2 = a1;
  if ( a1 && a2 )
  {
    v3 = mixer_open(0);
    v4 = v3;
    if ( v3 )
    {
      if ( mixer_get_ctl_by_name(v3) )
        __debugbreak();
      printf("Invalid control name: %s\n", v2);
      mixer_close(v4);
    }
    else
    {
      puts("Failed to open mixer");
    }
  }
  else
  {
    puts("Invalid control name/value: NULL");
  }
  return -1;
}
// 2FF0: using guessed type int __fastcall mixer_open(_DWORD);
// 2FFC: using guessed type int __fastcall mixer_get_ctl_by_name(_DWORD);
// 3008: using guessed type int __fastcall mixer_close(_DWORD);

//----- (00009674) --------------------------------------------------------
signed int __fastcall set_value(int a1, const char *a2)
{
  int v2; // r6@1
  const char *v3; // r5@1
  int v4; // r0@3
  int v5; // r4@3
  int v6; // r0@4
  int v7; // r7@4
  int v8; // r0@5
  int v9; // r0@6
  signed int v10; // r5@6
  const char *v11; // r0@7
  const char *v12; // r0@8

  v2 = a1;
  v3 = a2;
  if ( a1 && a2 )
  {
    v4 = mixer_open(0);
    v5 = v4;
    if ( v4 )
    {
      v6 = mixer_get_ctl_by_name(v4);
      v7 = v6;
      if ( v6 )
      {
        v8 = mixer_ctl_get_type(v6);
        if ( (unsigned int)*v3 - 48 > 9 )
        {
          if ( v8 == 2 )
          {
            if ( !mixer_ctl_set_enum_by_string(v7, v3) )
            {
              v10 = 0;
              goto LABEL_18;
            }
            v11 = "Error: invalid enum value";
          }
          else
          {
            v11 = "Error: only enum types can be set with strings";
          }
        }
        else
        {
          v9 = atoi(v3);
          v10 = 0;
          if ( !mixer_ctl_set_value(v7, 0, v9) )
          {
LABEL_18:
            mixer_close(v5);
            return v10;
          }
          v11 = "Error: invalid value";
        }
        printf(v11);
      }
      else
      {
        printf("Invalid control name: %s", v2);
      }
      v10 = -1;
      goto LABEL_18;
    }
    v12 = "Failed to open mixer";
  }
  else
  {
    v12 = "Invalid control name/value: NULL";
  }
  printf(v12);
  return -1;
}
// 2FF0: using guessed type int __fastcall mixer_open(_DWORD);
// 2FFC: using guessed type int __fastcall mixer_get_ctl_by_name(_DWORD);
// 3008: using guessed type int __fastcall mixer_close(_DWORD);
// 317C: using guessed type int __fastcall mixer_ctl_set_value(_DWORD, _DWORD, _DWORD);
// 3320: using guessed type int __fastcall mixer_ctl_set_enum_by_string(_DWORD, _DWORD);
// 33D4: using guessed type int __fastcall mixer_ctl_get_type(_DWORD);

//----- (00009728) --------------------------------------------------------
signed int __fastcall cvq_open(int a1)
{
  int v1; // r4@1
  signed int v2; // r0@2
  const char *v3; // r1@2
  const char *v4; // r2@2
  FILE *v5; // r3@4
  signed int result; // r0@5
  int *v7; // r0@6
  int v8; // r5@6
  char *v9; // r0@6
  int v10; // [sp+8h] [bp-118h]@1
  char v11; // [sp+Ch] [bp-114h]@1
  char v12; // [sp+88h] [bp-98h]@1
  int v13; // [sp+10Ch] [bp-14h]@1

  v1 = a1;
  v13 = _stack_chk_guard;
  _aeabi_memcpy8(&v12, "Enable/Disable Streaming PATH/Endpoint", 128);
  _aeabi_memclr8(&v10, 128);
  v10 = 808989235;
  v11 = 48;
  _android_log_print(3, "CVQStream", "audio cvq %s", "cvq_open");
  if ( j_set_value((int)&v12, (const char *)&v10) )
  {
    v2 = 6;
    v3 = "CVQStream";
    v4 = "set streaming failed:%p";
  }
  else
  {
    v2 = 3;
    v3 = "CVQStream";
    v4 = "set streaming success:%p";
  }
  _android_log_print(v2, v3, v4, *(_DWORD *)(v1 + 320056));
  v5 = fopen("/dev/adnc2", "rb");
  *(_DWORD *)(v1 + 320056) = v5;
  if ( v5 )
  {
    _android_log_print(3, "CVQStream", "uart_char_dev open success:%p");
    result = 0;
  }
  else
  {
    v7 = (int *)_errno(0);
    v8 = *v7;
    v9 = strerror(*v7);
    _android_log_print(6, "CVQStream", "uart_char_dev open failed:%p %d %s", 0, v8, v9, v10, *(_DWORD *)&v11);
    result = -1;
  }
  *(_DWORD *)(v1 + 12) = 0;
  if ( _stack_chk_guard != v13 )
    _stack_chk_fail(result);
  return result;
}
// 2FC0: using guessed type int __fastcall _errno(_DWORD);
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3278: using guessed type int __fastcall _aeabi_memclr8(_DWORD, _DWORD);
// 3488: using guessed type int __fastcall _aeabi_memcpy8(_DWORD, _DWORD, _DWORD);

//----- (00009848) --------------------------------------------------------
int __fastcall cvq_close(int a1)
{
  int v1; // r4@1
  int v2; // r5@1
  FILE *v3; // r0@1

  v1 = a1;
  _android_log_print(3, "CVQStream", "audio cvq %s", "cvq_close");
  *(_DWORD *)(v1 + 320072) = 1;
  *(_DWORD *)(v1 + 16) = 0;
  pthread_join(*(_DWORD *)(v1 + 20), 0);
  pthread_join(*(_DWORD *)(v1 + 32), 0);
  v2 = 0;
  v3 = *(FILE **)(v1 + 320056);
  if ( v3 )
  {
    v2 = fclose(v3);
    *(_DWORD *)(v1 + 320056) = 0;
    _android_log_print(3, "CVQStream", "#### uart closed, ret = %d ####", v2);
  }
  *(_DWORD *)(v1 + 12) = 0;
  return v2;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (000098C4) --------------------------------------------------------
int __fastcall readdirect(int a1)
{
  int result; // r0@2

  if ( *(_DWORD *)(a1 + 8) )
    result = 0;
  else
    result = (*(int (**)(void))(a1 + 320096))();
  return result;
}

//----- (000098D8) --------------------------------------------------------
int __fastcall cvq_read(int a1, int a2, int a3)
{
  int v3; // r4@1
  int v4; // r5@1
  int v5; // r6@1
  int v6; // r7@1
  unsigned int v7; // r0@3

  v3 = a2;
  v4 = a1;
  v5 = a3;
  v6 = *(_DWORD *)(a1 + 320052) - *(_DWORD *)(a1 + 320048);
  if ( v6 >= a3 )
    goto LABEL_8;
  if ( *(_DWORD *)(a1 + 8) )
    goto LABEL_6;
  v7 = *(_DWORD *)(a1 + 16);
  *(_DWORD *)(v4 + 16) = v7 + 1;
  if ( v7 >= 0x28 )
  {
    *(_DWORD *)(v4 + 8) = 1;
    _android_log_print(3, "CVQStream", "#### CVQ read timeout, force end ####");
    if ( !*(_DWORD *)(v4 + 8) )
    {
LABEL_7:
      v5 = v6;
LABEL_8:
      *(_DWORD *)(v4 + 16) = 0;
      _aeabi_memcpy(v3, *(_DWORD *)(v4 + 320048) + v4 + 40);
      *(_DWORD *)(v4 + 320048) += v5;
      return v5;
    }
LABEL_6:
    _android_log_print(3, "CVQStream", "#### end of uart data ####");
    goto LABEL_7;
  }
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 3398: using guessed type int __fastcall _aeabi_memcpy(_DWORD, _DWORD);

//----- (0000996C) --------------------------------------------------------
int __fastcall read_on_thread(int a1)
{
  int v1; // r4@1
  int *v2; // r9@2
  int v3; // r0@3
  int v4; // r7@3
  int v5; // r0@8
  int v6; // r5@8

  v1 = a1;
  _android_log_print(3, "CVQStream", "readonthread called");
  _android_log_print(3, "CVQStream", "audio cvq %s", "read_on_thread");
  if ( !*(_DWORD *)(v1 + 320072) )
  {
    v2 = (int *)(v1 + 320052);
    do
    {
      v3 = *v2;
      v4 = 320;
      if ( *v2 + 320 > 160000 )
        v4 = 160000 - v3;
      if ( *(_DWORD *)(v1 + 320040) + v4 <= *(_DWORD *)(v1 + 320044) )
      {
        v5 = (*(int (__fastcall **)(int, int, int))(v1 + 320088))(v1, v1 + 40 + v3, v4);
        v6 = v5;
        if ( v5 >= 1 )
          *v2 += v5;
        usleep(0x3E8u);
        if ( v6 < v4 )
          return 0;
      }
      else
      {
        if ( *(_DWORD *)(v1 + 8) )
          return 0;
        _android_log_print(
          3,
          "CVQStream",
          "#### read_on_thread: UART data read thread lagging so wait till data is available ... ####");
        usleep(0x3E8u);
      }
    }
    while ( !*(_DWORD *)(v1 + 320072) );
  }
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00009A64) --------------------------------------------------------
int __fastcall read_on_raw_data_thread(int a1)
{
  int v1; // r4@1
  int *v2; // r6@1
  int *v3; // r9@1
  signed int v4; // r11@1
  int v5; // r7@3
  int v6; // r0@3
  int v7; // r0@5
  int v8; // r5@5

  v1 = a1;
  _android_log_print(3, "CVQStream", "#### read_on_raw_data_thread called ####");
  *(_DWORD *)(v1 + 320040) = 0;
  v2 = (int *)(v1 + 320056);
  v3 = (int *)(v1 + 320044);
  v4 = 0;
  do
  {
    if ( *(_DWORD *)(v1 + 320072) )
      break;
    v5 = 4096;
    v6 = *v3;
    if ( *v3 + 4096 > 160000 )
      v5 = 160000 - v6;
    v7 = j_uart_dev_read_wrapper(v1, v1 + 160040 + v6, 1, v5, *v2);
    v8 = v7;
    if ( v7 < 1 )
      break;
    *(_DWORD *)(v1 + 16) = 0;
    *v3 += v7;
    if ( !v4 )
    {
      _android_log_print(3, "CVQStream", "#### Start read_on_thread for UART data parsing and decoding ####");
      j_cvq_start_decode(v1);
      v4 = 1;
    }
  }
  while ( v8 >= v5 );
  if ( *v2 )
  {
    fclose((FILE *)*v2);
    *v2 = 0;
    _android_log_print(3, "CVQStream", "#### uart closed ####");
  }
  return 0;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00009B50) --------------------------------------------------------
int __fastcall uart_dev_read_wrapper(int a1, int a2, int a3, int a4, int a5)
{
  int v5; // r6@1
  int v6; // r4@1
  int v7; // r5@1
  int v8; // r6@2

  v5 = a2;
  v6 = a4;
  v7 = a3;
  if ( *(_DWORD *)(a1 + 320072) )
  {
    _android_log_print(6, "CVQStream", "#### cvqStream->exit = %d, skipping UART read ... ####");
    v8 = -1;
  }
  else
  {
    _android_log_print(3, "CVQStream", "#### Before UART read ####");
    v8 = _fread_chk(v5, v7, v6, a5);
    _android_log_print(3, "CVQStream", "#### After  UART read (req, actual) = (%d, %d) ####", v6 * v7, v8);
  }
  return v8;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 30C8: using guessed type int __fastcall _fread_chk(_DWORD, _DWORD, _DWORD, _DWORD);

//----- (00009BD4) --------------------------------------------------------
int __fastcall cvq_start_decode(int a1)
{
  int v1; // r4@1
  int result; // r0@1

  v1 = a1;
  _android_log_print(3, "CVQStream", "#### Start CVQ UART packet and/or data parsing/decoding called ####");
  result = pthread_create((pthread_t *)(v1 + 32), 0, (void *(*)(void *))read_on_thread, (void *)v1);
  if ( result <= -1 )
    result = _android_log_print(6, "CVQStream", "#### read_on_thread() thread creation failed ####");
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00009C24) --------------------------------------------------------
int __fastcall cvq_start(int a1)
{
  int v1; // r4@1
  int result; // r0@1

  v1 = a1;
  _android_log_print(3, "CVQStream", "#### start CVQ read thread called ####");
  result = pthread_create((pthread_t *)(v1 + 20), 0, (void *(*)(void *))read_on_raw_data_thread, (void *)v1);
  if ( result <= -1 )
    result = _android_log_print(6, "CVQStream", "#### read_on_raw_data_thread() thread creation failed ####");
  return result;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);

//----- (00009C74) --------------------------------------------------------
signed int __fastcall uart_read_wrapper(int a1, int a2, int a3)
{
  int v3; // r5@1
  int v4; // r4@1
  int v5; // r6@1
  int v6; // r0@4

  v3 = a1;
  v4 = a3;
  v5 = a2;
  if ( *(_DWORD *)(a1 + 320072) )
  {
    _android_log_print(6, "CVQStream", "#### cvqStream->exit = %d, skipping UART data decoding ... ####");
  }
  else
  {
    v6 = *(_DWORD *)(a1 + 320040);
    if ( (unsigned int)(v6 + a3) >= *(_DWORD *)(v3 + 320044) )
    {
      _android_log_print(3, "CVQStream", "#### skipping UART data decoding as UART read thread is lagging ... ####");
      return 0;
    }
    _aeabi_memcpy(a2, v6 + v3 + 160040);
    if ( v5 )
    {
      *(_DWORD *)(v3 + 320040) += v4;
      return v4;
    }
  }
  return -1;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 3398: using guessed type int __fastcall _aeabi_memcpy(_DWORD, _DWORD);

//----- (00009D00) --------------------------------------------------------
signed int __fastcall pcm_read_uart_char_dev(int a1, char *a2, signed int a3)
{
  int v3; // r6@1
  char *v4; // r4@1
  int v5; // r10@1
  int v6; // r7@2
  int *v7; // r8@2
  signed int v8; // r5@2
  int *v9; // r9@2
  int v10; // r0@3
  int v11; // r11@3
  int v12; // r2@6
  signed int v13; // r0@7
  signed int v14; // r0@10
  int v15; // r0@12
  signed int v16; // r0@14
  bool v17; // zf@16
  char *v18; // r1@21
  int v19; // r0@21
  int v20; // r2@21
  signed int v21; // r0@24
  int v22; // r12@26
  int v23; // lr@26
  int v24; // r2@26
  int v25; // r11@26
  unsigned int v26; // r3@26
  int v27; // r1@26
  __int16 v28; // r0@26
  int v29; // r1@27
  int v30; // lr@27
  bool v31; // zf@29
  _DWORD *v32; // r0@40
  char *v33; // r0@44
  signed int v34; // r2@44
  int v35; // t1@45
  int v37; // [sp+1Ch] [bp-34h]@2
  unsigned __int8 v38; // [sp+20h] [bp-30h]@24
  unsigned __int8 v39; // [sp+21h] [bp-2Fh]@26
  unsigned __int8 v40; // [sp+22h] [bp-2Eh]@26
  unsigned __int8 v41; // [sp+23h] [bp-2Dh]@26
  unsigned __int8 v42; // [sp+25h] [bp-2Bh]@26
  char v43; // [sp+26h] [bp-2Ah]@14
  char v44; // [sp+27h] [bp-29h]@17
  int v45; // [sp+28h] [bp-28h]@1

  v3 = a1;
  v4 = a2;
  v45 = _stack_chk_guard;
  v5 = a3 / 2;
  if ( a3 <= 1 )
  {
    v32 = (_DWORD *)(a1 + 12);
    v8 = 0;
  }
  else
  {
    v6 = (int)&a2[a3 / 2];
    v7 = (int *)(a1 + 320068);
    v8 = 0;
    v9 = (int *)(a1 + 320072);
    v37 = a1 + 12;
LABEL_3:
    v10 = *v9;
    v11 = v5 - v8;
    while ( !v10 )
    {
      v12 = *v7;
      if ( *v7 <= v11 )
      {
        if ( v12 < 1 )
          goto LABEL_13;
        v14 = j_uart_read_wrapper(v3, v6, v12);
        if ( v14 )
        {
          if ( v14 == -1 )
            break;
          v15 = *v7;
          *v7 = 0;
          v8 += v15;
          v6 += v15;
LABEL_13:
          if ( *(_DWORD *)(v3 + 8) )
            break;
          v16 = j_uart_read_wrapper(v3, (int)&v43, 2);
          if ( v16 )
          {
            if ( v16 == -1 )
              break;
            do
            {
              v17 = v43 == 18;
              if ( v43 == 18 )
                v17 = v44 == 52;
              if ( v17 || *v9 )
                break;
              if ( v44 == 18 )
              {
                v18 = &v44;
                v43 = 18;
                v19 = v3;
                v20 = 1;
              }
              else
              {
                v19 = v3;
                v18 = &v43;
                v20 = 2;
              }
            }
            while ( j_uart_read_wrapper(v19, (int)v18, v20) != -1 );
            v21 = j_uart_read_wrapper(v3, (int)&v38, 6);
            if ( v21 )
            {
              if ( v21 == -1 )
                break;
              v22 = v42;
              v23 = v38;
              v24 = v39;
              v17 = (v42 & 0x40) == 0;
              v25 = v42 & 0x80;
              v26 = (v42 & 0x40u) >> 6;
              v27 = v40;
              v28 = v41;
              *(_DWORD *)(v3 + 8) = v25;
              *(_DWORD *)(v3 + 12) = v26;
              if ( v17 )
              {
                *v9 = 1;
                *(_DWORD *)(v3 + 8) = 1;
                _android_log_print(3, "CVQStream", "#### CVQ read aborted because normal streaming data received ####");
                v8 = 0;
                break;
              }
              v29 = v27 | (signed __int16)(v28 << 8);
              v30 = v23 | 16 * v24 & 0xF00;
              if ( v29 < 320 )
              {
                if ( v29 != 80 && v29 != 160 )
                  goto LABEL_37;
              }
              else if ( v29 != 320 )
              {
                v31 = v29 == 640;
                if ( v29 != 640 )
                  v31 = v29 == 1280;
                if ( !v31 )
                {
LABEL_37:
                  v25 = 0;
                  v29 = 0;
                  *(_DWORD *)(v3 + 8) = 0;
                }
              }
              *v7 = v29;
              _android_log_print(
                3,
                "CVQStream",
                "#### Frame found - < ID : PKT # : LEN : EOD : MU-Law : EOD_BYTE > = <%5d : %5d : %5d : %5d : %5d : %5d> ####",
                v30,
                v24 & 0xF,
                v29,
                v25,
                v26,
                v22);
            }
          }
LABEL_39:
          if ( v5 > v8 )
            goto LABEL_3;
          break;
        }
      }
      else
      {
        v13 = j_uart_read_wrapper(v3, v6, v5 - v8);
        if ( v13 )
        {
          if ( v13 == -1 )
            break;
          v6 += v11;
          v8 = v5;
          *v7 -= v11;
          goto LABEL_39;
        }
      }
      v10 = *v9;
    }
    v32 = (_DWORD *)v37;
  }
  if ( *v32 )
  {
    if ( v8 >= 1 )
    {
      v33 = &v4[v5];
      v34 = v8;
      do
      {
        v35 = (unsigned __int8)*v33++;
        --v34;
        *(_WORD *)v4 = word_EE88[v35];
        v4 += 2;
      }
      while ( v34 );
    }
    v8 *= 2;
  }
  if ( _stack_chk_guard != v45 )
    _stack_chk_fail(_stack_chk_guard - v45);
  return v8;
}
// 2FD8: using guessed type int _android_log_print(_DWORD, _DWORD, const char *, ...);
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);

//----- (00009F24) --------------------------------------------------------
int __fastcall cvq_init(int a1)
{
  *(_DWORD *)(a1 + 320076) = cvq_open;
  *(_DWORD *)(a1 + 320080) = cvq_close;
  *(_DWORD *)(a1 + 320084) = cvq_start;
  *(_DWORD *)(a1 + 320088) = readdirect;
  *(_DWORD *)(a1 + 320092) = cvq_read;
  *(_DWORD *)(a1 + 320096) = pcm_read_uart_char_dev;
  __asm { VMOV.I32        Q8, #0 }
  *(_DWORD *)(a1 + 320068) = 0;
  _R1 = a1;
  __asm { VST1.32         {D16-D17}, [R1]! }
  *(_DWORD *)(a1 + 320072) = 0;
  *(_DWORD *)a1 = 0;
  *(_DWORD *)(a1 + 320056) = 0;
  _R0 = a1 + 320040;
  __asm { VST1.32         {D16-D17}, [R0] }
  return 0;
}

//----- (00009FE0) --------------------------------------------------------
int __fastcall sub_9FE0(int result, signed int *a2, int *a3)
{
  unsigned int v3; // r3@1
  unsigned int v4; // t1@2
  int v5; // r12@3
  bool v6; // zf@4
  int v7; // r3@8
  signed int v8; // r12@8

  v3 = *(_DWORD *)result;
  if ( *(_DWORD *)result >= 0 )
  {
    *a2 = 1;
    v4 = *(_DWORD *)(result + 4);
    result += 4;
    *a3 = 4 * (v4 >> 24) + 4;
    return result;
  }
  v5 = (v3 >> 24) & 0xF;
  if ( v5 )
  {
    v6 = v5 == 3;
    if ( v5 != 3 )
      v6 = v5 == 1;
    if ( !v6 )
      return 0;
    v7 = 4 * ((v3 >> 16) & 0xFF) + 4;
    v8 = 2;
  }
  else
  {
    v8 = 1;
    v7 = 4;
  }
  *a3 = v7;
  *a2 = v8;
  return result;
}

//----- (0000A034) --------------------------------------------------------
signed int __fastcall sub_A034(int a1, int a2, unsigned int a3, unsigned int a4)
{
  int v4; // r4@1
  unsigned int v5; // r5@1
  unsigned int v6; // r11@1
  int v7; // r9@1
  unsigned int v8; // r7@3
  int v9; // r10@3
  int v10; // r0@4
  int v11; // r2@5
  int v12; // r1@6
  signed int result; // r0@6
  int v14; // r3@10
  int v15; // r2@10
  int v16; // r0@10
  int v17; // r1@10
  int v18; // r1@24
  int v19; // r6@24
  int v20; // r2@26
  int v21; // r0@28
  int v22; // r1@28
  int v23; // r3@28
  int v24; // r0@30
  int v25; // r2@30
  int v26; // r0@40
  unsigned int v33; // r1@41
  unsigned int v34; // r0@41
  int v35; // r1@43
  unsigned int v36; // r0@45
  int v37; // [sp+0h] [bp-30h]@2
  int v38; // [sp+4h] [bp-2Ch]@4
  int v39; // [sp+8h] [bp-28h]@1

  v4 = a1;
  v5 = a4;
  v6 = a3;
  v7 = a2;
  v39 = _stack_chk_guard;
  if ( a3 >= a4 )
  {
LABEL_54:
    sub_A928(v4, 14, &v38);
    sub_A956(v4, 15, v38);
    goto LABEL_55;
  }
  v37 = 0;
  do
  {
    v8 = v6 + 1;
    v9 = *(_BYTE *)(v7 + (v6 ^ 3));
    if ( !(v9 & 0x80) )
    {
      sub_A928(v4, 13, &v38);
      v10 = 4 * v9;
      if ( v9 & 0x40 )
        v11 = -4 - (v10 & 0xFC) + v38;
      else
        v11 = v10 + v38 + 4;
LABEL_12:
      v38 = v11;
LABEL_13:
      sub_A956(v4, 13, v11);
LABEL_36:
      v6 = v8;
      continue;
    }
    v12 = v9 & 0xF0;
    result = 9;
    if ( v12 > 175 )
    {
      if ( v12 == 176 )
      {
        result = 9;
        v18 = 0;
        v19 = 0;
        switch ( v9 )
        {
          case 177:
            if ( v8 >= v5 )
              goto def_A1D8;
            v20 = *(_BYTE *)(v7 + (v8 ^ 3));
            result = 9;
            if ( !*(_BYTE *)(v7 + (v8 ^ 3)) || v20 & 0xF0 )
              goto LABEL_56;
            v21 = v4;
            v22 = 0;
            v23 = 0;
            goto LABEL_48;
          case 178:
            break;
          case 179:
            v23 = 1;
            v26 = *(_BYTE *)(v7 + (v8 ^ 3));
            _R1 = v26 << 12;
            __asm { UXTB16.W        R1, R1 }
            v20 = ((v26 & 0xF) + 1) | _R1;
            v21 = v4;
            v22 = 1;
LABEL_48:
            sub_A414(v21, v22, v20, v23);
            goto LABEL_49;
          case 176:
            goto LABEL_53;
          case 180:
          case 181:
          case 182:
          case 183:
            goto LABEL_56;
          default:
            v17 = 1;
            v14 = 1;
            v15 = ((v9 & 7) + 1) | 0x80000;
            v16 = v4;
            goto LABEL_35;
        }
        while ( v8 < v5 )
        {
          v24 = v8++ ^ 3;
          LOBYTE(v24) = *(_BYTE *)(v7 + v24);
          v25 = (v24 & 0x7F) << v18;
          v18 += 7;
          v19 |= v25;
          if ( !(v24 & 0x80) )
          {
            sub_A928(v4, 13, &v38);
            v11 = v38 + 4 * v19 + 516;
            goto LABEL_12;
          }
        }
      }
      else
      {
        if ( v12 != 192 )
        {
          if ( v12 != 208 )
            goto LABEL_56;
          if ( v9 & 8 )
            goto def_A1D8;
          v17 = 1;
          v15 = ((v9 & 7) + 1) | 0x80000;
          v16 = v4;
LABEL_34:
          v14 = 5;
          goto LABEL_35;
        }
        switch ( v9 )
        {
          case 192:
          case 193:
          case 194:
          case 195:
          case 196:
          case 197:
            v17 = 3;
            v15 = ((v9 & 7) + 1) | 0xA0000;
            v16 = v4;
            goto LABEL_34;
          case 200:
          case 201:
            v33 = *(_BYTE *)(v7 + (v8 ^ 3));
            v34 = v33 >> 4;
            if ( v9 == 200 )
              v34 = (v33 >> 4) | 0x10;
            v35 = v33 & 0xF;
            if ( v34 + v35 > 0x1F )
              break;
            v20 = (v35 + 1) | (v34 << 16);
            v21 = v4;
            v22 = 1;
            goto LABEL_47;
          case 198:
            v36 = *(_BYTE *)(v7 + (v8 ^ 3));
            if ( (v36 & 0xF) + (v36 >> 4) > 0xF )
              break;
            v20 = ((v36 & 0xF) + 1) | (v36 >> 4 << 16);
            v21 = v4;
            v22 = 3;
LABEL_47:
            v23 = 5;
            goto LABEL_48;
          case 199:
            if ( !*(_BYTE *)(v7 + (v8 ^ 3)) || (unsigned int)*(_BYTE *)(v7 + (v8 ^ 3)) >= 0x10 )
              break;
            goto LABEL_49;
          default:
            break;
        }
      }
def_A1D8:
      result = 9;
      goto LABEL_56;
    }
    if ( v12 != 128 )
    {
      if ( v12 == 144 )
      {
        if ( (v9 & 0xF | 2) == 15 )
          goto def_A1D8;
        sub_A928(v4, v9 & 0xF, &v38);
        v11 = v38;
        goto LABEL_13;
      }
      if ( v12 != 160 )
        goto LABEL_56;
      v14 = 0;
      v15 = ((16 << ((*(_BYTE *)(v7 + (v6 ^ 3)) & 7) + 1)) - 16) | (*(_BYTE *)(v7 + (v6 ^ 3)) << 11) & 0x4000;
      v16 = v4;
      v17 = 0;
LABEL_35:
      sub_A414(v16, v17, v15, v14);
      goto LABEL_36;
    }
    if ( v8 >= v5 || !((unsigned __int16)((_WORD)v9 << 12) | 16 * *(_BYTE *)(v7 + ((v6 + 1) ^ 3))) )
      goto def_A1D8;
    sub_A414(v4, 0, (unsigned __int16)((_WORD)v9 << 12) | 16 * *(_BYTE *)(v7 + (v8 ^ 3)), 0);
    v37 |= (((_WORD)v9 << 12) & 0x8000u) >> 15;
LABEL_49:
    v6 += 2;
  }
  while ( v6 < v5 );
LABEL_53:
  if ( !(v37 & 1) )
    goto LABEL_54;
LABEL_55:
  result = 8;
LABEL_56:
  if ( _stack_chk_guard != v39 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);

//----- (0000A378) --------------------------------------------------------
signed int __fastcall sub_A378(int a1, int a2, unsigned int a3, int a4, int *a5)
{
  int v5; // r5@1
  int v6; // r4@1
  signed int result; // r0@2
  int v8; // r2@4
  int v9; // r0@4
  int v10; // r1@4
  __int64 v11; // r2@7
  int v12; // r1@7

  v5 = a3;
  v6 = a1;
  switch ( a2 )
  {
    case 0:
      result = 2;
      if ( a3 > 0xF || a4 )
        return result;
      v8 = *a5;
      v9 = v6;
      v10 = v5;
      goto LABEL_11;
    case 3:
      result = 2;
      if ( a3 > 0x1F || a4 != 5 )
        return result;
      v11 = *(_QWORD *)a5;
      v12 = v5 + 112;
      goto LABEL_20;
    case 4:
      result = 2;
      if ( a3 > 3 || a4 )
        return result;
      v8 = *a5;
      v10 = v5 + 192;
      v9 = v6;
LABEL_11:
      result = sub_A956(v9, v10, v8);
      goto LABEL_21;
    case 1:
      if ( a4 == 5 )
      {
        if ( a3 <= 0x1F )
          goto LABEL_19;
        return 2;
      }
      if ( a4 != 1 || a3 > 0xF )
        return 2;
      sub_AA38(a1);
LABEL_19:
      v11 = *(_QWORD *)a5;
      v12 = v5 + 256;
LABEL_20:
      result = sub_A9CA(v6, v12, v11, SHIDWORD(v11));
LABEL_21:
      if ( result )
        result = 2;
      return result;
    default:
      sub_A794(
        (int)"_Unwind_VRS_Result _Unwind_VRS_Set(_Unwind_Context *, _Unwind_VRS_RegClass, uint32_t, _Unwind_VRS_DataRepre"
             "sentation, void *)",
        837,
        (int)"unsupported register class");
      return result;
  }
}

//----- (0000A414) --------------------------------------------------------
signed int __fastcall sub_A414(int a1, int a2, unsigned int a3, int a4)
{
  int v4; // r8@1
  int v5; // r5@1
  int v6; // r7@1
  unsigned int v7; // r6@1
  int v8; // r4@4
  unsigned int v9; // r7@4
  int *v10; // r0@6
  signed int v11; // r0@6
  signed int v12; // r1@6
  signed int v13; // r2@6
  signed int result; // r0@14
  unsigned int v15; // r4@18
  unsigned int v16; // r6@18
  int v17; // r0@19
  int v18; // r2@19
  int v19; // r0@19
  int v20; // r2@22
  int *v21; // [sp+8h] [bp-30h]@3
  int v22; // [sp+Ch] [bp-2Ch]@19
  int v23; // [sp+10h] [bp-28h]@6
  int v24; // [sp+14h] [bp-24h]@1

  v4 = a1;
  v5 = a2;
  v6 = a4;
  v7 = a3;
  v24 = _stack_chk_guard;
  switch ( a2 )
  {
    case 0:
    case 4:
      if ( a4 || sub_A928(a1, 13, &v21) )
        goto LABEL_23;
      v8 = 0;
      v9 = 0;
      do
      {
        if ( (1 << v9) & v7 )
        {
          v10 = v21;
          ++v21;
          v23 = *v10;
          v11 = sub_A378(v4, v5, v9, 0, &v23);
          v12 = 0;
          v13 = 0;
          if ( v9 == 13 )
            v12 = 1;
          if ( !v5 )
            v13 = 1;
          if ( v11 )
            goto LABEL_23;
          v8 |= v13 & v12;
        }
        ++v9;
      }
      while ( v9 < 0x10 );
      if ( v8 & 1 )
      {
        result = 0;
        goto LABEL_24;
      }
      v20 = (int)v21;
      goto LABEL_28;
    case 1:
    case 3:
      if ( (a4 | 4) != 5 || sub_A928(a1, 13, &v23) )
        goto LABEL_23;
      if ( !(_WORD)v7 )
        goto LABEL_21;
      v15 = v7 >> 16;
      v16 = (v7 >> 16) + v7;
      break;
    default:
      sub_A794(
        (int)"_Unwind_VRS_Result _Unwind_VRS_Pop(_Unwind_Context *, _Unwind_VRS_RegClass, uint32_t, _Unwind_VRS_DataRepresentation)",
        971,
        (int)"unsupported register class");
      return result;
  }
  do
  {
    v17 = v23;
    v23 += 4;
    v18 = *(_DWORD *)v17;
    v23 = v17 + 8;
    v19 = *(_DWORD *)(v17 + 4);
    v21 = (int *)v18;
    v22 = v19;
    if ( sub_A378(v4, v5, v15, v6, (int *)&v21) )
    {
LABEL_23:
      result = 2;
      goto LABEL_24;
    }
    ++v15;
  }
  while ( v15 < v16 );
LABEL_21:
  if ( v6 == 1 )
  {
    v20 = v23 + 4;
    v23 += 4;
  }
  else
  {
    v20 = v23;
  }
LABEL_28:
  result = sub_A956(v4, 13, v20);
  if ( result )
    result = 2;
LABEL_24:
  if ( _stack_chk_guard != v24 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);

//----- (0000A550) --------------------------------------------------------
signed int __fastcall sub_A550(int a1, int a2, int a3)
{
  return sub_A558(a2, a3);
}

//----- (0000A558) --------------------------------------------------------
signed int __fastcall sub_A558(int a1, int a2)
{
  int v2; // r5@1
  int v3; // r4@1
  signed int result; // r0@3
  int v5; // r1@4
  char v6; // [sp+4h] [bp-3Ch]@1
  _DWORD *v7; // [sp+Ch] [bp-34h]@2
  int v8; // [sp+2Ch] [bp-14h]@1

  v2 = a1;
  v3 = a2;
  v8 = _stack_chk_guard;
  sub_AA08(a2, (int)&v6);
  if ( *(_BYTE *)(v2 + 80) & 1 || !*v7 )
  {
    v5 = sub_AA02(v3);
    result = 9;
    if ( v5 == 1 )
      result = 8;
  }
  else
  {
    result = 9;
  }
  if ( _stack_chk_guard != v8 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);

//----- (0000A5B4) --------------------------------------------------------
signed int __fastcall sub_A5B4(int a1, int a2, int a3)
{
  return sub_A558(a2, a3);
}

//----- (0000A5BC) --------------------------------------------------------
signed int __fastcall sub_A5BC(int a1, int a2, int a3)
{
  return sub_A558(a2, a3);
}

//----- (0000A670) --------------------------------------------------------
int __fastcall sub_A670(int a1, int a2, char a3)
{
  int v3; // r4@1
  char v4; // r10@1
  signed int i; // r6@1
  signed int v6; // r7@3
  int (__fastcall *v7)(signed int, int, char *); // r3@9
  int v8; // r0@10
  int result; // r0@17
  int v10; // [sp+0h] [bp-4B8h]@16
  int v11; // [sp+4h] [bp-4B4h]@8
  int (__fastcall *v12)(signed int, int, char *); // [sp+10h] [bp-4A8h]@9
  int v13; // [sp+18h] [bp-4A0h]@10
  int v14; // [sp+24h] [bp-494h]@10
  int v15; // [sp+2Ch] [bp-48Ch]@8
  char v16; // [sp+30h] [bp-488h]@1
  int v17; // [sp+494h] [bp-24h]@1

  v3 = a2;
  v4 = a3;
  v17 = _stack_chk_guard;
  sub_A8E4((int)&v16, a1);
  for ( i = 1; ; --i )
  {
    v6 = 1;
    if ( v4 & 1 )
    {
      v6 = 2;
      if ( !i )
      {
        sub_A956((int)&v16, -1, *(_DWORD *)(v3 + 16));
        v4 = 0;
      }
    }
    sub_A928((int)&v16, -2, &v15);
    if ( sub_AA08((int)&v16, (int)&v11) )
      break;
    v7 = v12;
    if ( v12 )
    {
      *(_DWORD *)(v3 + 72) = v11;
      *(_DWORD *)(v3 + 76) = v14;
      *(_DWORD *)(v3 + 80) = v13;
      v8 = v7(v6, v3, &v16);
      if ( v8 == 7 )
      {
        sub_A928((int)&v16, -1, &v10);
        *(_DWORD *)(v3 + 16) = v10;
        sub_AA26((int)&v16);
        break;
      }
      if ( v8 != 8 )
      {
        if ( v8 == 9 )
          abort();
        break;
      }
      if ( v15 == *(_DWORD *)(v3 + 32) )
        sub_A794(
          (int)"_Unwind_Reason_Code unwind_phase2(unw_context_t *, _Unwind_Exception *, bool)",
          653,
          (int)"during phase1 personality function said it would stop here, but now in phase2 it did not stop here");
    }
  }
  result = _stack_chk_guard - v17;
  if ( _stack_chk_guard != v17 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);

//----- (0000A794) --------------------------------------------------------
void __fastcall sub_A794(int a1, int a2, int a3)
{
  fprintf((FILE *)stderr, "libunwind: %s %s:%d - %s\n", a1, "external/libunwind_llvm/src/Unwind-EHABI.cpp", a2, a3);
  abort();
}

//----- (0000A85C) --------------------------------------------------------
int __fastcall sub_A85C(int a1, int a2, int a3, int a4, int a5)
{
  int v5; // r4@0
  int v6; // r5@0
  int v7; // r6@0
  int v8; // r7@0
  int v9; // r8@0
  int v10; // r9@0
  int v11; // r10@0
  int v12; // r11@0
  int v13; // r12@0
  int v14; // lr@0

  *(_DWORD *)a1 = a1;
  *(_DWORD *)(a1 + 4) = a2;
  *(_DWORD *)(a1 + 8) = a3;
  *(_DWORD *)(a1 + 12) = a4;
  *(_DWORD *)(a1 + 16) = v5;
  *(_DWORD *)(a1 + 20) = v6;
  *(_DWORD *)(a1 + 24) = v7;
  *(_DWORD *)(a1 + 28) = v8;
  *(_DWORD *)(a1 + 32) = v9;
  *(_DWORD *)(a1 + 36) = v10;
  *(_DWORD *)(a1 + 40) = v11;
  *(_DWORD *)(a1 + 44) = v12;
  *(_DWORD *)(a1 + 48) = v13;
  *(_DWORD *)(a1 + 52) = &a5;
  *(_DWORD *)(a1 + 56) = v14;
  *(_DWORD *)(a1 + 60) = v14;
  return 0;
}

//----- (0000A874) --------------------------------------------------------
int __fastcall sub_A874(int _R0)
{
  int result; // r0@1

  __asm { VSTMIA          R0, {D0-D15} }
  return result;
}

//----- (0000A87C) --------------------------------------------------------
int __fastcall sub_A87C(int _R0)
{
  int result; // r0@1

  __asm { VSTMIA          R0, {D0-D15} }
  return result;
}

//----- (0000A884) --------------------------------------------------------
int __fastcall sub_A884(int _R0)
{
  int result; // r0@1

  __asm { VSTMIA          R0, {D16-D31} }
  return result;
}

//----- (0000A88C) --------------------------------------------------------
void sub_A88C()
{
  __asm
  {
    STCL            p1, c0, [R0],#8
    STCL            p1, c1, [R0],#8
    STCL            p1, c2, [R0],#8
    STCL            p1, c3, [R0],#8
    STCL            p1, c4, [R0],#8
    STCL            p1, c5, [R0],#8
    STCL            p1, c6, [R0],#8
    STCL            p1, c7, [R0],#8
    STCL            p1, c8, [R0],#8
    STCL            p1, c9, [R0],#8
    STCL            p1, c10, [R0],#8
    STCL            p1, c11, [R0],#8
    STCL            p1, c12, [R0],#8
    STCL            p1, c13, [R0],#8
    STCL            p1, c14, [R0],#8
    STCL            p1, c15, [R0],#8
  }
}

//----- (0000A8D0) --------------------------------------------------------
void sub_A8D0()
{
  __asm
  {
    STC2            p1, c8, [R0],#4
    STC2            p1, c9, [R0],#4
    STC2            p1, c10, [R0],#4
    STC2            p1, c11, [R0],#4
  }
}

//----- (0000A8E4) --------------------------------------------------------
int __fastcall sub_A8E4(int a1, int a2)
{
  int v2; // r4@1

  v2 = a1;
  *(_DWORD *)a1 = &off_10C0C;
  *(_DWORD *)(a1 + 4) = &unk_116E0;
  *(_BYTE *)(a1 + 76) = 0;
  *(_DWORD *)(a1 + 72) = 0;
  _aeabi_memcpy(a1 + 8, a2);
  _aeabi_memclr8(v2 + 80, 450);
  sub_AE00(v2, 0);
  return 0;
}
// 3278: using guessed type int __fastcall _aeabi_memclr8(_DWORD, _DWORD);
// 3398: using guessed type int __fastcall _aeabi_memcpy(_DWORD, _DWORD);
// 10C0C: using guessed type void *;

//----- (0000A928) --------------------------------------------------------
signed int __fastcall sub_A928(int a1, int a2, _DWORD *a3)
{
  int v3; // r6@1
  _DWORD *v4; // r4@1
  int v5; // r5@1
  signed int result; // r0@2

  v3 = a1;
  v4 = a3;
  v5 = a2;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 8))() == 1 )
  {
    *v4 = (*(int (__fastcall **)(int, int))(*(_DWORD *)v3 + 12))(v3, v5);
    result = 0;
  }
  else
  {
    result = -6542;
  }
  return result;
}

//----- (0000A956) --------------------------------------------------------
signed int __fastcall sub_A956(int a1, int a2, int a3)
{
  int v3; // r4@1
  int v4; // r6@1
  int v5; // r5@1
  signed int v6; // r5@3

  v3 = a1;
  v4 = a3;
  v5 = a2;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 8))() == 1 )
  {
    (*(void (__fastcall **)(int, int, int))(*(_DWORD *)v3 + 16))(v3, v5, v4);
    if ( v5 == -1 )
    {
      v6 = 0;
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)v3 + 52))(v3, 0);
    }
    else
    {
      v6 = 0;
    }
  }
  else
  {
    v6 = -6542;
  }
  return v6;
}

//----- (0000A99A) --------------------------------------------------------
signed int __fastcall sub_A99A(int a1, int a2, _QWORD *a3)
{
  int v3; // r6@1
  _QWORD *v4; // r4@1
  int v5; // r5@1
  __int64 v6; // r0@2
  signed int result; // r0@2

  v3 = a1;
  v4 = a3;
  v5 = a2;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 20))() == 1 )
  {
    LODWORD(v6) = (*(int (__fastcall **)(int, int))(*(_DWORD *)v3 + 24))(v3, v5);
    *v4 = v6;
    result = 0;
  }
  else
  {
    result = -6542;
  }
  return result;
}

//----- (0000A9CA) --------------------------------------------------------
signed int __fastcall sub_A9CA(int a1, int a2, int a3, int a4)
{
  int v4; // r7@1
  int v5; // r5@1
  int v6; // r8@1
  int v7; // r6@1
  signed int result; // r0@2

  v4 = a1;
  v5 = a3;
  v6 = a4;
  v7 = a2;
  if ( (*(int (**)(void))(*(_DWORD *)a1 + 20))() == 1 )
  {
    (*(void (__fastcall **)(int, int, int, int))(*(_DWORD *)v4 + 28))(v4, v7, v5, v6);
    result = 0;
  }
  else
  {
    result = -6542;
  }
  return result;
}

//----- (0000AA02) --------------------------------------------------------
int __fastcall sub_AA02(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)a1 + 32))();
}

//----- (0000AA08) --------------------------------------------------------
signed int __fastcall sub_AA08(int a1, int a2)
{
  int v2; // r4@1
  signed int result; // r0@1

  v2 = a2;
  (*(void (**)(void))(*(_DWORD *)a1 + 36))();
  result = 0;
  if ( !*(_DWORD *)(v2 + 4) )
    result = -6549;
  return result;
}

//----- (0000AA26) --------------------------------------------------------
signed int __fastcall sub_AA26(int a1)
{
  (*(void (**)(void))(*(_DWORD *)a1 + 40))();
  return -6540;
}

//----- (0000AA38) --------------------------------------------------------
int __fastcall sub_AA38(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)a1 + 60))();
}

//----- (0000AA3E) --------------------------------------------------------
int __fastcall sub_AA3E(int a1, int a2)
{
  signed int v2; // r2@1
  bool v3; // zf@1
  signed int v4; // r0@1
  unsigned int v5; // r1@1

  v2 = 0;
  v3 = (a2 & 0xFFFFFFFC) == 192;
  v4 = 0;
  v5 = a2 - 16;
  if ( v3 )
    v4 = 1;
  if ( v5 > 0xFFFFFFED )
    v2 = 1;
  return v4 | v2;
}

//----- (0000AA60) --------------------------------------------------------
int __fastcall sub_AA60(int a1, signed int a2)
{
  signed int v2; // r5@1
  int v3; // r4@1
  int v4; // r0@8

  v2 = a2;
  v3 = a1;
  if ( a2 > 12 )
  {
    if ( a2 != 15 )
    {
      if ( a2 == 14 )
      {
        v4 = a1 + 64;
        return *(_DWORD *)v4;
      }
      if ( a2 != 13 )
        goto LABEL_11;
LABEL_9:
      v4 = a1 + 60;
      return *(_DWORD *)v4;
    }
    goto LABEL_8;
  }
  if ( a2 == -2 )
    goto LABEL_9;
  if ( a2 == -1 )
  {
LABEL_8:
    v4 = a1 + 68;
    return *(_DWORD *)v4;
  }
LABEL_11:
  if ( (unsigned int)a2 > 0xC )
  {
    if ( (a2 & 0xFFFFFFFC) != 192 )
      sub_AE80(
        (int)"uint32_t libunwind::Registers_arm::getRegister(int)",
        (int)"external/libunwind_llvm/src/Registers.hpp",
        1452,
        (int)"unsupported arm register");
    if ( !*(_BYTE *)(a1 + 76) )
    {
      *(_BYTE *)(a1 + 76) = 1;
      sub_A8D0();
    }
    v4 = v3 + 4 * v2 - 296;
  }
  else
  {
    v4 = a1 + 4 * a2 + 8;
  }
  return *(_DWORD *)v4;
}

//----- (0000AAEC) --------------------------------------------------------
int __fastcall sub_AAEC(int result, signed int a2, int a3)
{
  signed int v3; // r6@1
  int v4; // r4@1
  int v5; // r5@1

  v3 = a2;
  v4 = a3;
  v5 = result;
  if ( a2 <= 12 )
  {
    if ( a2 == -2 )
      goto LABEL_9;
    if ( a2 != -1 )
      goto LABEL_11;
LABEL_8:
    *(_DWORD *)(result + 68) = a3;
    return result;
  }
  if ( a2 == 15 )
    goto LABEL_8;
  if ( a2 == 14 )
  {
    *(_DWORD *)(result + 64) = a3;
    return result;
  }
  if ( a2 == 13 )
  {
LABEL_9:
    *(_DWORD *)(result + 60) = a3;
    return result;
  }
LABEL_11:
  if ( (unsigned int)a2 > 0xC )
  {
    if ( (a2 & 0xFFFFFFFC) != 192 )
      sub_AE80(
        (int)"void libunwind::Registers_arm::setRegister(int, uint32_t)",
        (int)"external/libunwind_llvm/src/Registers.hpp",
        1471,
        (int)"unsupported arm register");
    if ( !*(_BYTE *)(result + 76) )
    {
      *(_BYTE *)(result + 76) = 1;
      sub_A8D0();
    }
    result = v5 + 4 * v3;
    *(_DWORD *)(result - 296) = v4;
  }
  else
  {
    result += 4 * a2;
    *(_DWORD *)(result + 8) = a3;
  }
  return result;
}

//----- (0000AB78) --------------------------------------------------------
int __fastcall sub_AB78(int a1, int a2)
{
  signed int v2; // r2@1
  bool v3; // zf@1
  signed int v4; // r0@1
  unsigned int v5; // r1@1

  v2 = 0;
  v3 = (a2 & 0xFFFFFFF0) == 112;
  v4 = 0;
  v5 = a2 & 0xFFFFFFE0;
  if ( v3 )
    v4 = 1;
  if ( v5 == 256 )
    v2 = 1;
  return v4 | v2;
}

//----- (0000AB9C) --------------------------------------------------------
__int64 __fastcall sub_AB9C(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r5@1
  unsigned int v4; // r0@1
  int v5; // r0@5
  int v6; // r0@9

  v2 = a2;
  v3 = a1;
  v4 = a2 & 0xFFFFFFF0;
  if ( (a2 & 0xFFFFFFF0) == 112 )
  {
    if ( !*(_BYTE *)(v3 + 75) )
    {
      *(_BYTE *)(v3 + 75) = 1;
      sub_A88C();
    }
    v6 = v3 + 8 * v2 - 552;
  }
  else if ( v4 == 272 )
  {
    if ( !*(_BYTE *)(v3 + 74) )
    {
      *(_BYTE *)(v3 + 74) = 1;
      sub_A884(v3 + 216);
    }
    v6 = v3 + 8 * v2 - 1960;
  }
  else
  {
    if ( v4 != 256 )
      sub_AE80(
        (int)"unw_fpreg_t libunwind::Registers_arm::getFloatRegister(int)",
        (int)"external/libunwind_llvm/src/Registers.hpp",
        1673,
        (int)"Unknown ARM float register");
    if ( !*(_BYTE *)(v3 + 73) )
    {
      *(_BYTE *)(v3 + 73) = 1;
      v5 = v3 + 80;
      if ( *(_BYTE *)(v3 + 72) )
        sub_A87C(v5);
      else
        sub_A874(v5);
    }
    v6 = v3 + 8 * v2 - 1968;
  }
  return *(_QWORD *)v6;
}

//----- (0000AC40) --------------------------------------------------------
int __fastcall sub_AC40(int a1, int a2, int a3, int a4)
{
  int v4; // r6@1
  int v5; // r7@1
  unsigned int v6; // r0@1
  int v7; // r5@1
  int v8; // r4@1
  int v9; // r0@5
  int result; // r0@9
  int v11; // r1@9

  v4 = a2;
  v5 = a1;
  v6 = a2 & 0xFFFFFFF0;
  v7 = a4;
  v8 = a3;
  if ( (a2 & 0xFFFFFFF0) == 112 )
  {
    if ( !*(_BYTE *)(v5 + 75) )
    {
      *(_BYTE *)(v5 + 75) = 1;
      sub_A88C();
    }
    result = v5 + 8 * v4;
    *(_DWORD *)(result - 548) = v7;
    LOWORD(v11) = -552;
  }
  else if ( v6 == 272 )
  {
    if ( !*(_BYTE *)(v5 + 74) )
    {
      *(_BYTE *)(v5 + 74) = 1;
      sub_A884(v5 + 216);
    }
    result = v5 + 8 * v4;
    *(_DWORD *)(result - 1956) = v7;
    LOWORD(v11) = -1960;
  }
  else
  {
    if ( v6 != 256 )
      sub_AE80(
        (int)"void libunwind::Registers_arm::setFloatRegister(int, unw_fpreg_t)",
        (int)"external/libunwind_llvm/src/Registers.hpp",
        1700,
        (int)"Unknown ARM float register");
    if ( !*(_BYTE *)(v5 + 73) )
    {
      *(_BYTE *)(v5 + 73) = 1;
      v9 = v5 + 80;
      if ( *(_BYTE *)(v5 + 72) )
        sub_A87C(v9);
      else
        sub_A874(v9);
    }
    result = v5 + 8 * v4;
    *(_DWORD *)(result - 1964) = v7;
    LOWORD(v11) = -1968;
  }
  HIWORD(v11) = -1;
  *(_DWORD *)(result + v11) = v8;
  return result;
}

//----- (0000AD0C) --------------------------------------------------------
signed int __fastcall sub_AD0C(int a1)
{
  int v1; // r4@1
  signed int result; // r0@2
  __int64 v3; // kr00_8@6
  int v4; // r0@6

  v1 = a1;
  if ( *(_BYTE *)(a1 + 528) )
    goto LABEL_10;
  result = sub_AEAC(a1);
  if ( result != 1 )
    return result;
  (*(void (__fastcall **)(int, signed int))(*(_DWORD *)v1 + 52))(v1, 1);
  if ( *(_BYTE *)(v1 + 528) )
  {
LABEL_10:
    result = 0;
  }
  else
  {
    if ( *(_DWORD *)(v1 + 504) )
    {
      v3 = *(_QWORD *)(*(_DWORD *)v1 + 12);
      v4 = ((int (__fastcall *)(int, signed int))v3)(v1, -2);
      ((void (__fastcall *)(_DWORD, _DWORD, _DWORD))HIDWORD(v3))(v1, -2, *(_DWORD *)(v1 + 504) + v4);
    }
    result = 1;
  }
  return result;
}

//----- (0000AD5C) --------------------------------------------------------
int __fastcall sub_AD5C(int a1, int a2)
{
  int v2; // r0@1
  int result; // r0@1
  int v4; // r2@1
  int v5; // r3@1
  int v6; // r4@1
  int v7; // r12@1
  int v8; // lr@1
  int v9; // r1@1
  int v10; // r3@1
  int v11; // r4@1
  int v12; // r12@1
  int v13; // lr@1

  v2 = a1 + 488;
  v4 = *(_DWORD *)v2;
  v5 = *(_DWORD *)(v2 + 4);
  v6 = *(_DWORD *)(v2 + 8);
  v7 = *(_DWORD *)(v2 + 12);
  v8 = *(_DWORD *)(v2 + 16);
  result = v2 + 20;
  *(_DWORD *)a2 = v4;
  *(_DWORD *)(a2 + 4) = v5;
  *(_DWORD *)(a2 + 8) = v6;
  *(_DWORD *)(a2 + 12) = v7;
  *(_DWORD *)(a2 + 16) = v8;
  v9 = a2 + 20;
  v10 = *(_DWORD *)(result + 4);
  v11 = *(_DWORD *)(result + 8);
  v12 = *(_DWORD *)(result + 12);
  v13 = *(_DWORD *)(result + 16);
  *(_DWORD *)v9 = *(_DWORD *)result;
  *(_DWORD *)(v9 + 4) = v10;
  *(_DWORD *)(v9 + 8) = v11;
  *(_DWORD *)(v9 + 12) = v12;
  *(_DWORD *)(v9 + 16) = v13;
  return result;
}

//----- (0000AD74) --------------------------------------------------------
void __fastcall sub_AD74(int a1)
{
  sub_AF00(a1 + 8);
  sub_B640();
}

//----- (0000AD8A) --------------------------------------------------------
int __fastcall sub_AD8A(int a1)
{
  return *(_BYTE *)(a1 + 529);
}

//----- (0000AD90) --------------------------------------------------------
signed int __fastcall sub_AD90(int a1, int a2, int a3, _DWORD *a4)
{
  int v4; // r6@1
  int v5; // r5@1
  _DWORD *v6; // r4@1
  int v7; // r7@1
  signed int result; // r0@3
  int v9; // [sp+10h] [bp-20h]@2
  int v10; // [sp+14h] [bp-1Ch]@3
  int v11; // [sp+18h] [bp-18h]@1

  v4 = a2;
  v5 = a3;
  v6 = a4;
  v11 = _stack_chk_guard;
  v7 = (*(int (**)(void))(*(_DWORD *)a1 + 12))();
  if ( dladdr() && v9 )
  {
    _snprintf_chk(v4, v5, 0, -1);
    *v6 = v7 - v10;
    result = 1;
  }
  else
  {
    result = 0;
  }
  if ( _stack_chk_guard != v11 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 3158: using guessed type int __fastcall _snprintf_chk(_DWORD, _DWORD, _DWORD, _DWORD);
// 34DC: using guessed type int dladdr(void);

//----- (0000AE00) --------------------------------------------------------
int __fastcall sub_AE00(int a1, int a2)
{
  int v2; // r4@1
  int v3; // r6@1
  unsigned int v4; // r5@1
  int result; // r0@7
  int v6; // [sp+0h] [bp-20h]@3
  int v7; // [sp+4h] [bp-1Ch]@3
  int v8; // [sp+8h] [bp-18h]@1
  int v9; // [sp+Ch] [bp-14h]@1

  v2 = a1;
  v3 = a2;
  v9 = _stack_chk_guard;
  v4 = (*(int (**)(void))(*(_DWORD *)a1 + 12))() & 0xFFFFFFFE;
  v8 = 0;
  if ( v3 )
    --v4;
  v6 = _gnu_Unwind_Find_exidx(v4, &v8);
  v7 = v8;
  if ( !v6 || !v8 || !((int (__fastcall *)(int, unsigned int, int *))sub_AF58)(v2, v4, &v6) )
    *(_BYTE *)(v2 + 528) = 1;
  result = _stack_chk_guard - v9;
  if ( _stack_chk_guard != v9 )
    _stack_chk_fail(result);
  return result;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);
// 34E8: using guessed type int __fastcall _gnu_Unwind_Find_exidx(_DWORD, _DWORD);
// AF58: using guessed type int sub_AF58();

//----- (0000AE70) --------------------------------------------------------
const char *__fastcall sub_AE70(int a1, int a2)
{
  const char *result; // r0@1

  result = "pc";
  switch ( a2 + 2 )
  {
    case 0:
    case 15:
      result = "sp";
      break;
    case 18:
    case 19:
    case 20:
    case 21:
    case 22:
    case 23:
    case 24:
    case 25:
    case 26:
    case 27:
    case 28:
    case 29:
    case 30:
    case 31:
    case 32:
    case 33:
    case 34:
    case 35:
    case 36:
    case 37:
    case 38:
    case 39:
    case 40:
    case 41:
    case 42:
    case 43:
    case 44:
    case 45:
    case 46:
    case 47:
    case 48:
    case 49:
    case 50:
    case 51:
    case 52:
    case 53:
    case 54:
    case 55:
    case 56:
    case 57:
    case 58:
    case 59:
    case 60:
    case 61:
    case 62:
    case 63:
    case 64:
    case 65:
def_B22A:
      result = "unknown register";
      break;
    case 1:
    case 17:
      return result;
    case 2:
      result = "r0";
      break;
    case 3:
      result = "r1";
      break;
    case 4:
      result = "r2";
      break;
    case 5:
      result = "r3";
      break;
    case 6:
      result = "r4";
      break;
    case 7:
      result = "r5";
      break;
    case 8:
      result = "r6";
      break;
    case 9:
      result = "r7";
      break;
    case 10:
      result = "r8";
      break;
    case 11:
      result = "r9";
      break;
    case 12:
      result = "r10";
      break;
    case 13:
      result = "r11";
      break;
    case 14:
      result = "r12";
      break;
    case 16:
      result = "lr";
      break;
    case 66:
      result = "s0";
      break;
    case 67:
      result = "s1";
      break;
    case 68:
      result = "s2";
      break;
    case 69:
      result = "s3";
      break;
    case 70:
      result = "s4";
      break;
    case 71:
      result = "s5";
      break;
    case 72:
      result = "s6";
      break;
    case 73:
      result = "s7";
      break;
    case 74:
      result = "s8";
      break;
    case 75:
      result = "s9";
      break;
    case 76:
      result = "s10";
      break;
    case 77:
      result = "s11";
      break;
    case 78:
      result = "s12";
      break;
    case 79:
      result = "s13";
      break;
    case 80:
      result = "s14";
      break;
    case 81:
      result = "s15";
      break;
    case 82:
      result = "s16";
      break;
    case 83:
      result = "s17";
      break;
    case 84:
      result = "s18";
      break;
    case 85:
      result = "s19";
      break;
    case 86:
      result = "s20";
      break;
    case 87:
      result = "s21";
      break;
    case 88:
      result = "s22";
      break;
    case 89:
      result = "s23";
      break;
    case 90:
      result = "s24";
      break;
    case 91:
      result = "s25";
      break;
    case 92:
      result = "s26";
      break;
    case 93:
      result = "s27";
      break;
    case 94:
      result = "s28";
      break;
    case 95:
      result = "s29";
      break;
    case 96:
      result = "s30";
      break;
    case 97:
      result = "s31";
      break;
    default:
      switch ( a2 )
      {
        case 256:
          result = "d0";
          break;
        case 257:
          result = "d1";
          break;
        case 258:
          result = "d2";
          break;
        case 259:
          result = "d3";
          break;
        case 260:
          result = "d4";
          break;
        case 261:
          result = "d5";
          break;
        case 262:
          result = "d6";
          break;
        case 263:
          result = "d7";
          break;
        case 264:
          result = "d8";
          break;
        case 265:
          result = "d9";
          break;
        case 266:
          result = "d10";
          break;
        case 267:
          result = "d11";
          break;
        case 268:
          result = "d12";
          break;
        case 269:
          result = "d13";
          break;
        case 270:
          result = "d14";
          break;
        case 271:
          result = "d15";
          break;
        case 272:
          result = "d16";
          break;
        case 273:
          result = "d17";
          break;
        case 274:
          result = "d18";
          break;
        case 275:
          result = "d19";
          break;
        case 276:
          result = "d20";
          break;
        case 277:
          result = "d21";
          break;
        case 278:
          result = "d22";
          break;
        case 279:
          result = "d23";
          break;
        case 280:
          result = "d24";
          break;
        case 281:
          result = "d25";
          break;
        case 282:
          result = "d26";
          break;
        case 283:
          result = "d27";
          break;
        case 284:
          result = "d28";
          break;
        case 285:
          result = "d29";
          break;
        case 286:
          result = "d30";
          break;
        case 287:
          result = "d31";
          break;
        default:
          goto def_B22A;
      }
      break;
  }
  return result;
}

//----- (0000AE76) --------------------------------------------------------
int __fastcall sub_AE76(int result)
{
  *(_BYTE *)(result + 72) = 1;
  return result;
}

//----- (0000AE80) --------------------------------------------------------
void __fastcall sub_AE80(int a1, int a2, int a3, int a4)
{
  fprintf((FILE *)stderr, "libunwind: %s %s:%d - %s\n", a1, a2, a3, a4);
  abort();
}

//----- (0000AEAC) --------------------------------------------------------
signed int __fastcall sub_AEAC(int a1)
{
  int v1; // r5@1
  signed int v2; // r4@1
  int v3; // r0@1
  unsigned int v5; // [sp+4h] [bp-1Ch]@1
  unsigned int v6; // [sp+8h] [bp-18h]@1
  int v7; // [sp+Ch] [bp-14h]@1

  v1 = a1;
  v2 = 0;
  v7 = _stack_chk_guard;
  v5 = 0;
  v6 = 0;
  v3 = sub_9FE0(*(_DWORD *)(a1 + 520), (signed int *)&v5, (int *)&v6);
  if ( sub_A034(v1, v3, v5, v6) == 8 )
    v2 = 1;
  if ( _stack_chk_guard != v7 )
    _stack_chk_fail(_stack_chk_guard - v7);
  return v2;
}
// 2FE4: using guessed type int __fastcall _stack_chk_fail(_DWORD);

//----- (0000AF00) --------------------------------------------------------
int __fastcall sub_AF00(int a1)
{
  int v1; // r4@1
  int v2; // r0@2
  unsigned int v3; // r0@5
  unsigned int v4; // r0@6
  int result; // r0@10

  v1 = a1;
  if ( *(_BYTE *)(a1 + 65) )
  {
    v2 = a1 + 72;
    if ( *(_BYTE *)(v1 + 64) )
      sub_B5A8(v2);
    else
      sub_B5A0(v2);
  }
  v3 = *(_WORD *)(v1 + 66);
  if ( (_BYTE)v3 )
  {
    sub_B5B0(v1 + 208);
    v4 = *(_BYTE *)(v1 + 67);
  }
  else
  {
    v4 = v3 >> 8;
  }
  if ( v4 )
    sub_B5B8((_DWORD *)(v1 + 336));
  result = *(_BYTE *)(v1 + 68);
  if ( *(_BYTE *)(v1 + 68) )
    result = sub_B650((_DWORD *)(v1 + 464));
  return result;
}

//----- (0000B0FC) --------------------------------------------------------
int __fastcall sub_B0FC(int a1, int a2, int a3, _DWORD *a4, int a5, int a6, int a7, _DWORD *a8)
{
  unsigned int v8; // r4@1
  unsigned int v9; // r5@2
  int v10; // r6@3

  v8 = a5 - a2;
  while ( 1 )
  {
    v9 = v8;
    if ( !v8 )
      break;
    v10 = a2 + (v8 >> 1);
    v8 >>= 1;
    if ( *a8 >= *a4 + 8 * v10 + (2 * *(_DWORD *)(*a4 + 8 * v10) & 0x80000000 | *(_DWORD *)(*a4 + 8 * v10)) )
    {
      v8 = v9 - 1 - v8;
      a2 = v10 + 1;
    }
  }
  *(_DWORD *)a1 = a2;
  *(_DWORD *)(a1 + 4) = a3;
  *(_DWORD *)(a1 + 8) = a4;
  return a1 + 12;
}

//----- (0000B5A0) --------------------------------------------------------
int __fastcall sub_B5A0(int _R0)
{
  int result; // r0@1

  __asm { VLDMIA          R0, {D0-D15} }
  return result;
}

//----- (0000B5A8) --------------------------------------------------------
int __fastcall sub_B5A8(int _R0)
{
  int result; // r0@1

  __asm { VLDMIA          R0, {D0-D15} }
  return result;
}

//----- (0000B5B0) --------------------------------------------------------
int __fastcall sub_B5B0(int _R0)
{
  int result; // r0@1

  __asm { VLDMIA          R0, {D16-D31} }
  return result;
}

//----- (0000B5B8) --------------------------------------------------------
int __fastcall sub_B5B8(_DWORD *a1)
{
  int *v5; // r0@1
  int result; // r0@1

  _T1 = *a1;
  v5 = a1 + 2;
  __asm { LDCL            p1, c0, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c1, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c2, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c3, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c4, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c5, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c6, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c7, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c8, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c9, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c10, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c11, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c12, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c13, [R0],#8 }
  _T1 = *v5;
  v5 += 2;
  __asm { LDCL            p1, c14, [R0],#8 }
  _T1 = *v5;
  result = (int)(v5 + 2);
  __asm { LDCL            p1, c15, [R0],#8 }
  return result;
}

//----- (0000B5FC) --------------------------------------------------------
int __fastcall sub_B5FC(_DWORD *a1)
{
  int *v5; // r0@1
  int result; // r0@1

  _T1 = *a1;
  v5 = a1 + 1;
  __asm { LDC2            p1, c8, [R0],#4 }
  _T1 = *v5;
  ++v5;
  __asm { LDC2            p1, c9, [R0],#4 }
  _T1 = *v5;
  ++v5;
  __asm { LDC2            p1, c10, [R0],#4 }
  _T1 = *v5;
  result = (int)(v5 + 1);
  __asm { LDC2            p1, c11, [R0],#4 }
  return result;
}

//----- (0000B610) --------------------------------------------------------
void j_j_free(void *ptr)
{
  j_free(ptr);
}

//----- (0000B614) --------------------------------------------------------
void j_free(void *ptr)
{
  free(ptr);
}

//----- (0000B620) --------------------------------------------------------
int j_j_pthread_mutex_unlock(pthread_mutex_t *mutex)
{
  return j_pthread_mutex_unlock(mutex);
}

//----- (0000B624) --------------------------------------------------------
int j_pthread_mutex_unlock(pthread_mutex_t *mutex)
{
  return pthread_mutex_unlock(mutex);
}

//----- (0000B630) --------------------------------------------------------
char *j_j_strdup(const char *s)
{
  return j_strdup(s);
}

//----- (0000B634) --------------------------------------------------------
char *j_strdup(const char *s)
{
  return strdup(s);
}

//----- (0000B640) --------------------------------------------------------
void sub_B640()
{
  sub_B644();
}

//----- (0000B644) --------------------------------------------------------
void sub_B644()
{
  JUMPOUT(sub_B58C);
}
// B58C: using guessed type int sub_B58C();

//----- (0000B650) --------------------------------------------------------
int __fastcall sub_B650(_DWORD *a1)
{
  return sub_B654(a1);
}

//----- (0000B654) --------------------------------------------------------
int __fastcall sub_B654(_DWORD *a1)
{
  return sub_B5FC(a1);
}

// ALL OK, 152 function(s) have been successfully decompiled
